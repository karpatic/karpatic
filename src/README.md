# Welcome!

## About

This is a mono repo spanning multiple projects.

YAML in ipynb is used to convert it for use in pre-rendered (blog, notebooks and articles) <10kbs pages.

This repo has:

- My blog, notebooks, and articles
- Custom NPM ipynb2html library
- 3D Printable Census Map
- ESP32 firmware and companion app
- Python Datascience course with companion PyPi libray

please visit the official [website](https://charleskarpati.com/) for more information

## OVERVIEW

```
KARPATIC
|- README
|- CNAME
|- Procfile
|- .env
|- package.json
|- webpack.config.js
|- Makefile: runs ipynb convert scripts + sitemap.txt
|- docs - build script output for production
|- src
|  |- README: (you are here)
|  |- ipynb
|  |- client: github
|  |  |- audio
|  |  |- images
|  |  |- posts: makefile converted ipynbs
|  |  |- templates
|  |  |- utils: convert scripts
|  |- server: heroku
|  |  |- contracts: solidity
|  |  |- scripts
|  |- ipynb: page content
|- sitemap.txt - autogenerated during build
|- robots.txt
```

## SET UP

- Read the /README.md in both /client the /server and the /ipynb REPOs
- `npm install`

### Prettier

- I use Prettier in Visual Studio Code. More [information](https://dev.to/gulshansaini/how-to-disable-prettier-in-vscode-for-a-specific-project-2a48).







# Welcome!

## About

I keep my client-side code and web-assets here. There are three environments: [dev, build, prod].

> keywords: Static-site-generation (SSG), Template-engine, Single-Page-Application (SPA), Client-Side Navigation, Rehydration, Prerender

## DEV: Pre-Compile

- Ensure you can use Make (Windows will need MinGw) and add working version of Chromium to where specified in source code

`npm run makePages` will build static assets using the /ipynb/ directory.

`npm run watchPages` will rebuild whenever a ipynb file changes. Can be ran concurrently with the dev server.

- Each .ipynb in the /ipynb directory becomes a template-ready [/posts/{dir}{file}.json] file.
- Url paths are derived from its origin filepath.
- [/posts/{dir}_map.json] files are created for the top directory and each sub-folder.

## DEV: Webpack

`npm run start` will start the dev server.

Webpack compiles the client as so:

    <head>
      <meta charset="UTF-8">
      <title>My Webpack App</title>
      <script> Index.js Inlined </script>
      <script src="head.js"> Injected</script>
    </head>

- Debugging: Toggle `purefuncs` for console log

## Client-Side Outline:

- Index.js renders (dev/ r-snap/ prod).
- - Attaches router evt listener to lazy-load [router.js]

- Header.js renders (r-snap/ dev) and then remove itself for (prod).
- - Uses: [header.json,posts/{dir}{file}.json]
- - `Head.json`: uses src/images/ for meta tags
- - Dispatches router

- Router.js
- - Updates [template,content,sitemap,metadata(title),breadcrumbs]
- - Dispatches 'refreshTemplate' which triggers [refresh_template]

w["tocHere"] || w["toc"]

- Refresh_template.js
- - Sitemap.js injects template content and conditionally refreshes sitemap/TOC

## Build Steps

0. Make: Create sitemap and convert ipynb's
1. Webpack: Copy static assets to build dir
2. Webpack: Run build
3. React-Snap

## Build: React-Snap

React-snap will pre-render the pages locally during the build step and rehydration and navigation logic get lazy loaded.

1. react-snap visits `/` or any other pages listed in `include` configuration
2. find all links on the page with the same domain, add them to queue
3. If there is more than one page in the queue it also adds `/404.html` to the queue
4. renders the page with the help of puppeteer
5. waits till there are no active network requests for more than 0.5 second

React-snapshot Follows every relative URL to crawl the whole site.
The default snapshot delay is 50ms. It works with routing strategies using the HTML5 history API. No hash(bang) URLs.

> Render will remove any SEARCH or HASH from URL

[[Alternatives](https://github.com/stereobooster/react-snap/blob/master/doc/alternatives.md), [Recipes](https://github.com/stereobooster/react-snap/blob/master/doc/recipes.md), [isReactSnapRunning](https://github.com/stereobooster/react-snap/blob/master/tests/examples/partial/index.js), [Explainer](https://github.com/stereobooster/react-snap/blob/master/doc/behind-the-scenes.md)]

## Misc

The following are being used internally.

- `Robots.txt` -> specify sitemaps and nofollow noindex section/links. More [info](https://search.google.com/search-console/welcome), [here](https://support.google.com/webmasters/answer/7451001).

- `make pages` - Creates /posts.
- `make sitemap` - Creates Sitemap.txt. Relies on make pages.
- `make audio` - Creates /audio. Relies on make pages.