# Welcome!

## About

I keep my client-side code and web-assets here. There are three environments: [dev, build, prod].

> keywords: Static-site-generation (SSG), Template-engine, Single-Page-Application (SPA), Client-Side Navigation, Rehydration, Prerender

## OVERVIEW

```
KARPATIC
|- README
|- CNAME 
|- .env
|- package.json
|- webpack.config.js
|- Makefile 
|- src
|  |- README: (you are here)
|  |- ipynb 
|  |- audio
|  |- images 
|  |- templates
|  |- ipynb: page content
|- sitemap.txt - autogenerated during build
|- robots.txt
```

### Prettier

- I use Prettier in Visual Studio Code. More [information](https://dev.to/gulshansaini/how-to-disable-prettier-in-vscode-for-a-specific-project-2a48).
 
## DEV: Pre-Compile

- Each .ipynb in the /ipynb directory becomes a template-ready [/posts/{dir}{file}.json] file.

## DEV: Webpack

`npm run start` will start the dev server.

Webpack compiles the client as so:

    <head>
      <meta charset="UTF-8">
      <title>My Webpack App</title>
      <script> Index.js Inlined </script>
      <script src="head.js"> Injected</script>
    </head>

- Debugging: Toggle `purefuncs` for console log

## Client-Side Outline:

- Index.js renders (dev/ r-snap/ prod).
- - Attaches router evt listener to lazy-load [router.js]

- Header.js renders (r-snap/ dev) and then remove itself for (prod).
- - Uses: [header.json,posts/{dir}{file}.json]
- - `Head.json`: uses src/images/ for meta tags
- - Dispatches router

- Router.js
- - Updates [template,content,sitemap,metadata(title),breadcrumbs]
- - Dispatches 'refreshTemplate' which triggers [load_template] 

- Refresh_template.js
- - Sitemap.js injects template content and conditionally refreshes sitemap/TOC

## Usage Instructions 

- Router.js 
- - Dispatches 'refreshTemplate' which triggers [load_template] 

- w.addEventListener( "load_template", () => {} )
- - document.title
- - w[meta][template] ||= "article"
- - getAttribute("data-template")
- - - Inject HTML + CSS + JS
- - Get SiteMap()
- - w[sitemap] && !w[meta][hide_sitemap]
- - - w[sm_name] 
- - - w[sitemap_content] 
- - - Inject CSS + text from filtered /cms/notes.json
- - populateTemplate()

- populateTemplate()
- - w[page_transition]`
- - Updates w[content,title,summary,breadcrumbs]
- - createNav()
- - Add Anchor Tags => w.toast()
- - Reset Dark Mode/ Audio/ Expanded Icons
- - loadObserver?.();

- createNav()
- - getToc() == w[meta][toc] || querySelectorAll(h2, h3, h4)
- - w[tocHere] || w[toc]
- - w[meta][hide_sitemap]
- - w[sitemap].innerHTML
- - - w[toggle_sitemap].checked = true;
- - - w[toggle_toc]
- - - x[tab] || x[filename] 

- hide_sitemap: false
- hide_toc: true
- hide_transition: true


## Build Steps

0. Make: Create sitemap and convert ipynb's
1. Webpack: Copy static assets to build dir
2. Webpack: Run build
3. Prerender

## Build: Prerender

Pre-render the pages locally during the build step and rehydration and navigation logic get lazy loaded.

1. visits `/` or any other pages listed in `include` configuration
2. find all links on the page with the same domain, add them to queue
3. If there is more than one page in the queue it also adds `/404.html` to the queue
4. renders the page with the help of puppeteer
5. waits till there are no active network requests for more than 0.5 second

## Misc

The following are being used internally.

- `Robots.txt` -> specify sitemaps and nofollow noindex section/links. More [info](https://search.google.com/search-console/welcome), [here](https://support.google.com/webmasters/answer/7451001). 