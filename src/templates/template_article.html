<div id="tracer"></div>
<svg xmlns="http://www.w3.org/2000/svg" id="svg_bg"></svg> 
<!-- this checkbox holds state of whether modal is visible or not -->

<input type="checkbox" id="toggle-sitemap">
<div id="sitemap"> 
  <label role="button" tabindex="0" for="toggle-sitemap"><span>Hide</span> <span>Show </span>Sitemap</label>
</div>
<link id='template' class='template_article'>
<div id='pageTransitioneer'><p>Don't Look! I'm changing!</p></div>
<div id="toast-container"><p>URL Copied</p></div>
<div id="gradient_bg"> 
</div>  
<div id="header">
  <div id="header_nav">
    <h1><a href="./">Charles Karpati</a> <span id="head_separator"> | </span> <a href="#title" id="title"></a></h1> 
    <p id="summary"></p>
  </div>
  <span id="header_bg_wrapper"><div id="header_bg"></div></span> 
</div>

<div class="controls-container">
  <div> 
    <input type="checkbox" id="lightmode"><label for="lightmode" id="light"></label>
    <input type="checkbox" id="expandmode"><label for="expandmode" id="expand"></label>
    <p id="music" title="Bauchamp - 127 bass with bug and perc.mp3"><span>
      <audio controls  controlsList="nodownload noplaybackrate" preload="none" loop  
        src="./audio/title.mp3"></audio>
    </span> Musical loops</p>
  </div>
</div>

<div class='broider' id='content'>
  <div id="outline"></div>
  <div id="content"></div>
</div>
<div id="footer">
  <p id="thanks">Thank's for visiting! - <a href='./legal.html'>Terms of use</a> </p>
  <span id="footer_bg_wrapper"><div id="footer_bg"></div></span> 
</div> 

<!-- <link rel="stylesheet" type="text/css" href="/templates/template_article.css"></link>-->
<script type="text/javascript">
let w = window;
var inDrag, dragStartX, dragStartY, objInitLeft, objInitTop = 0;
function loadLazy() { w.loadOnce||((document.head||d).appendChild(document.createElement('script')).src='templates/template_article_lazy.js');  w.loadOnce=true; }
function downFN(e) { loadLazy(); inDrag = true;
    objInitLeft = sitemap.offsetLeft; objInitTop = sitemap.offsetTop;
    dragStartX = e.pageX || e.targetTouches[0].clientX; 
    dragStartY = e.pageY || e.targetTouches[0].clientY; 
}
function scrollFN(){ let d = document.documentElement; loadLazy();
  w.tracer?.style.setProperty('--scrollPercent', (d.scrollTop) / (d.scrollHeight - d.clientHeight) * 100 + '%');
}

[ [["mousedown", "touchstart"], downFN], 
  [["scroll"], scrollFN] 
].forEach(evt => evt[0].forEach(type => sitemap.addEventListener(type, evt[1], { passive: false })));

w.activeHeader = null
const observer = new IntersectionObserver((entries) => { 
    entries.forEach((entry) => {let e=entry.target
        let txt = "0.5s ease-in-out 0s 2 normal none running wiggle";
        let pos = e.getBoundingClientRect().top
        let el = (e.parentNode.nodeName == "SUMMARY" && e.parentNode.style || e.style ) 
        if (!entry.isIntersecting){ el.animation == txt && (el.animation = ''); return; }
        el.animation = txt 
        if(pos<300 || pos>300){
            w.activeHeader && (w.activeHeader.style.textDecoration='none')
            let tocLink = document.getElementById('goto_'+e.id)
            tocLink && ( tocLink.style.animation = txt, tocLink.style.textDecoration='line-through' ) 
            w.activeHeader = tocLink
        }
    });
});
w.loadObserver = (t) =>{ document.querySelectorAll('h2,h3,h4').forEach((el) => observer.observe(el) ) };  
loadObserver();
</script>