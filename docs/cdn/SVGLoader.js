import{BufferGeometry,FileLoader,Float32BufferAttribute,Loader,Matrix3,Path,ShapePath,Vector2,Vector3}from"./three.js";var SVGLoader=function(e){Loader.call(this,e),this.defaultDPI=90,this.defaultUnit="px"};SVGLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:SVGLoader,load:function(e,t,r,a){var o=this,i=new FileLoader(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,(function(r){try{t(o.parse(r))}catch(t){a?a(t):console.error(t),o.manager.itemError(e)}}),r,a)},parse:function(e){var t=this;function parseArcCommand(e,t,r,a,o,i,s,n){if(0!=t&&0!=r){a=a*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var d=(s.x-n.x)/2,l=(s.y-n.y)/2,c=Math.cos(a)*d+Math.sin(a)*l,u=-Math.sin(a)*d+Math.cos(a)*l,p=t*t,y=r*r,x=c*c,h=u*u,f=x/p+h/y;if(f>1){var V=Math.sqrt(f);p=(t*=V)*t,y=(r*=V)*r}var g=p*h+y*x,m=(p*y-g)/g,b=Math.sqrt(Math.max(0,m));o===i&&(b=-b);var v=b*t*u/r,k=-b*r*c/t,S=Math.cos(a)*v-Math.sin(a)*k+(s.x+n.x)/2,A=Math.sin(a)*v+Math.cos(a)*k+(s.y+n.y)/2,w=svgAngle(1,0,(c-v)/t,(u-k)/r),M=svgAngle((c-v)/t,(u-k)/r,(-c-v)/t,(-u-k)/r)%(2*Math.PI);e.currentPath.absellipse(S,A,t,r,w,w+M,0===i,a)}else e.lineTo(n.x,n.y)}function svgAngle(e,t,r,a){var o=e*r+t*a,i=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+a*a),s=Math.acos(Math.max(-1,Math.min(1,o/i)));return e*a-t*r<0&&(s=-s),s}function parseStyle(e,t){t=Object.assign({},t);var r={};if(e.hasAttribute("class"))for(var a=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim())),o=0;o<a.length;o++)r=Object.assign(r,i["."+a[o]]);function addStyle(a,o,i){void 0===i&&(i=function copy(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(a)&&(t[o]=i(e.getAttribute(a))),r[a]&&(t[o]=i(r[a])),e.style&&""!==e.style[a]&&(t[o]=i(e.style[a]))}function clamp(e){return Math.max(0,Math.min(1,parseFloatWithUnits(e)))}function positive(e){return Math.max(0,parseFloatWithUnits(e))}return e.hasAttribute("id")&&(r=Object.assign(r,i["#"+e.getAttribute("id")])),addStyle("fill","fill"),addStyle("fill-opacity","fillOpacity",clamp),addStyle("opacity","opacity",clamp),addStyle("stroke","stroke"),addStyle("stroke-opacity","strokeOpacity",clamp),addStyle("stroke-width","strokeWidth",positive),addStyle("stroke-linejoin","strokeLineJoin"),addStyle("stroke-linecap","strokeLineCap"),addStyle("stroke-miterlimit","strokeMiterLimit",positive),addStyle("visibility","visibility"),t}function getReflection(e,t){return e-(t-e)}function parseFloats(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),r=0;r<t.length;r++){var a=t[r];if(a.indexOf(".")!==a.lastIndexOf("."))for(var o=a.split("."),i=2;i<o.length;i++)t.splice(r+i-1,0,"0."+o[i]);t[r]=parseFloatWithUnits(a)}return t}var r=["mm","cm","in","pt","pc","px"],a={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function parseFloatWithUnits(e){var o="px";if("string"==typeof e||e instanceof String)for(var i=0,s=r.length;i<s;i++){var n=r[i];if(e.endsWith(n)){o=n,e=e.substring(0,e.length-n.length);break}}var d=void 0;return"px"===o&&"px"!==t.defaultUnit?d=a.in[t.defaultUnit]/t.defaultDPI:(d=a[o][t.defaultUnit])<0&&(d=a[o].in*t.defaultDPI),d*parseFloat(e)}function getTransformScaleX(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function getTransformScaleY(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var o=[],i={},s=[],n=new Matrix3,d=new Matrix3,l=new Matrix3,c=new Matrix3,u=new Vector2,p=new Vector3,y=new Matrix3,x=(new DOMParser).parseFromString(e,"image/svg+xml");return function parseNode(e,t){if(1===e.nodeType){var r=function getNodeTransform(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;var t=function parseNodeTransform(e){var t=new Matrix3,r=n;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){var a=parseFloatWithUnits(e.getAttribute("x")),o=parseFloatWithUnits(e.getAttribute("y"));t.translate(a,o)}if(e.hasAttribute("transform"))for(var i=e.getAttribute("transform").split(")"),s=i.length-1;s>=0;s--){var u=i[s].trim();if(""!==u){var p=u.indexOf("("),y=u.length;if(p>0&&p<y){var x=u.substr(0,p),h=parseFloats(u.substr(p+1,y-p-1));switch(r.identity(),x){case"translate":if(h.length>=1){o=a=h[0];h.length>=2&&(o=h[1]),r.translate(a,o)}break;case"rotate":if(h.length>=1){var f=0,V=0,g=0;f=-h[0]*Math.PI/180,h.length>=3&&(V=h[1],g=h[2]),d.identity().translate(-V,-g),l.identity().rotate(f),c.multiplyMatrices(l,d),d.identity().translate(V,g),r.multiplyMatrices(d,c)}break;case"scale":if(h.length>=1){var m=h[0],b=m;h.length>=2&&(b=h[1]),r.scale(m,b)}break;case"skewX":1===h.length&&r.set(1,Math.tan(h[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===h.length&&r.set(1,0,0,Math.tan(h[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===h.length&&r.set(h[0],h[2],h[4],h[1],h[3],h[5],0,0,1)}}t.premultiply(r)}}return t}(e);s.length>0&&t.premultiply(s[s.length-1]);return y.copy(t),s.push(t),t}(e),a=!0,x=null;switch(e.nodeName){case"svg":break;case"style":!function parseCSSStylesheet(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(var t=0;t<e.sheet.cssRules.length;t++){var r=e.sheet.cssRules[t];if(1===r.type)for(var a=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim())),o=0;o<a.length;o++)i[a[o]]=Object.assign(i[a[o]]||{},r.style)}}(e);break;case"g":t=parseStyle(e,t);break;case"path":t=parseStyle(e,t),e.hasAttribute("d")&&(x=function parsePathNode(e){for(var t=new ShapePath,r=new Vector2,a=new Vector2,o=new Vector2,i=!0,s=!1,n=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),d=0,l=n.length;d<l;d++){var c=n[d],u=c.charAt(0),p=c.substr(1).trim();switch(!0===i&&(s=!0,i=!1),u){case"M":for(var y=0,x=(g=parseFloats(p)).length;y<x;y+=2)r.x=g[y+0],r.y=g[y+1],a.x=r.x,a.y=r.y,0===y?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"H":for(y=0,x=(g=parseFloats(p)).length;y<x;y++)r.x=g[y],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"V":for(y=0,x=(g=parseFloats(p)).length;y<x;y++)r.y=g[y],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"L":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=2)r.x=g[y+0],r.y=g[y+1],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"C":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=6)t.bezierCurveTo(g[y+0],g[y+1],g[y+2],g[y+3],g[y+4],g[y+5]),a.x=g[y+2],a.y=g[y+3],r.x=g[y+4],r.y=g[y+5],0===y&&!0===s&&o.copy(r);break;case"S":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=4)t.bezierCurveTo(getReflection(r.x,a.x),getReflection(r.y,a.y),g[y+0],g[y+1],g[y+2],g[y+3]),a.x=g[y+0],a.y=g[y+1],r.x=g[y+2],r.y=g[y+3],0===y&&!0===s&&o.copy(r);break;case"Q":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=4)t.quadraticCurveTo(g[y+0],g[y+1],g[y+2],g[y+3]),a.x=g[y+0],a.y=g[y+1],r.x=g[y+2],r.y=g[y+3],0===y&&!0===s&&o.copy(r);break;case"T":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=2){var h=getReflection(r.x,a.x),f=getReflection(r.y,a.y);t.quadraticCurveTo(h,f,g[y+0],g[y+1]),a.x=h,a.y=f,r.x=g[y+0],r.y=g[y+1],0===y&&!0===s&&o.copy(r)}break;case"A":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=7)if(g[y+5]!=r.x||g[y+6]!=r.y){var V=r.clone();r.x=g[y+5],r.y=g[y+6],a.x=r.x,a.y=r.y,parseArcCommand(t,g[y],g[y+1],g[y+2],g[y+3],g[y+4],V,r),0===y&&!0===s&&o.copy(r)}break;case"m":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=2)r.x+=g[y+0],r.y+=g[y+1],a.x=r.x,a.y=r.y,0===y?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"h":for(y=0,x=(g=parseFloats(p)).length;y<x;y++)r.x+=g[y],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"v":for(y=0,x=(g=parseFloats(p)).length;y<x;y++)r.y+=g[y],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"l":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=2)r.x+=g[y+0],r.y+=g[y+1],a.x=r.x,a.y=r.y,t.lineTo(r.x,r.y),0===y&&!0===s&&o.copy(r);break;case"c":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=6)t.bezierCurveTo(r.x+g[y+0],r.y+g[y+1],r.x+g[y+2],r.y+g[y+3],r.x+g[y+4],r.y+g[y+5]),a.x=r.x+g[y+2],a.y=r.y+g[y+3],r.x+=g[y+4],r.y+=g[y+5],0===y&&!0===s&&o.copy(r);break;case"s":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=4)t.bezierCurveTo(getReflection(r.x,a.x),getReflection(r.y,a.y),r.x+g[y+0],r.y+g[y+1],r.x+g[y+2],r.y+g[y+3]),a.x=r.x+g[y+0],a.y=r.y+g[y+1],r.x+=g[y+2],r.y+=g[y+3],0===y&&!0===s&&o.copy(r);break;case"q":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=4)t.quadraticCurveTo(r.x+g[y+0],r.y+g[y+1],r.x+g[y+2],r.y+g[y+3]),a.x=r.x+g[y+0],a.y=r.y+g[y+1],r.x+=g[y+2],r.y+=g[y+3],0===y&&!0===s&&o.copy(r);break;case"t":for(y=0,x=(g=parseFloats(p)).length;y<x;y+=2){h=getReflection(r.x,a.x),f=getReflection(r.y,a.y);t.quadraticCurveTo(h,f,r.x+g[y+0],r.y+g[y+1]),a.x=h,a.y=f,r.x=r.x+g[y+0],r.y=r.y+g[y+1],0===y&&!0===s&&o.copy(r)}break;case"a":var g;for(y=0,x=(g=parseFloats(p)).length;y<x;y+=7)if(0!=g[y+5]||0!=g[y+6]){V=r.clone();r.x+=g[y+5],r.y+=g[y+6],a.x=r.x,a.y=r.y,parseArcCommand(t,g[y],g[y+1],g[y+2],g[y+3],g[y+4],V,r),0===y&&!0===s&&o.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(o),t.currentPath.currentPoint.copy(r),i=!0);break;default:console.warn(c)}s=!1}return t}(e));break;case"rect":t=parseStyle(e,t),x=function parseRectNode(e){var t=parseFloatWithUnits(e.getAttribute("x")||0),r=parseFloatWithUnits(e.getAttribute("y")||0),a=parseFloatWithUnits(e.getAttribute("rx")||0),o=parseFloatWithUnits(e.getAttribute("ry")||0),i=parseFloatWithUnits(e.getAttribute("width")),s=parseFloatWithUnits(e.getAttribute("height")),n=new ShapePath;n.moveTo(t+2*a,r),n.lineTo(t+i-2*a,r),(0!==a||0!==o)&&n.bezierCurveTo(t+i,r,t+i,r,t+i,r+2*o);n.lineTo(t+i,r+s-2*o),(0!==a||0!==o)&&n.bezierCurveTo(t+i,r+s,t+i,r+s,t+i-2*a,r+s);n.lineTo(t+2*a,r+s),(0!==a||0!==o)&&n.bezierCurveTo(t,r+s,t,r+s,t,r+s-2*o);n.lineTo(t,r+2*o),(0!==a||0!==o)&&n.bezierCurveTo(t,r,t,r,t+2*a,r);return n}(e);break;case"polygon":t=parseStyle(e,t),x=function parsePolygonNode(e){function iterator(e,t,o){var i=parseFloatWithUnits(t),s=parseFloatWithUnits(o);0===a?r.moveTo(i,s):r.lineTo(i,s),a++}var t=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new ShapePath,a=0;return e.getAttribute("points").replace(t,iterator),r.currentPath.autoClose=!0,r}(e);break;case"polyline":t=parseStyle(e,t),x=function parsePolylineNode(e){function iterator(e,t,o){var i=parseFloatWithUnits(t),s=parseFloatWithUnits(o);0===a?r.moveTo(i,s):r.lineTo(i,s),a++}var t=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new ShapePath,a=0;return e.getAttribute("points").replace(t,iterator),r.currentPath.autoClose=!1,r}(e);break;case"circle":t=parseStyle(e,t),x=function parseCircleNode(e){var t=parseFloatWithUnits(e.getAttribute("cx")),r=parseFloatWithUnits(e.getAttribute("cy")),a=parseFloatWithUnits(e.getAttribute("r")),o=new Path;o.absarc(t,r,a,0,2*Math.PI);var i=new ShapePath;return i.subPaths.push(o),i}(e);break;case"ellipse":t=parseStyle(e,t),x=function parseEllipseNode(e){var t=parseFloatWithUnits(e.getAttribute("cx")),r=parseFloatWithUnits(e.getAttribute("cy")),a=parseFloatWithUnits(e.getAttribute("rx")),o=parseFloatWithUnits(e.getAttribute("ry")),i=new Path;i.absellipse(t,r,a,o,0,2*Math.PI);var s=new ShapePath;return s.subPaths.push(i),s}(e);break;case"line":t=parseStyle(e,t),x=function parseLineNode(e){var t=parseFloatWithUnits(e.getAttribute("x1")),r=parseFloatWithUnits(e.getAttribute("y1")),a=parseFloatWithUnits(e.getAttribute("x2")),o=parseFloatWithUnits(e.getAttribute("y2")),i=new ShapePath;return i.moveTo(t,r),i.lineTo(a,o),i.currentPath.autoClose=!1,i}(e);break;case"defs":a=!1;break;case"use":t=parseStyle(e,t);var h=e.href.baseVal.substring(1),f=e.viewportElement.getElementById(h);f?parseNode(f,t):console.warn("SVGLoader: 'use node' references non-existent node id: "+h)}if(x&&(void 0!==t.fill&&"none"!==t.fill&&x.color.setStyle(t.fill),function transformPath(e,t){function transfVec2(e){p.set(e.x,e.y,1).applyMatrix3(t),e.set(p.x,p.y)}for(var r=function isTransformRotated(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),a=e.subPaths,o=0,i=a.length;o<i;o++)for(var s=a[o].curves,n=0;n<s.length;n++){var d=s[n];d.isLineCurve?(transfVec2(d.v1),transfVec2(d.v2)):d.isCubicBezierCurve?(transfVec2(d.v0),transfVec2(d.v1),transfVec2(d.v2),transfVec2(d.v3)):d.isQuadraticBezierCurve?(transfVec2(d.v0),transfVec2(d.v1),transfVec2(d.v2)):d.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),u.set(d.aX,d.aY),transfVec2(u),d.aX=u.x,d.aY=u.y,d.xRadius*=getTransformScaleX(t),d.yRadius*=getTransformScaleY(t))}}(x,y),o.push(x),x.userData={node:e,style:t}),a)for(var V=e.childNodes,g=0;g<V.length;g++)parseNode(V[g],t);r&&(s.pop(),s.length>0?y.copy(s[s.length-1]):y.identity())}}(x.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:o,xml:x.documentElement}}}),SVGLoader.getStrokeStyle=function(e,t,r,a,o){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:a=void 0!==a?a:"butt",strokeMiterLimit:o=void 0!==o?o:4}},SVGLoader.pointsToStroke=function(e,t,r,a){var o=[],i=[],s=[];if(0===SVGLoader.pointsToStrokeWithBuffers(e,t,r,a,o,i,s))return null;var n=new BufferGeometry;return n.setAttribute("position",new Float32BufferAttribute(o,3)),n.setAttribute("normal",new Float32BufferAttribute(i,3)),n.setAttribute("uv",new Float32BufferAttribute(s,2)),n},SVGLoader.pointsToStrokeWithBuffers=function(){var e=new Vector2,t=new Vector2,r=new Vector2,a=new Vector2,o=new Vector2,i=new Vector2,s=new Vector2,n=new Vector2,d=new Vector2,l=new Vector2,c=new Vector2,u=new Vector2,p=new Vector2,y=new Vector2,x=new Vector2,h=new Vector2,f=new Vector2;return function(V,g,m,b,v,k,S,A){m=void 0!==m?m:12,b=void 0!==b?b:.001,A=void 0!==A?A:0;var w=(V=function removeDuplicatedPoints(e){for(var t=!1,r=1,a=e.length-1;r<a;r++)if(e[r].distanceTo(e[r+1])<b){t=!0;break}if(!t)return e;var o=[];o.push(e[0]);for(r=1,a=e.length-1;r<a;r++)e[r].distanceTo(e[r+1])>=b&&o.push(e[r]);return o.push(e[e.length-1]),o}(V)).length;if(w<2)return 0;var M,T,F,C,W,P=V[0].equals(V[w-1]),L=V[0],U=g.strokeWidth/2,N=1/(w-1),R=0,z=!1,B=0,G=3*A,q=2*A;getNormal(V[0],V[1],e).multiplyScalar(U),n.copy(V[0]).sub(e),d.copy(V[0]).add(e),l.copy(n),c.copy(d);for(var O=1;O<w;O++){M=V[O],T=O===w-1?P?V[1]:void 0:V[O+1];var I=e;getNormal(L,M,I),r.copy(I).multiplyScalar(U),u.copy(M).sub(r),p.copy(M).add(r);var j=R+N;if(F=!1,void 0!==T){getNormal(M,T,t),r.copy(t).multiplyScalar(U),y.copy(M).sub(r),x.copy(M).add(r),C=!0,r.subVectors(T,L),I.dot(r)<0&&(C=!1),1===O&&(z=C),r.subVectors(T,M),r.normalize();var E=Math.abs(I.dot(r));if(0!==E){var J=U/E;r.multiplyScalar(-J),a.subVectors(M,L),o.copy(a).setLength(J).add(r),h.copy(o).negate();var D=o.length(),X=a.length();a.divideScalar(X),i.subVectors(T,M);var Y=i.length();switch(i.divideScalar(Y),a.dot(h)<X&&i.dot(h)<Y&&(F=!0),f.copy(o).add(M),h.add(M),W=!1,F?C?(x.copy(h),p.copy(h)):(y.copy(h),u.copy(h)):makeSegmentTriangles(),g.strokeLineJoin){case"bevel":makeSegmentWithBevelJoin(C,F,j);break;case"round":createSegmentTrianglesWithMiddleSection(C,F),C?makeCircularSector(M,u,y,j,0):makeCircularSector(M,x,p,j,1);break;default:var H=U*g.strokeMiterLimit/D;if(H<1){if("miter-clip"!==g.strokeLineJoin){makeSegmentWithBevelJoin(C,F,j);break}createSegmentTrianglesWithMiddleSection(C,F),C?(i.subVectors(f,u).multiplyScalar(H).add(u),s.subVectors(f,y).multiplyScalar(H).add(y),addVertex(u,j,0),addVertex(i,j,0),addVertex(M,j,.5),addVertex(M,j,.5),addVertex(i,j,0),addVertex(s,j,0),addVertex(M,j,.5),addVertex(s,j,0),addVertex(y,j,0)):(i.subVectors(f,p).multiplyScalar(H).add(p),s.subVectors(f,x).multiplyScalar(H).add(x),addVertex(p,j,1),addVertex(i,j,1),addVertex(M,j,.5),addVertex(M,j,.5),addVertex(i,j,1),addVertex(s,j,1),addVertex(M,j,.5),addVertex(s,j,1),addVertex(x,j,1))}else F?(C?(addVertex(d,R,1),addVertex(n,R,0),addVertex(f,j,0),addVertex(d,R,1),addVertex(f,j,0),addVertex(h,j,1)):(addVertex(d,R,1),addVertex(n,R,0),addVertex(f,j,1),addVertex(n,R,0),addVertex(h,j,0),addVertex(f,j,1)),C?y.copy(f):x.copy(f)):C?(addVertex(u,j,0),addVertex(f,j,0),addVertex(M,j,.5),addVertex(M,j,.5),addVertex(f,j,0),addVertex(y,j,0)):(addVertex(p,j,1),addVertex(f,j,1),addVertex(M,j,.5),addVertex(M,j,.5),addVertex(f,j,1),addVertex(x,j,1)),W=!0}}else makeSegmentTriangles()}else makeSegmentTriangles();P||O!==w-1||addCapGeometry(V[0],l,c,C,!0,R),R=j,L=M,n.copy(y),d.copy(x)}if(P){if(F&&v){var Q=f,Z=h;z!==C&&(Q=h,Z=f),C?(W||z)&&(Z.toArray(v,0),Z.toArray(v,9),W&&Q.toArray(v,3)):!W&&z||(Z.toArray(v,3),Z.toArray(v,9),W&&Q.toArray(v,0))}}else addCapGeometry(M,u,p,C,!1,j);return B;function getNormal(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function addVertex(e,t,r){v&&(v[G]=e.x,v[G+1]=e.y,v[G+2]=0,k&&(k[G]=0,k[G+1]=0,k[G+2]=1),G+=3,S&&(S[q]=t,S[q+1]=r,q+=2)),B+=3}function makeCircularSector(o,i,s,n,d){e.copy(i).sub(o).normalize(),t.copy(s).sub(o).normalize();var l=Math.PI,c=e.dot(t);Math.abs(c)<1&&(l=Math.abs(Math.acos(c))),l/=m,r.copy(i);for(var u=0,p=m-1;u<p;u++)a.copy(r).rotateAround(o,l),addVertex(r,n,d),addVertex(a,n,d),addVertex(o,n,.5),r.copy(a);addVertex(a,n,d),addVertex(s,n,d),addVertex(o,n,.5)}function makeSegmentTriangles(){addVertex(d,R,1),addVertex(n,R,0),addVertex(u,j,0),addVertex(d,R,1),addVertex(u,j,1),addVertex(p,j,0)}function makeSegmentWithBevelJoin(e,t,r){t?e?(addVertex(d,R,1),addVertex(n,R,0),addVertex(u,j,0),addVertex(d,R,1),addVertex(u,j,0),addVertex(h,j,1),addVertex(u,r,0),addVertex(y,r,0),addVertex(h,r,.5)):(addVertex(d,R,1),addVertex(n,R,0),addVertex(p,j,1),addVertex(n,R,0),addVertex(h,j,0),addVertex(p,j,1),addVertex(p,r,1),addVertex(x,r,0),addVertex(h,r,.5)):e?(addVertex(u,r,0),addVertex(y,r,0),addVertex(M,r,.5)):(addVertex(p,r,1),addVertex(x,r,0),addVertex(M,r,.5))}function createSegmentTrianglesWithMiddleSection(e,t){t&&(e?(addVertex(d,R,1),addVertex(n,R,0),addVertex(u,j,0),addVertex(d,R,1),addVertex(u,j,0),addVertex(h,j,1),addVertex(u,R,0),addVertex(M,j,.5),addVertex(h,j,1),addVertex(M,j,.5),addVertex(y,R,0),addVertex(h,j,1)):(addVertex(d,R,1),addVertex(n,R,0),addVertex(p,j,1),addVertex(n,R,0),addVertex(h,j,0),addVertex(p,j,1),addVertex(p,R,1),addVertex(h,j,0),addVertex(M,j,.5),addVertex(M,j,.5),addVertex(h,j,0),addVertex(x,R,1)))}function addCapGeometry(o,i,s,n,d,l){switch(g.strokeLineCap){case"round":d?makeCircularSector(o,s,i,l,.5):makeCircularSector(o,i,s,l,.5);break;case"square":if(d)e.subVectors(i,o),t.set(e.y,-e.x),r.addVectors(e,t).add(o),a.subVectors(t,e).add(o),n?(r.toArray(v,3),a.toArray(v,0),a.toArray(v,9)):(r.toArray(v,3),r.toArray(v,9),a.toArray(v,0));else{e.subVectors(s,o),t.set(e.y,-e.x),r.addVectors(e,t).add(o),a.subVectors(t,e).add(o);var c=v.length;n?(r.toArray(v,c-3),a.toArray(v,c-6),a.toArray(v,c-12)):(r.toArray(v,c-6),a.toArray(v,c-3),a.toArray(v,c-12))}}}}}();export{SVGLoader};