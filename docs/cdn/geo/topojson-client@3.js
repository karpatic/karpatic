!function(l,h){"object"==typeof exports&&"undefined"!=typeof module?h(exports):"function"==typeof define&&define.amd?define(["exports"],h):h((l=l||self).topojson=l.topojson||{})}(this,(function(l){"use strict";function t(l){return l}function r(l){if(null==l)return t;var h,p,d=l.scale[0],m=l.scale[1],b=l.translate[0],v=l.translate[1];return function(l,E){E||(h=p=0);var P=2,M=l.length,k=new Array(M);for(k[0]=(h+=l[0])*d+b,k[1]=(p+=l[1])*m+v;P<M;)k[P]=l[P],++P;return k}}function n(l){var h,p=r(l.transform),d=1/0,m=d,b=-d,v=-d;function u(l){(l=p(l))[0]<d&&(d=l[0]),l[0]>b&&(b=l[0]),l[1]<m&&(m=l[1]),l[1]>v&&(v=l[1])}function f(l){switch(l.type){case"GeometryCollection":l.geometries.forEach(f);break;case"Point":u(l.coordinates);break;case"MultiPoint":l.coordinates.forEach(u)}}for(h in l.arcs.forEach((function(l){for(var h,E=-1,P=l.length;++E<P;)(h=p(l[E],E))[0]<d&&(d=h[0]),h[0]>b&&(b=h[0]),h[1]<m&&(m=h[1]),h[1]>v&&(v=h[1])})),l.objects)f(l.objects[h]);return[d,m,b,v]}function o(l,h){var p=h.id,d=h.bbox,m=null==h.properties?{}:h.properties,b=a(l,h);return null==p&&null==d?{type:"Feature",properties:m,geometry:b}:null==d?{type:"Feature",id:p,properties:m,geometry:b}:{type:"Feature",id:p,bbox:d,properties:m,geometry:b}}function a(l,h){var p=r(l.transform),d=l.arcs;function a(l,h){h.length&&h.pop();for(var m=d[l<0?~l:l],b=0,v=m.length;b<v;++b)h.push(p(m[b],b));l<0&&function(l,h){for(var p,d=l.length,m=d-h;m<--d;)p=l[m],l[m++]=l[d],l[d]=p}(h,v)}function i(l){return p(l)}function c(l){for(var h=[],p=0,d=l.length;p<d;++p)a(l[p],h);return h.length<2&&h.push(h[0]),h}function u(l){for(var h=c(l);h.length<4;)h.push(h[0]);return h}function f(l){return l.map(u)}return function e(l){var h,p=l.type;switch(p){case"GeometryCollection":return{type:p,geometries:l.geometries.map(e)};case"Point":h=i(l.coordinates);break;case"MultiPoint":h=l.coordinates.map(i);break;case"LineString":h=c(l.arcs);break;case"MultiLineString":h=l.arcs.map(c);break;case"Polygon":h=f(l.arcs);break;case"MultiPolygon":h=l.arcs.map(f);break;default:return null}return{type:p,coordinates:h}}(h)}function i(l,h){var p={},d={},m={},b=[],v=-1;function c(l,h){for(var d in l){var m=l[d];delete h[m.start],delete m.start,delete m.end,m.forEach((function(l){p[l<0?~l:l]=1})),b.push(m)}}return h.forEach((function(p,d){var m,b=l.arcs[p<0?~p:p];b.length<3&&!b[1][0]&&!b[1][1]&&(m=h[++v],h[v]=p,h[d]=m)})),h.forEach((function(h){var p,b,v=function(h){var p,d=l.arcs[h<0?~h:h],m=d[0];return l.transform?(p=[0,0],d.forEach((function(l){p[0]+=l[0],p[1]+=l[1]}))):p=d[d.length-1],h<0?[p,m]:[m,p]}(h),E=v[0],P=v[1];if(p=m[E])if(delete m[p.end],p.push(h),p.end=P,b=d[P]){delete d[b.start];var M=b===p?p:p.concat(b);d[M.start=p.start]=m[M.end=b.end]=M}else d[p.start]=m[p.end]=p;else if(p=d[P])if(delete d[p.start],p.unshift(h),p.start=E,b=m[E]){delete m[b.end];var k=b===p?p:b.concat(p);d[k.start=b.start]=m[k.end=p.end]=k}else d[p.start]=m[p.end]=p;else d[(p=[h]).start=E]=m[p.end=P]=p})),c(m,d),c(d,m),h.forEach((function(l){p[l<0?~l:l]||b.push([l])})),b}function c(l,h,p){var d,m,b;if(arguments.length>1)d=function(l,h,p){var d,m=[],b=[];function i(l){var h=l<0?~l:l;(b[h]||(b[h]=[])).push({i:l,g:d})}function c(l){l.forEach(i)}function u(l){l.forEach(c)}return function e(l){switch(d=l,l.type){case"GeometryCollection":l.geometries.forEach(e);break;case"LineString":c(l.arcs);break;case"MultiLineString":case"Polygon":u(l.arcs);break;case"MultiPolygon":!function(l){l.forEach(u)}(l.arcs)}}(h),b.forEach(null==p?function(l){m.push(l[0].i)}:function(l){p(l[0].g,l[l.length-1].g)&&m.push(l[0].i)}),m}(0,h,p);else for(m=0,d=new Array(b=l.arcs.length);m<b;++m)d[m]=m;return{type:"MultiLineString",arcs:i(l,d)}}function u(l,h){var p={},d=[],m=[];function c(l){l.forEach((function(h){h.forEach((function(h){(p[h=h<0?~h:h]||(p[h]=[])).push(l)}))})),d.push(l)}function u(h){return function(l){for(var h,p=-1,d=l.length,m=l[d-1],b=0;++p<d;)h=m,m=l[p],b+=h[0]*m[1]-h[1]*m[0];return Math.abs(b)}(a(l,{type:"Polygon",arcs:[h]}).coordinates[0])}return h.forEach((function e(l){switch(l.type){case"GeometryCollection":l.geometries.forEach(e);break;case"Polygon":c(l.arcs);break;case"MultiPolygon":l.arcs.forEach(c)}})),d.forEach((function(l){if(!l._){var h=[],d=[l];for(l._=1,m.push(h);l=d.pop();)h.push(l),l.forEach((function(l){l.forEach((function(l){p[l<0?~l:l].forEach((function(l){l._||(l._=1,d.push(l))}))}))}))}})),d.forEach((function(l){delete l._})),{type:"MultiPolygon",arcs:m.map((function(h){var d,m=[];if(h.forEach((function(l){l.forEach((function(l){l.forEach((function(l){p[l<0?~l:l].length<2&&m.push(l)}))}))})),(d=(m=i(l,m)).length)>1)for(var b,v,E=1,P=u(m[0]);E<d;++E)(b=u(m[E]))>P&&(v=m[0],m[0]=m[E],m[E]=v,P=b);return m})).filter((function(l){return l.length>0}))}}function f(l,h){for(var p=0,d=l.length;p<d;){var m=p+d>>>1;l[m]<h?p=m+1:d=m}return p}function s(l){if(null==l)return t;var h,p,d=l.scale[0],m=l.scale[1],b=l.translate[0],v=l.translate[1];return function(l,E){E||(h=p=0);var P=2,M=l.length,k=new Array(M),w=Math.round((l[0]-b)/d),x=Math.round((l[1]-v)/m);for(k[0]=w-h,h=w,k[1]=x-p,p=x;P<M;)k[P]=l[P],++P;return k}}l.bbox=n,l.feature=function(l,h){return"string"==typeof h&&(h=l.objects[h]),"GeometryCollection"===h.type?{type:"FeatureCollection",features:h.geometries.map((function(h){return o(l,h)}))}:o(l,h)},l.merge=function(l){return a(l,u.apply(this,arguments))},l.mergeArcs=u,l.mesh=function(l){return a(l,c.apply(this,arguments))},l.meshArcs=c,l.neighbors=function(l){var h={},p=l.map((function(){return[]}));function n(l,p){l.forEach((function(l){l<0&&(l=~l);var d=h[l];d?d.push(p):h[l]=[p]}))}function o(l,h){l.forEach((function(l){n(l,h)}))}var d={LineString:n,MultiLineString:o,Polygon:o,MultiPolygon:function(l,h){l.forEach((function(l){o(l,h)}))}};for(var m in l.forEach((function e(l,h){"GeometryCollection"===l.type?l.geometries.forEach((function(l){e(l,h)})):l.type in d&&d[l.type](l.arcs,h)})),h)for(var b=h[m],v=b.length,E=0;E<v;++E)for(var P=E+1;P<v;++P){var M,k=b[E],w=b[P];(M=p[k])[m=f(M,w)]!==w&&M.splice(m,0,w),(M=p[w])[m=f(M,k)]!==k&&M.splice(m,0,k)}return p},l.quantize=function(l,h){if(l.transform)throw new Error("already quantized");if(h&&h.scale)E=l.bbox;else{if(!((p=Math.floor(h))>=2))throw new Error("n must be â‰¥2");var p,d=(E=l.bbox||n(l))[0],m=E[1],b=E[2],v=E[3];h={scale:[b-d?(b-d)/(p-1):1,v-m?(v-m)/(p-1):1],translate:[d,m]}}var E,P,M=s(h),k=l.objects,w={};function g(l){return M(l)}function y(l){var h;switch(l.type){case"GeometryCollection":h={type:"GeometryCollection",geometries:l.geometries.map(y)};break;case"Point":h={type:"Point",coordinates:g(l.coordinates)};break;case"MultiPoint":h={type:"MultiPoint",coordinates:l.coordinates.map(g)};break;default:return l}return null!=l.id&&(h.id=l.id),null!=l.bbox&&(h.bbox=l.bbox),null!=l.properties&&(h.properties=l.properties),h}for(P in k)w[P]=y(k[P]);return{type:"Topology",bbox:E,transform:h,objects:w,arcs:l.arcs.map((function(l){var h,p=0,d=1,m=l.length,b=new Array(m);for(b[0]=M(l[0],0);++p<m;)((h=M(l[p],p))[0]||h[1])&&(b[d++]=h);return 1===d&&(b[d++]=[0,0]),b.length=d,b}))}},l.transform=r,l.untransform=s,Object.defineProperty(l,"__esModule",{value:!0})}));