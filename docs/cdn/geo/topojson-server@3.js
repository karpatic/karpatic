!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((r=r||self).topojson=r.topojson||{})}(this,(function(r){"use strict";var n=Object.prototype.hasOwnProperty;function t(r,n,o,i,x,w){3===arguments.length&&(i=w=Array,x=null);for(var L=new i(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),S=new w(r),C=r-1,j=0;j<r;++j)L[j]=x;return{set:function(i,w){for(var j=n(i)&C,G=L[j],I=0;G!=x;){if(o(G,i))return S[j]=w;if(++I>=r)throw new Error("full hashmap");G=L[j=j+1&C]}return L[j]=i,S[j]=w,w},maybeSet:function(i,w){for(var j=n(i)&C,G=L[j],I=0;G!=x;){if(o(G,i))return S[j];if(++I>=r)throw new Error("full hashmap");G=L[j=j+1&C]}return L[j]=i,S[j]=w,w},get:function(i,w){for(var j=n(i)&C,G=L[j],I=0;G!=x;){if(o(G,i))return S[j];if(++I>=r)break;G=L[j=j+1&C]}return w},keys:function(){for(var r=[],n=0,o=L.length;n<o;++n){var i=L[n];i!=x&&r.push(i)}return r}}}function e(r,n){return r[0]===n[0]&&r[1]===n[1]}var o=new ArrayBuffer(16),i=new Float64Array(o),x=new Uint32Array(o);function u(r){i[0]=r[0],i[1]=r[1];var n=x[0]^x[1];return 2147483647&(n<<5^n>>7^x[2]^x[3])}function f(r){var n,o,i,x,w=r.coordinates,L=r.lines,S=r.rings,C=function(){for(var r=t(1.4*w.length,A,E,Int32Array,-1,Int32Array),n=new Int32Array(w.length),o=0,i=w.length;o<i;++o)n[o]=r.maybeSet(o,o);return n}(),j=new Int32Array(w.length),G=new Int32Array(w.length),I=new Int32Array(w.length),k=new Int8Array(w.length),F=0;for(n=0,o=w.length;n<o;++n)j[n]=G[n]=I[n]=-1;for(n=0,o=L.length;n<o;++n){var O=L[n],N=O[0],_=O[1];for(i=C[N],x=C[++N],++F,k[i]=1;++N<=_;)P(n,i,i=x,x=C[N]);++F,k[x]=1}for(n=0,o=w.length;n<o;++n)j[n]=-1;for(n=0,o=S.length;n<o;++n){var B=S[n],T=B[0]+1,U=B[1];for(P(n,C[U-1],i=C[T-1],x=C[T]);++T<=U;)P(n,i,i=x,x=C[T])}function P(r,n,o,i){if(j[o]!==r){j[o]=r;var x=G[o];if(x>=0){var w=I[o];x===n&&w===i||x===i&&w===n||(++F,k[o]=1)}else G[o]=n,I[o]=i}}function A(r){return u(w[r])}function E(r,n){return e(w[r],w[n])}j=G=I=null;var q,z=function(r,n,o,i,x){3===arguments.length&&(i=Array,x=null);for(var w=new i(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),L=r-1,S=0;S<r;++S)w[S]=x;return{add:function(i){for(var S=n(i)&L,C=w[S],j=0;C!=x;){if(o(C,i))return!0;if(++j>=r)throw new Error("full hashset");C=w[S=S+1&L]}return w[S]=i,!0},has:function(i){for(var S=n(i)&L,C=w[S],j=0;C!=x;){if(o(C,i))return!0;if(++j>=r)break;C=w[S=S+1&L]}return!1},values:function(){for(var r=[],n=0,o=w.length;n<o;++n){var i=w[n];i!=x&&r.push(i)}return r}}}(1.4*F,u,e);for(n=0,o=w.length;n<o;++n)k[q=C[n]]&&z.add(w[q]);return z}function c(r,n,o){for(var i,x=n+(o---n>>1);n<x;++n,--o)i=r[n],r[n]=r[o],r[o]=i}function l(r){var n,o=s(r.geometry);for(n in null!=r.id&&(o.id=r.id),null!=r.bbox&&(o.bbox=r.bbox),r.properties){o.properties=r.properties;break}return o}function s(r){if(null==r)return{type:null};var n="GeometryCollection"===r.type?{type:"GeometryCollection",geometries:r.geometries.map(s)}:"Point"===r.type||"MultiPoint"===r.type?{type:r.type,coordinates:r.coordinates}:{type:r.type,arcs:r.coordinates};return null!=r.bbox&&(n.bbox=r.bbox),n}function h(r){var n,o=r[0],i=r[1];return i<o&&(n=o,o=i,i=n),o+31*i}function g(r,n){var o,i=r[0],x=r[1],w=n[0],L=n[1];return x<i&&(o=i,i=x,x=o),L<w&&(o=w,w=L,L=o),i===w&&x===L}r.topology=function(r,o){var i=function(r){var o=1/0,i=1/0,x=-1/0,w=-1/0;function a(r){null!=r&&n.call(L,r.type)&&L[r.type](r)}var L={GeometryCollection:function(r){r.geometries.forEach(a)},Point:function(r){f(r.coordinates)},MultiPoint:function(r){r.coordinates.forEach(f)},LineString:function(r){c(r.arcs)},MultiLineString:function(r){r.arcs.forEach(c)},Polygon:function(r){r.arcs.forEach(c)},MultiPolygon:function(r){r.arcs.forEach(l)}};function f(r){var n=r[0],L=r[1];n<o&&(o=n),n>x&&(x=n),L<i&&(i=L),L>w&&(w=L)}function c(r){r.forEach(f)}function l(r){r.forEach(c)}for(var S in r)a(r[S]);return x>=o&&w>=i?[o,i,x,w]:void 0}(r=function(r){var n,o,i={};for(n in r)i[n]=null==(o=r[n])?{type:null}:("FeatureCollection"===o.type?function(r){var n={type:"GeometryCollection",geometries:r.features.map(l)};return null!=r.bbox&&(n.bbox=r.bbox),n}:"Feature"===o.type?l:s)(o);return i}(r)),x=o>0&&i&&function(r,o,i){var x=o[0],w=o[1],L=o[2],S=o[3],C=L-x?(i-1)/(L-x):1,j=S-w?(i-1)/(S-w):1;function l(r){return[Math.round((r[0]-x)*C),Math.round((r[1]-w)*j)]}function s(r,n){for(var o,i,L,S,G,I=-1,k=0,F=r.length,O=new Array(F);++I<F;)o=r[I],S=Math.round((o[0]-x)*C),G=Math.round((o[1]-w)*j),S===i&&G===L||(O[k++]=[i=S,L=G]);for(O.length=k;k<n;)k=O.push([O[0][0],O[0][1]]);return O}function h(r){return s(r,2)}function g(r){return s(r,4)}function v(r){return r.map(g)}function p(r){null!=r&&n.call(G,r.type)&&G[r.type](r)}var G={GeometryCollection:function(r){r.geometries.forEach(p)},Point:function(r){r.coordinates=l(r.coordinates)},MultiPoint:function(r){r.coordinates=r.coordinates.map(l)},LineString:function(r){r.arcs=h(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(h)},Polygon:function(r){r.arcs=v(r.arcs)},MultiPolygon:function(r){r.arcs=r.arcs.map(v)}};for(var I in r)p(r[I]);return{scale:[1/C,1/j],translate:[x,w]}}(r,i,o),w=function(r){var n,o,i,x,w=r.coordinates,L=r.lines,S=r.rings,C=L.length+S.length;for(delete r.lines,delete r.rings,i=0,x=L.length;i<x;++i)for(n=L[i];n=n.next;)++C;for(i=0,x=S.length;i<x;++i)for(o=S[i];o=o.next;)++C;var j=t(2*C*1.4,u,e),G=r.arcs=[];for(i=0,x=L.length;i<x;++i){n=L[i];do{v(n)}while(n=n.next)}for(i=0,x=S.length;i<x;++i)if((o=S[i]).next)do{v(o)}while(o=o.next);else p(o);function v(r){var n,o,i,x,L,S,C,I;if(i=j.get(n=w[r[0]]))for(C=0,I=i.length;C<I;++C)if(y(x=i[C],r))return r[0]=x[0],void(r[1]=x[1]);if(L=j.get(o=w[r[1]]))for(C=0,I=L.length;C<I;++C)if(d(S=L[C],r))return r[1]=S[0],void(r[0]=S[1]);i?i.push(r):j.set(n,[r]),L?L.push(r):j.set(o,[r]),G.push(r)}function p(r){var n,o,i,x,L;if(o=j.get(w[r[0]]))for(x=0,L=o.length;x<L;++x){if(m(i=o[x],r))return r[0]=i[0],void(r[1]=i[1]);if(b(i,r))return r[0]=i[1],void(r[1]=i[0])}if(o=j.get(n=w[r[0]+M(r)]))for(x=0,L=o.length;x<L;++x){if(m(i=o[x],r))return r[0]=i[0],void(r[1]=i[1]);if(b(i,r))return r[0]=i[1],void(r[1]=i[0])}o?o.push(r):j.set(n,[r]),G.push(r)}function y(r,n){var o=r[0],i=n[0],x=r[1];if(o-x!=i-n[1])return!1;for(;o<=x;++o,++i)if(!e(w[o],w[i]))return!1;return!0}function d(r,n){var o=r[0],i=n[0],x=r[1],L=n[1];if(o-x!=i-L)return!1;for(;o<=x;++o,--L)if(!e(w[o],w[L]))return!1;return!0}function m(r,n){var o=r[0],i=n[0],x=r[1]-o;if(x!==n[1]-i)return!1;for(var L=M(r),S=M(n),C=0;C<x;++C)if(!e(w[o+(C+L)%x],w[i+(C+S)%x]))return!1;return!0}function b(r,n){var o=r[0],i=n[0],x=r[1],L=n[1],S=x-o;if(S!==L-i)return!1;for(var C=M(r),j=S-M(n),G=0;G<S;++G)if(!e(w[o+(G+C)%S],w[L-(G+j)%S]))return!1;return!0}function M(r){for(var n=r[0],o=r[1],i=n,x=i,L=w[i];++i<o;){var S=w[i];(S[0]<L[0]||S[0]===L[0]&&S[1]<L[1])&&(x=i,L=S)}return x-n}return r}(function(r){var n,o,i,x,w,L,S,C=f(r),j=r.coordinates,G=r.lines,I=r.rings;for(o=0,i=G.length;o<i;++o)for(var k=G[o],F=k[0],O=k[1];++F<O;)C.has(j[F])&&(n={0:F,1:k[1]},k[1]=F,k=k.next=n);for(o=0,i=I.length;o<i;++o)for(var N=I[o],_=N[0],B=_,T=N[1],U=C.has(j[_]);++B<T;)C.has(j[B])&&(U?(n={0:B,1:N[1]},N[1]=B,N=N.next=n):(S=T-B,c(x=j,w=_,L=T),c(x,w,w+S),c(x,w+S,L),j[T]=j[_],U=!0,B=_));return r}(function(r){var o=-1,i=[],x=[],w=[];function a(r){r&&n.call(L,r.type)&&L[r.type](r)}var L={GeometryCollection:function(r){r.geometries.forEach(a)},LineString:function(r){r.arcs=f(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(f)},Polygon:function(r){r.arcs=r.arcs.map(c)},MultiPolygon:function(r){r.arcs=r.arcs.map(l)}};function f(r){for(var n=0,x=r.length;n<x;++n)w[++o]=r[n];var L={0:o-x+1,1:o};return i.push(L),L}function c(r){for(var n=0,i=r.length;n<i;++n)w[++o]=r[n];var L={0:o-i+1,1:o};return x.push(L),L}function l(r){return r.map(c)}for(var S in r)a(r[S]);return{type:"Topology",coordinates:w,lines:i,rings:x,objects:r}}(r))),L=w.coordinates,S=t(1.4*w.arcs.length,h,g);function d(r){r&&n.call(C,r.type)&&C[r.type](r)}r=w.objects,w.bbox=i,w.arcs=w.arcs.map((function(r,n){return S.set(r,n),L.slice(r[0],r[1]+1)})),delete w.coordinates,L=null;var C={GeometryCollection:function(r){r.geometries.forEach(d)},LineString:function(r){r.arcs=b(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(b)},Polygon:function(r){r.arcs=r.arcs.map(b)},MultiPolygon:function(r){r.arcs=r.arcs.map(M)}};function b(r){var n=[];do{var o=S.get(r);n.push(r[0]<r[1]?o:~o)}while(r=r.next);return n}function M(r){return r.map(b)}for(var j in r)d(r[j]);return x&&(w.transform=x,w.arcs=function(r){for(var n=-1,o=r.length;++n<o;){for(var i,x,w=r[n],L=0,S=1,C=w.length,j=w[0],G=j[0],I=j[1];++L<C;)i=(j=w[L])[0],x=j[1],i===G&&x===I||(w[S++]=[i-G,x-I],G=i,I=x);1===S&&(w[S++]=[0,0]),w.length=S}return r}(w.arcs)),w},Object.defineProperty(r,"__esModule",{value:!0})}));