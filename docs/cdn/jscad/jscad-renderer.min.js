!function(W){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=W();else if("function"==typeof define&&define.amd)define([],W);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).jscadReglRenderer=W()}}((function(){return function r(W,Z,K){function o(ee,te){if(!Z[ee]){if(!W[ee]){var re="function"==typeof require&&require;if(!te&&re)return re(ee,!0);if($)return $(ee,!0);var ne=new Error("Cannot find module '"+ee+"'");throw ne.code="MODULE_NOT_FOUND",ne}var ie=Z[ee]={exports:{}};W[ee][0].call(ie.exports,(function(Z){return o(W[ee][1][Z]||Z)}),ie,ie.exports,r,W,Z,K)}return Z[ee].exports}for(var $="function"==typeof require&&require,ee=0;ee<K.length;ee++)o(K[ee]);return o}({1:[function(W,Z,K){const flatten=W=>W.reduce(((W,Z)=>Array.isArray(Z)?W.concat(flatten(Z)):W.concat(Z)),[]);Z.exports=flatten},{}],2:[function(W,Z,K){Z.exports=(W,Z)=>W-Z},{}],3:[function(W,Z,K){Z.exports=W=>{if(Array.isArray(W)&&0!==W.length)return W[0]}},{}],4:[function(W,Z,K){Z.exports={flatten:W("./flatten"),fnNumberSort:W("./fnNumberSort"),head:W("./head"),insertSorted:W("./insertSorted"),nth:W("./nth"),padToLength:W("./padToLength"),toArray:W("./toArray")}},{"./flatten":1,"./fnNumberSort":2,"./head":3,"./insertSorted":5,"./nth":6,"./padToLength":7,"./toArray":8}],5:[function(W,Z,K){Z.exports=(W,Z,K)=>{let $=0,ee=W.length;for(;ee>$;){const te=Math.floor(($+ee)/2);K(Z,W[te])>0?$=te+1:ee=te}return W.splice($,0,Z),W}},{}],6:[function(W,Z,K){Z.exports=(W,Z)=>{if(Array.isArray(W)&&!(W.length<Z))return W[Z]}},{}],7:[function(W,Z,K){Z.exports=(W,Z,K)=>{for(W=W.slice();W.length<K;)W.push(Z);return W}},{}],8:[function(W,Z,K){Z.exports=W=>Array.isArray(W)?W:null==W?[]:[W]},{}],9:[function(W,Z,K){var $=W("./lib/projectMat4");Z.exports=function unproject(W,Z,K,ee){var te=K[0],re=K[1],ne=K[2],ie=K[3],oe=Z[0],ae=Z[1],se=Z[2];return oe-=te,ae=ie-ae-1,ae-=re,W[0]=2*oe/ne-1,W[1]=2*ae/ie-1,W[2]=2*se-1,$(W,W,ee)}},{"./lib/projectMat4":10}],10:[function(W,Z,K){Z.exports=function project(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=K[0],ne=K[1],ie=K[2],oe=K[3],ae=K[4],se=K[5],fe=K[6],ue=K[7],ce=K[8],le=K[9],pe=K[10],de=K[11],he=K[12],me=K[13],ge=K[14],ve=1/($*oe+ee*ue+te*de+K[15]);return W[0]=($*re+ee*ae+te*ce+he)*ve,W[1]=($*ne+ee*se+te*le+me)*ve,W[2]=($*ie+ee*fe+te*pe+ge)*ve,W}},{}],11:[function(W,Z,K){Z.exports=function adjoint(W,Z){var K=Z[0],$=Z[1],ee=Z[2],te=Z[3],re=Z[4],ne=Z[5],ie=Z[6],oe=Z[7],ae=Z[8],se=Z[9],fe=Z[10],ue=Z[11],ce=Z[12],le=Z[13],pe=Z[14],de=Z[15];return W[0]=ne*(fe*de-ue*pe)-se*(ie*de-oe*pe)+le*(ie*ue-oe*fe),W[1]=-($*(fe*de-ue*pe)-se*(ee*de-te*pe)+le*(ee*ue-te*fe)),W[2]=$*(ie*de-oe*pe)-ne*(ee*de-te*pe)+le*(ee*oe-te*ie),W[3]=-($*(ie*ue-oe*fe)-ne*(ee*ue-te*fe)+se*(ee*oe-te*ie)),W[4]=-(re*(fe*de-ue*pe)-ae*(ie*de-oe*pe)+ce*(ie*ue-oe*fe)),W[5]=K*(fe*de-ue*pe)-ae*(ee*de-te*pe)+ce*(ee*ue-te*fe),W[6]=-(K*(ie*de-oe*pe)-re*(ee*de-te*pe)+ce*(ee*oe-te*ie)),W[7]=K*(ie*ue-oe*fe)-re*(ee*ue-te*fe)+ae*(ee*oe-te*ie),W[8]=re*(se*de-ue*le)-ae*(ne*de-oe*le)+ce*(ne*ue-oe*se),W[9]=-(K*(se*de-ue*le)-ae*($*de-te*le)+ce*($*ue-te*se)),W[10]=K*(ne*de-oe*le)-re*($*de-te*le)+ce*($*oe-te*ne),W[11]=-(K*(ne*ue-oe*se)-re*($*ue-te*se)+ae*($*oe-te*ne)),W[12]=-(re*(se*pe-fe*le)-ae*(ne*pe-ie*le)+ce*(ne*fe-ie*se)),W[13]=K*(se*pe-fe*le)-ae*($*pe-ee*le)+ce*($*fe-ee*se),W[14]=-(K*(ne*pe-ie*le)-re*($*pe-ee*le)+ce*($*ie-ee*ne)),W[15]=K*(ne*fe-ie*se)-re*($*fe-ee*se)+ae*($*ie-ee*ne),W}},{}],12:[function(W,Z,K){Z.exports=function clone(W){var Z=new Float32Array(16);return Z[0]=W[0],Z[1]=W[1],Z[2]=W[2],Z[3]=W[3],Z[4]=W[4],Z[5]=W[5],Z[6]=W[6],Z[7]=W[7],Z[8]=W[8],Z[9]=W[9],Z[10]=W[10],Z[11]=W[11],Z[12]=W[12],Z[13]=W[13],Z[14]=W[14],Z[15]=W[15],Z}},{}],13:[function(W,Z,K){Z.exports=function copy(W,Z){return W[0]=Z[0],W[1]=Z[1],W[2]=Z[2],W[3]=Z[3],W[4]=Z[4],W[5]=Z[5],W[6]=Z[6],W[7]=Z[7],W[8]=Z[8],W[9]=Z[9],W[10]=Z[10],W[11]=Z[11],W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15],W}},{}],14:[function(W,Z,K){Z.exports=function create(){var W=new Float32Array(16);return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],15:[function(W,Z,K){Z.exports=function determinant(W){var Z=W[0],K=W[1],$=W[2],ee=W[3],te=W[4],re=W[5],ne=W[6],ie=W[7],oe=W[8],ae=W[9],se=W[10],fe=W[11],ue=W[12],ce=W[13],le=W[14],pe=W[15];return(Z*re-K*te)*(se*pe-fe*le)-(Z*ne-$*te)*(ae*pe-fe*ce)+(Z*ie-ee*te)*(ae*le-se*ce)+(K*ne-$*re)*(oe*pe-fe*ue)-(K*ie-ee*re)*(oe*le-se*ue)+($*ie-ee*ne)*(oe*ce-ae*ue)}},{}],16:[function(W,Z,K){Z.exports=function fromQuat(W,Z){var K=Z[0],$=Z[1],ee=Z[2],te=Z[3],re=K+K,ne=$+$,ie=ee+ee,oe=K*re,ae=$*re,se=$*ne,fe=ee*re,ue=ee*ne,ce=ee*ie,le=te*re,pe=te*ne,de=te*ie;return W[0]=1-se-ce,W[1]=ae+de,W[2]=fe-pe,W[3]=0,W[4]=ae-de,W[5]=1-oe-ce,W[6]=ue+le,W[7]=0,W[8]=fe+pe,W[9]=ue-le,W[10]=1-oe-se,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],17:[function(W,Z,K){Z.exports=function fromRotation(W,Z,K){var $,ee,te,re=K[0],ne=K[1],ie=K[2],oe=Math.sqrt(re*re+ne*ne+ie*ie);return Math.abs(oe)<1e-6?null:(re*=oe=1/oe,ne*=oe,ie*=oe,$=Math.sin(Z),te=1-(ee=Math.cos(Z)),W[0]=re*re*te+ee,W[1]=ne*re*te+ie*$,W[2]=ie*re*te-ne*$,W[3]=0,W[4]=re*ne*te-ie*$,W[5]=ne*ne*te+ee,W[6]=ie*ne*te+re*$,W[7]=0,W[8]=re*ie*te+ne*$,W[9]=ne*ie*te-re*$,W[10]=ie*ie*te+ee,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W)}},{}],18:[function(W,Z,K){Z.exports=function fromRotationTranslation(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=Z[3],ne=$+$,ie=ee+ee,oe=te+te,ae=$*ne,se=$*ie,fe=$*oe,ue=ee*ie,ce=ee*oe,le=te*oe,pe=re*ne,de=re*ie,he=re*oe;return W[0]=1-(ue+le),W[1]=se+he,W[2]=fe-de,W[3]=0,W[4]=se-he,W[5]=1-(ae+le),W[6]=ce+pe,W[7]=0,W[8]=fe+de,W[9]=ce-pe,W[10]=1-(ae+ue),W[11]=0,W[12]=K[0],W[13]=K[1],W[14]=K[2],W[15]=1,W}},{}],19:[function(W,Z,K){Z.exports=function fromScaling(W,Z){return W[0]=Z[0],W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=Z[1],W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=Z[2],W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],20:[function(W,Z,K){Z.exports=function fromTranslation(W,Z){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=Z[0],W[13]=Z[1],W[14]=Z[2],W[15]=1,W}},{}],21:[function(W,Z,K){Z.exports=function fromXRotation(W,Z){var K=Math.sin(Z),$=Math.cos(Z);return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=$,W[6]=K,W[7]=0,W[8]=0,W[9]=-K,W[10]=$,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],22:[function(W,Z,K){Z.exports=function fromYRotation(W,Z){var K=Math.sin(Z),$=Math.cos(Z);return W[0]=$,W[1]=0,W[2]=-K,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=K,W[9]=0,W[10]=$,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],23:[function(W,Z,K){Z.exports=function fromZRotation(W,Z){var K=Math.sin(Z),$=Math.cos(Z);return W[0]=$,W[1]=K,W[2]=0,W[3]=0,W[4]=-K,W[5]=$,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],24:[function(W,Z,K){Z.exports=function frustum(W,Z,K,$,ee,te,re){var ne=1/(K-Z),ie=1/(ee-$),oe=1/(te-re);return W[0]=2*te*ne,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=2*te*ie,W[6]=0,W[7]=0,W[8]=(K+Z)*ne,W[9]=(ee+$)*ie,W[10]=(re+te)*oe,W[11]=-1,W[12]=0,W[13]=0,W[14]=re*te*2*oe,W[15]=0,W}},{}],25:[function(W,Z,K){Z.exports=function identity(W){return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}},{}],26:[function(W,Z,K){Z.exports={create:W("./create"),clone:W("./clone"),copy:W("./copy"),identity:W("./identity"),transpose:W("./transpose"),invert:W("./invert"),adjoint:W("./adjoint"),determinant:W("./determinant"),multiply:W("./multiply"),translate:W("./translate"),scale:W("./scale"),rotate:W("./rotate"),rotateX:W("./rotateX"),rotateY:W("./rotateY"),rotateZ:W("./rotateZ"),fromRotation:W("./fromRotation"),fromRotationTranslation:W("./fromRotationTranslation"),fromScaling:W("./fromScaling"),fromTranslation:W("./fromTranslation"),fromXRotation:W("./fromXRotation"),fromYRotation:W("./fromYRotation"),fromZRotation:W("./fromZRotation"),fromQuat:W("./fromQuat"),frustum:W("./frustum"),perspective:W("./perspective"),perspectiveFromFieldOfView:W("./perspectiveFromFieldOfView"),ortho:W("./ortho"),lookAt:W("./lookAt"),str:W("./str")}},{"./adjoint":11,"./clone":12,"./copy":13,"./create":14,"./determinant":15,"./fromQuat":16,"./fromRotation":17,"./fromRotationTranslation":18,"./fromScaling":19,"./fromTranslation":20,"./fromXRotation":21,"./fromYRotation":22,"./fromZRotation":23,"./frustum":24,"./identity":25,"./invert":27,"./lookAt":28,"./multiply":29,"./ortho":30,"./perspective":31,"./perspectiveFromFieldOfView":32,"./rotate":33,"./rotateX":34,"./rotateY":35,"./rotateZ":36,"./scale":37,"./str":38,"./translate":39,"./transpose":40}],27:[function(W,Z,K){Z.exports=function invert(W,Z){var K=Z[0],$=Z[1],ee=Z[2],te=Z[3],re=Z[4],ne=Z[5],ie=Z[6],oe=Z[7],ae=Z[8],se=Z[9],fe=Z[10],ue=Z[11],ce=Z[12],le=Z[13],pe=Z[14],de=Z[15],he=K*ne-$*re,me=K*ie-ee*re,ge=K*oe-te*re,ve=$*ie-ee*ne,be=$*oe-te*ne,xe=ee*oe-te*ie,we=ae*le-se*ce,Ae=ae*pe-fe*ce,De=ae*de-ue*ce,Ce=se*pe-fe*le,_e=se*de-ue*le,Oe=fe*de-ue*pe,ke=he*Oe-me*_e+ge*Ce+ve*De-be*Ae+xe*we;return ke?(ke=1/ke,W[0]=(ne*Oe-ie*_e+oe*Ce)*ke,W[1]=(ee*_e-$*Oe-te*Ce)*ke,W[2]=(le*xe-pe*be+de*ve)*ke,W[3]=(fe*be-se*xe-ue*ve)*ke,W[4]=(ie*De-re*Oe-oe*Ae)*ke,W[5]=(K*Oe-ee*De+te*Ae)*ke,W[6]=(pe*ge-ce*xe-de*me)*ke,W[7]=(ae*xe-fe*ge+ue*me)*ke,W[8]=(re*_e-ne*De+oe*we)*ke,W[9]=($*De-K*_e-te*we)*ke,W[10]=(ce*be-le*ge+de*he)*ke,W[11]=(se*ge-ae*be-ue*he)*ke,W[12]=(ne*Ae-re*Ce-ie*we)*ke,W[13]=(K*Ce-$*Ae+ee*we)*ke,W[14]=(le*me-ce*ve-pe*he)*ke,W[15]=(ae*ve-se*me+fe*he)*ke,W):null}},{}],28:[function(W,Z,K){var $=W("./identity");Z.exports=function lookAt(W,Z,K,ee){var te,re,ne,ie,oe,ae,se,fe,ue,ce,le=Z[0],pe=Z[1],de=Z[2],he=ee[0],me=ee[1],ge=ee[2],ve=K[0],be=K[1],xe=K[2];return Math.abs(le-ve)<1e-6&&Math.abs(pe-be)<1e-6&&Math.abs(de-xe)<1e-6?$(W):(se=le-ve,fe=pe-be,ue=de-xe,te=me*(ue*=ce=1/Math.sqrt(se*se+fe*fe+ue*ue))-ge*(fe*=ce),re=ge*(se*=ce)-he*ue,ne=he*fe-me*se,(ce=Math.sqrt(te*te+re*re+ne*ne))?(te*=ce=1/ce,re*=ce,ne*=ce):(te=0,re=0,ne=0),ie=fe*ne-ue*re,oe=ue*te-se*ne,ae=se*re-fe*te,(ce=Math.sqrt(ie*ie+oe*oe+ae*ae))?(ie*=ce=1/ce,oe*=ce,ae*=ce):(ie=0,oe=0,ae=0),W[0]=te,W[1]=ie,W[2]=se,W[3]=0,W[4]=re,W[5]=oe,W[6]=fe,W[7]=0,W[8]=ne,W[9]=ae,W[10]=ue,W[11]=0,W[12]=-(te*le+re*pe+ne*de),W[13]=-(ie*le+oe*pe+ae*de),W[14]=-(se*le+fe*pe+ue*de),W[15]=1,W)}},{"./identity":25}],29:[function(W,Z,K){Z.exports=function multiply(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=Z[3],ne=Z[4],ie=Z[5],oe=Z[6],ae=Z[7],se=Z[8],fe=Z[9],ue=Z[10],ce=Z[11],le=Z[12],pe=Z[13],de=Z[14],he=Z[15],me=K[0],ge=K[1],ve=K[2],be=K[3];return W[0]=me*$+ge*ne+ve*se+be*le,W[1]=me*ee+ge*ie+ve*fe+be*pe,W[2]=me*te+ge*oe+ve*ue+be*de,W[3]=me*re+ge*ae+ve*ce+be*he,me=K[4],ge=K[5],ve=K[6],be=K[7],W[4]=me*$+ge*ne+ve*se+be*le,W[5]=me*ee+ge*ie+ve*fe+be*pe,W[6]=me*te+ge*oe+ve*ue+be*de,W[7]=me*re+ge*ae+ve*ce+be*he,me=K[8],ge=K[9],ve=K[10],be=K[11],W[8]=me*$+ge*ne+ve*se+be*le,W[9]=me*ee+ge*ie+ve*fe+be*pe,W[10]=me*te+ge*oe+ve*ue+be*de,W[11]=me*re+ge*ae+ve*ce+be*he,me=K[12],ge=K[13],ve=K[14],be=K[15],W[12]=me*$+ge*ne+ve*se+be*le,W[13]=me*ee+ge*ie+ve*fe+be*pe,W[14]=me*te+ge*oe+ve*ue+be*de,W[15]=me*re+ge*ae+ve*ce+be*he,W}},{}],30:[function(W,Z,K){Z.exports=function ortho(W,Z,K,$,ee,te,re){var ne=1/(Z-K),ie=1/($-ee),oe=1/(te-re);return W[0]=-2*ne,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=-2*ie,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=2*oe,W[11]=0,W[12]=(Z+K)*ne,W[13]=(ee+$)*ie,W[14]=(re+te)*oe,W[15]=1,W}},{}],31:[function(W,Z,K){Z.exports=function perspective(W,Z,K,$,ee){var te=1/Math.tan(Z/2),re=1/($-ee);return W[0]=te/K,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=te,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=(ee+$)*re,W[11]=-1,W[12]=0,W[13]=0,W[14]=2*ee*$*re,W[15]=0,W}},{}],32:[function(W,Z,K){Z.exports=function perspectiveFromFieldOfView(W,Z,K,$){var ee=Math.tan(Z.upDegrees*Math.PI/180),te=Math.tan(Z.downDegrees*Math.PI/180),re=Math.tan(Z.leftDegrees*Math.PI/180),ne=Math.tan(Z.rightDegrees*Math.PI/180),ie=2/(re+ne),oe=2/(ee+te);return W[0]=ie,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=oe,W[6]=0,W[7]=0,W[8]=-(re-ne)*ie*.5,W[9]=(ee-te)*oe*.5,W[10]=$/(K-$),W[11]=-1,W[12]=0,W[13]=0,W[14]=$*K/(K-$),W[15]=0,W}},{}],33:[function(W,Z,K){Z.exports=function rotate(W,Z,K,$){var ee,te,re,ne,ie,oe,ae,se,fe,ue,ce,le,pe,de,he,me,ge,ve,be,xe,we,Ae,De,Ce,_e=$[0],Oe=$[1],ke=$[2],Te=Math.sqrt(_e*_e+Oe*Oe+ke*ke);return Math.abs(Te)<1e-6?null:(_e*=Te=1/Te,Oe*=Te,ke*=Te,ee=Math.sin(K),re=1-(te=Math.cos(K)),ne=Z[0],ie=Z[1],oe=Z[2],ae=Z[3],se=Z[4],fe=Z[5],ue=Z[6],ce=Z[7],le=Z[8],pe=Z[9],de=Z[10],he=Z[11],me=_e*_e*re+te,ge=Oe*_e*re+ke*ee,ve=ke*_e*re-Oe*ee,be=_e*Oe*re-ke*ee,xe=Oe*Oe*re+te,we=ke*Oe*re+_e*ee,Ae=_e*ke*re+Oe*ee,De=Oe*ke*re-_e*ee,Ce=ke*ke*re+te,W[0]=ne*me+se*ge+le*ve,W[1]=ie*me+fe*ge+pe*ve,W[2]=oe*me+ue*ge+de*ve,W[3]=ae*me+ce*ge+he*ve,W[4]=ne*be+se*xe+le*we,W[5]=ie*be+fe*xe+pe*we,W[6]=oe*be+ue*xe+de*we,W[7]=ae*be+ce*xe+he*we,W[8]=ne*Ae+se*De+le*Ce,W[9]=ie*Ae+fe*De+pe*Ce,W[10]=oe*Ae+ue*De+de*Ce,W[11]=ae*Ae+ce*De+he*Ce,Z!==W&&(W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15]),W)}},{}],34:[function(W,Z,K){Z.exports=function rotateX(W,Z,K){var $=Math.sin(K),ee=Math.cos(K),te=Z[4],re=Z[5],ne=Z[6],ie=Z[7],oe=Z[8],ae=Z[9],se=Z[10],fe=Z[11];return Z!==W&&(W[0]=Z[0],W[1]=Z[1],W[2]=Z[2],W[3]=Z[3],W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15]),W[4]=te*ee+oe*$,W[5]=re*ee+ae*$,W[6]=ne*ee+se*$,W[7]=ie*ee+fe*$,W[8]=oe*ee-te*$,W[9]=ae*ee-re*$,W[10]=se*ee-ne*$,W[11]=fe*ee-ie*$,W}},{}],35:[function(W,Z,K){Z.exports=function rotateY(W,Z,K){var $=Math.sin(K),ee=Math.cos(K),te=Z[0],re=Z[1],ne=Z[2],ie=Z[3],oe=Z[8],ae=Z[9],se=Z[10],fe=Z[11];return Z!==W&&(W[4]=Z[4],W[5]=Z[5],W[6]=Z[6],W[7]=Z[7],W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15]),W[0]=te*ee-oe*$,W[1]=re*ee-ae*$,W[2]=ne*ee-se*$,W[3]=ie*ee-fe*$,W[8]=te*$+oe*ee,W[9]=re*$+ae*ee,W[10]=ne*$+se*ee,W[11]=ie*$+fe*ee,W}},{}],36:[function(W,Z,K){Z.exports=function rotateZ(W,Z,K){var $=Math.sin(K),ee=Math.cos(K),te=Z[0],re=Z[1],ne=Z[2],ie=Z[3],oe=Z[4],ae=Z[5],se=Z[6],fe=Z[7];return Z!==W&&(W[8]=Z[8],W[9]=Z[9],W[10]=Z[10],W[11]=Z[11],W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15]),W[0]=te*ee+oe*$,W[1]=re*ee+ae*$,W[2]=ne*ee+se*$,W[3]=ie*ee+fe*$,W[4]=oe*ee-te*$,W[5]=ae*ee-re*$,W[6]=se*ee-ne*$,W[7]=fe*ee-ie*$,W}},{}],37:[function(W,Z,K){Z.exports=function scale(W,Z,K){var $=K[0],ee=K[1],te=K[2];return W[0]=Z[0]*$,W[1]=Z[1]*$,W[2]=Z[2]*$,W[3]=Z[3]*$,W[4]=Z[4]*ee,W[5]=Z[5]*ee,W[6]=Z[6]*ee,W[7]=Z[7]*ee,W[8]=Z[8]*te,W[9]=Z[9]*te,W[10]=Z[10]*te,W[11]=Z[11]*te,W[12]=Z[12],W[13]=Z[13],W[14]=Z[14],W[15]=Z[15],W}},{}],38:[function(W,Z,K){Z.exports=function str(W){return"mat4("+W[0]+", "+W[1]+", "+W[2]+", "+W[3]+", "+W[4]+", "+W[5]+", "+W[6]+", "+W[7]+", "+W[8]+", "+W[9]+", "+W[10]+", "+W[11]+", "+W[12]+", "+W[13]+", "+W[14]+", "+W[15]+")"}},{}],39:[function(W,Z,K){Z.exports=function translate(W,Z,K){var $,ee,te,re,ne,ie,oe,ae,se,fe,ue,ce,le=K[0],pe=K[1],de=K[2];return Z===W?(W[12]=Z[0]*le+Z[4]*pe+Z[8]*de+Z[12],W[13]=Z[1]*le+Z[5]*pe+Z[9]*de+Z[13],W[14]=Z[2]*le+Z[6]*pe+Z[10]*de+Z[14],W[15]=Z[3]*le+Z[7]*pe+Z[11]*de+Z[15]):($=Z[0],ee=Z[1],te=Z[2],re=Z[3],ne=Z[4],ie=Z[5],oe=Z[6],ae=Z[7],se=Z[8],fe=Z[9],ue=Z[10],ce=Z[11],W[0]=$,W[1]=ee,W[2]=te,W[3]=re,W[4]=ne,W[5]=ie,W[6]=oe,W[7]=ae,W[8]=se,W[9]=fe,W[10]=ue,W[11]=ce,W[12]=$*le+ne*pe+se*de+Z[12],W[13]=ee*le+ie*pe+fe*de+Z[13],W[14]=te*le+oe*pe+ue*de+Z[14],W[15]=re*le+ae*pe+ce*de+Z[15]),W}},{}],40:[function(W,Z,K){Z.exports=function transpose(W,Z){if(W===Z){var K=Z[1],$=Z[2],ee=Z[3],te=Z[6],re=Z[7],ne=Z[11];W[1]=Z[4],W[2]=Z[8],W[3]=Z[12],W[4]=K,W[6]=Z[9],W[7]=Z[13],W[8]=$,W[9]=te,W[11]=Z[14],W[12]=ee,W[13]=re,W[14]=ne}else W[0]=Z[0],W[1]=Z[4],W[2]=Z[8],W[3]=Z[12],W[4]=Z[1],W[5]=Z[5],W[6]=Z[9],W[7]=Z[13],W[8]=Z[2],W[9]=Z[6],W[10]=Z[10],W[11]=Z[14],W[12]=Z[3],W[13]=Z[7],W[14]=Z[11],W[15]=Z[15];return W}},{}],41:[function(W,Z,K){Z.exports=function add(W,Z,K){return W[0]=Z[0]+K[0],W[1]=Z[1]+K[1],W[2]=Z[2]+K[2],W}},{}],42:[function(W,Z,K){Z.exports=function angle(W,Z){var K=$(W[0],W[1],W[2]),re=$(Z[0],Z[1],Z[2]);ee(K,K),ee(re,re);var ne=te(K,re);return ne>1?0:Math.acos(ne)};var $=W("./fromValues"),ee=W("./normalize"),te=W("./dot")},{"./dot":52,"./fromValues":58,"./normalize":69}],43:[function(W,Z,K){Z.exports=function ceil(W,Z){return W[0]=Math.ceil(Z[0]),W[1]=Math.ceil(Z[1]),W[2]=Math.ceil(Z[2]),W}},{}],44:[function(W,Z,K){Z.exports=function clone(W){var Z=new Float32Array(3);return Z[0]=W[0],Z[1]=W[1],Z[2]=W[2],Z}},{}],45:[function(W,Z,K){Z.exports=function copy(W,Z){return W[0]=Z[0],W[1]=Z[1],W[2]=Z[2],W}},{}],46:[function(W,Z,K){Z.exports=function create(){var W=new Float32Array(3);return W[0]=0,W[1]=0,W[2]=0,W}},{}],47:[function(W,Z,K){Z.exports=function cross(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=K[0],ne=K[1],ie=K[2];return W[0]=ee*ie-te*ne,W[1]=te*re-$*ie,W[2]=$*ne-ee*re,W}},{}],48:[function(W,Z,K){Z.exports=W("./distance")},{"./distance":49}],49:[function(W,Z,K){Z.exports=function distance(W,Z){var K=Z[0]-W[0],$=Z[1]-W[1],ee=Z[2]-W[2];return Math.sqrt(K*K+$*$+ee*ee)}},{}],50:[function(W,Z,K){Z.exports=W("./divide")},{"./divide":51}],51:[function(W,Z,K){Z.exports=function divide(W,Z,K){return W[0]=Z[0]/K[0],W[1]=Z[1]/K[1],W[2]=Z[2]/K[2],W}},{}],52:[function(W,Z,K){Z.exports=function dot(W,Z){return W[0]*Z[0]+W[1]*Z[1]+W[2]*Z[2]}},{}],53:[function(W,Z,K){Z.exports=1e-6},{}],54:[function(W,Z,K){Z.exports=function equals(W,Z){var K=W[0],ee=W[1],te=W[2],re=Z[0],ne=Z[1],ie=Z[2];return Math.abs(K-re)<=$*Math.max(1,Math.abs(K),Math.abs(re))&&Math.abs(ee-ne)<=$*Math.max(1,Math.abs(ee),Math.abs(ne))&&Math.abs(te-ie)<=$*Math.max(1,Math.abs(te),Math.abs(ie))};var $=W("./epsilon")},{"./epsilon":53}],55:[function(W,Z,K){Z.exports=function exactEquals(W,Z){return W[0]===Z[0]&&W[1]===Z[1]&&W[2]===Z[2]}},{}],56:[function(W,Z,K){Z.exports=function floor(W,Z){return W[0]=Math.floor(Z[0]),W[1]=Math.floor(Z[1]),W[2]=Math.floor(Z[2]),W}},{}],57:[function(W,Z,K){Z.exports=function forEach(W,Z,K,ee,te,re){var ne,ie;for(Z||(Z=3),K||(K=0),ie=ee?Math.min(ee*Z+K,W.length):W.length,ne=K;ne<ie;ne+=Z)$[0]=W[ne],$[1]=W[ne+1],$[2]=W[ne+2],te($,$,re),W[ne]=$[0],W[ne+1]=$[1],W[ne+2]=$[2];return W};var $=W("./create")()},{"./create":46}],58:[function(W,Z,K){Z.exports=function fromValues(W,Z,K){var $=new Float32Array(3);return $[0]=W,$[1]=Z,$[2]=K,$}},{}],59:[function(W,Z,K){Z.exports={EPSILON:W("./epsilon"),create:W("./create"),clone:W("./clone"),angle:W("./angle"),fromValues:W("./fromValues"),copy:W("./copy"),set:W("./set"),equals:W("./equals"),exactEquals:W("./exactEquals"),add:W("./add"),subtract:W("./subtract"),sub:W("./sub"),multiply:W("./multiply"),mul:W("./mul"),divide:W("./divide"),div:W("./div"),min:W("./min"),max:W("./max"),floor:W("./floor"),ceil:W("./ceil"),round:W("./round"),scale:W("./scale"),scaleAndAdd:W("./scaleAndAdd"),distance:W("./distance"),dist:W("./dist"),squaredDistance:W("./squaredDistance"),sqrDist:W("./sqrDist"),length:W("./length"),len:W("./len"),squaredLength:W("./squaredLength"),sqrLen:W("./sqrLen"),negate:W("./negate"),inverse:W("./inverse"),normalize:W("./normalize"),dot:W("./dot"),cross:W("./cross"),lerp:W("./lerp"),random:W("./random"),transformMat4:W("./transformMat4"),transformMat3:W("./transformMat3"),transformQuat:W("./transformQuat"),rotateX:W("./rotateX"),rotateY:W("./rotateY"),rotateZ:W("./rotateZ"),forEach:W("./forEach")}},{"./add":41,"./angle":42,"./ceil":43,"./clone":44,"./copy":45,"./create":46,"./cross":47,"./dist":48,"./distance":49,"./div":50,"./divide":51,"./dot":52,"./epsilon":53,"./equals":54,"./exactEquals":55,"./floor":56,"./forEach":57,"./fromValues":58,"./inverse":60,"./len":61,"./length":62,"./lerp":63,"./max":64,"./min":65,"./mul":66,"./multiply":67,"./negate":68,"./normalize":69,"./random":70,"./rotateX":71,"./rotateY":72,"./rotateZ":73,"./round":74,"./scale":75,"./scaleAndAdd":76,"./set":77,"./sqrDist":78,"./sqrLen":79,"./squaredDistance":80,"./squaredLength":81,"./sub":82,"./subtract":83,"./transformMat3":84,"./transformMat4":85,"./transformQuat":86}],60:[function(W,Z,K){Z.exports=function inverse(W,Z){return W[0]=1/Z[0],W[1]=1/Z[1],W[2]=1/Z[2],W}},{}],61:[function(W,Z,K){Z.exports=W("./length")},{"./length":62}],62:[function(W,Z,K){Z.exports=function length(W){var Z=W[0],K=W[1],$=W[2];return Math.sqrt(Z*Z+K*K+$*$)}},{}],63:[function(W,Z,K){Z.exports=function lerp(W,Z,K,$){var ee=Z[0],te=Z[1],re=Z[2];return W[0]=ee+$*(K[0]-ee),W[1]=te+$*(K[1]-te),W[2]=re+$*(K[2]-re),W}},{}],64:[function(W,Z,K){Z.exports=function max(W,Z,K){return W[0]=Math.max(Z[0],K[0]),W[1]=Math.max(Z[1],K[1]),W[2]=Math.max(Z[2],K[2]),W}},{}],65:[function(W,Z,K){Z.exports=function min(W,Z,K){return W[0]=Math.min(Z[0],K[0]),W[1]=Math.min(Z[1],K[1]),W[2]=Math.min(Z[2],K[2]),W}},{}],66:[function(W,Z,K){Z.exports=W("./multiply")},{"./multiply":67}],67:[function(W,Z,K){Z.exports=function multiply(W,Z,K){return W[0]=Z[0]*K[0],W[1]=Z[1]*K[1],W[2]=Z[2]*K[2],W}},{}],68:[function(W,Z,K){Z.exports=function negate(W,Z){return W[0]=-Z[0],W[1]=-Z[1],W[2]=-Z[2],W}},{}],69:[function(W,Z,K){Z.exports=function normalize(W,Z){var K=Z[0],$=Z[1],ee=Z[2],te=K*K+$*$+ee*ee;return te>0&&(te=1/Math.sqrt(te),W[0]=Z[0]*te,W[1]=Z[1]*te,W[2]=Z[2]*te),W}},{}],70:[function(W,Z,K){Z.exports=function random(W,Z){Z=Z||1;var K=2*Math.random()*Math.PI,$=2*Math.random()-1,ee=Math.sqrt(1-$*$)*Z;return W[0]=Math.cos(K)*ee,W[1]=Math.sin(K)*ee,W[2]=$*Z,W}},{}],71:[function(W,Z,K){Z.exports=function rotateX(W,Z,K,$){var ee=K[1],te=K[2],re=Z[1]-ee,ne=Z[2]-te,ie=Math.sin($),oe=Math.cos($);return W[0]=Z[0],W[1]=ee+re*oe-ne*ie,W[2]=te+re*ie+ne*oe,W}},{}],72:[function(W,Z,K){Z.exports=function rotateY(W,Z,K,$){var ee=K[0],te=K[2],re=Z[0]-ee,ne=Z[2]-te,ie=Math.sin($),oe=Math.cos($);return W[0]=ee+ne*ie+re*oe,W[1]=Z[1],W[2]=te+ne*oe-re*ie,W}},{}],73:[function(W,Z,K){Z.exports=function rotateZ(W,Z,K,$){var ee=K[0],te=K[1],re=Z[0]-ee,ne=Z[1]-te,ie=Math.sin($),oe=Math.cos($);return W[0]=ee+re*oe-ne*ie,W[1]=te+re*ie+ne*oe,W[2]=Z[2],W}},{}],74:[function(W,Z,K){Z.exports=function round(W,Z){return W[0]=Math.round(Z[0]),W[1]=Math.round(Z[1]),W[2]=Math.round(Z[2]),W}},{}],75:[function(W,Z,K){Z.exports=function scale(W,Z,K){return W[0]=Z[0]*K,W[1]=Z[1]*K,W[2]=Z[2]*K,W}},{}],76:[function(W,Z,K){Z.exports=function scaleAndAdd(W,Z,K,$){return W[0]=Z[0]+K[0]*$,W[1]=Z[1]+K[1]*$,W[2]=Z[2]+K[2]*$,W}},{}],77:[function(W,Z,K){Z.exports=function set(W,Z,K,$){return W[0]=Z,W[1]=K,W[2]=$,W}},{}],78:[function(W,Z,K){Z.exports=W("./squaredDistance")},{"./squaredDistance":80}],79:[function(W,Z,K){Z.exports=W("./squaredLength")},{"./squaredLength":81}],80:[function(W,Z,K){Z.exports=function squaredDistance(W,Z){var K=Z[0]-W[0],$=Z[1]-W[1],ee=Z[2]-W[2];return K*K+$*$+ee*ee}},{}],81:[function(W,Z,K){Z.exports=function squaredLength(W){var Z=W[0],K=W[1],$=W[2];return Z*Z+K*K+$*$}},{}],82:[function(W,Z,K){Z.exports=W("./subtract")},{"./subtract":83}],83:[function(W,Z,K){Z.exports=function subtract(W,Z,K){return W[0]=Z[0]-K[0],W[1]=Z[1]-K[1],W[2]=Z[2]-K[2],W}},{}],84:[function(W,Z,K){Z.exports=function transformMat3(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2];return W[0]=$*K[0]+ee*K[3]+te*K[6],W[1]=$*K[1]+ee*K[4]+te*K[7],W[2]=$*K[2]+ee*K[5]+te*K[8],W}},{}],85:[function(W,Z,K){Z.exports=function transformMat4(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=K[3]*$+K[7]*ee+K[11]*te+K[15];return re=re||1,W[0]=(K[0]*$+K[4]*ee+K[8]*te+K[12])/re,W[1]=(K[1]*$+K[5]*ee+K[9]*te+K[13])/re,W[2]=(K[2]*$+K[6]*ee+K[10]*te+K[14])/re,W}},{}],86:[function(W,Z,K){Z.exports=function transformQuat(W,Z,K){var $=Z[0],ee=Z[1],te=Z[2],re=K[0],ne=K[1],ie=K[2],oe=K[3],ae=oe*$+ne*te-ie*ee,se=oe*ee+ie*$-re*te,fe=oe*te+re*ee-ne*$,ue=-re*$-ne*ee-ie*te;return W[0]=ae*oe+ue*-re+se*-ie-fe*-ne,W[1]=se*oe+ue*-ne+fe*-re-ae*-ie,W[2]=fe*oe+ue*-ie+ae*-ne-se*-re,W}},{}],87:[function(W,Z,K){var $,ee;$=this,ee=function(){function e(Z,K){this.id=W++,this.type=Z,this.data=K}function t(W){return"["+function e(W){if(0===W.length)return[];var Z=W.charAt(0),K=W.charAt(W.length-1);if(1<W.length&&Z===K&&('"'===Z||"'"===Z))return['"'+W.substr(1,W.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(Z=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W))return e(W.substr(0,Z.index)).concat(e(Z[1])).concat(e(W.substr(Z.index+Z[0].length)));if(1===(Z=W.split(".")).length)return['"'+W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(W=[],K=0;K<Z.length;++K)W=W.concat(e(Z[K]));return W}(W).join("][")+"]"}function r(W){return"string"==typeof W?W.split():W}function n(W){return"string"==typeof W?document.querySelector(W):W}function i(W){var Z,K,$,ee,te=W||{};W={};var re=[],ne=[],ie="undefined"==typeof window?1:window.devicePixelRatio,oe=!1,p=function(W){},d=function(){};if("string"==typeof te?Z=document.querySelector(te):"object"==typeof te&&("string"==typeof te.nodeName&&"function"==typeof te.appendChild&&"function"==typeof te.getBoundingClientRect?Z=te:"function"==typeof te.drawArrays||"function"==typeof te.drawElements?$=(ee=te).canvas:("gl"in te?ee=te.gl:"canvas"in te?$=n(te.canvas):"container"in te&&(K=n(te.container)),"attributes"in te&&(W=te.attributes),"extensions"in te&&(re=r(te.extensions)),"optionalExtensions"in te&&(ne=r(te.optionalExtensions)),"onDone"in te&&(p=te.onDone),"profile"in te&&(oe=!!te.profile),"pixelRatio"in te&&(ie=+te.pixelRatio))),Z&&("canvas"===Z.nodeName.toLowerCase()?$=Z:K=Z),!ee){if(!$){if(!(Z=function(W,Z,K){function n(){var Z=window.innerWidth,$=window.innerHeight;W!==document.body&&(Z=($=ee.getBoundingClientRect()).right-$.left,$=$.bottom-$.top),ee.width=K*Z,ee.height=K*$}var $,ee=document.createElement("canvas");return R(ee.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),W.appendChild(ee),W===document.body&&(ee.style.position="absolute",R(W.style,{margin:0,padding:0})),W!==document.body&&"function"==typeof ResizeObserver?($=new ResizeObserver((function(){setTimeout(n)}))).observe(W):window.addEventListener("resize",n,!1),n(),{canvas:ee,onDestroy:function(){$?$.disconnect():window.removeEventListener("resize",n),W.removeChild(ee)}}}(K||document.body,0,ie)))return null;$=Z.canvas,d=Z.onDestroy}void 0===W.premultipliedAlpha&&(W.premultipliedAlpha=!0),ee=function(W,Z){function r(K){try{return W.getContext(K,Z)}catch(W){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}($,W)}return ee?{gl:ee,canvas:$,container:K,extensions:re,optionalExtensions:ne,pixelRatio:ie,profile:oe,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function a(W,Z){for(var K=Array(W),$=0;$<W;++$)K[$]=Z($);return K}function f(W){var Z,K;return Z=(65535<W)<<4,Z|=K=(255<(W>>>=Z))<<3,(Z|=K=(15<(W>>>=K))<<2)|(K=(3<(W>>>=K))<<1)|W>>>K>>1}function o(){function e(Z){e:{for(var K=16;268435456>=K;K*=16)if(Z<=K){Z=K;break e}Z=0}return 0<(K=W[f(Z)>>2]).length?K.pop():new ArrayBuffer(Z)}function t(Z){W[f(Z.byteLength)>>2].push(Z)}var W=a(8,(function(){return[]}));return{alloc:e,free:t,allocType:function(W,Z){var K=null;switch(W){case 5120:K=new Int8Array(e(Z),0,Z);break;case 5121:K=new Uint8Array(e(Z),0,Z);break;case 5122:K=new Int16Array(e(2*Z),0,Z);break;case 5123:K=new Uint16Array(e(2*Z),0,Z);break;case 5124:K=new Int32Array(e(4*Z),0,Z);break;case 5125:K=new Uint32Array(e(4*Z),0,Z);break;case 5126:K=new Float32Array(e(4*Z),0,Z);break;default:return null}return K.length!==Z?K.subarray(0,Z):K},freeType:function(W){t(W.buffer)}}}function u(W){return!!W&&"object"==typeof W&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&"number"==typeof W.offset&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||G(W.data))}function s(W,Z,K,$,ee,te){for(var re=0;re<Z;++re)for(var ne=W[re],ie=0;ie<K;++ie)for(var oe=ne[ie],ae=0;ae<$;++ae)ee[te++]=oe[ae]}function c(W){return 0|re[Object.prototype.toString.call(W)]}function l(W,Z){for(var K=0;K<Z.length;++K)W[K]=Z[K]}function p(W,Z,K,$,ee,te,re){for(var ne=0,ie=0;ie<K;++ie)for(var oe=0;oe<$;++oe)W[ne++]=Z[ee*ie+te*oe+re]}function d(W,Z,K,$){function i(Z){this.id=te++,this.buffer=W.createBuffer(),this.type=Z,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,K.profile&&(this.stats={size:0})}function a(Z,K,$){Z.byteLength=K.byteLength,W.bufferData(Z.type,K,$)}function f(W,Z,K,$,te,re){if(W.usage=K,Array.isArray(Z)){if(W.dtype=$||5126,0<Z.length)if(Array.isArray(Z[0])){te=ae(Z);for(var ne=$=1;ne<te.length;++ne)$*=te[ne];W.dimension=$,a(W,Z=oe(Z,te,W.dtype),K),re?W.persistentData=Z:ee.freeType(Z)}else"number"==typeof Z[0]?(W.dimension=te,l(te=ee.allocType(W.dtype,Z.length),Z),a(W,te,K),re?W.persistentData=te:ee.freeType(te)):G(Z[0])&&(W.dimension=Z[0].length,W.dtype=$||c(Z[0])||5126,a(W,Z=oe(Z,[Z.length,Z[0].length],W.dtype),K),re?W.persistentData=Z:ee.freeType(Z))}else if(G(Z))W.dtype=$||c(Z),W.dimension=te,a(W,Z,K),re&&(W.persistentData=new Uint8Array(new Uint8Array(Z.buffer)));else if(u(Z)){te=Z.shape;var ie=Z.stride,se=(ne=Z.offset,0),fe=0,ue=0,ce=0;1===te.length?(se=te[0],fe=1,ue=ie[0],ce=0):2===te.length&&(se=te[0],fe=te[1],ue=ie[0],ce=ie[1]),W.dtype=$||c(Z.data)||5126,W.dimension=fe,p(te=ee.allocType(W.dtype,se*fe),Z.data,se,fe,ue,ce,ne),a(W,te,K),re?W.persistentData=te:ee.freeType(te)}else Z instanceof ArrayBuffer&&(W.dtype=5121,W.dimension=te,a(W,Z,K),re&&(W.persistentData=new Uint8Array(new Uint8Array(Z))))}function o(K){Z.bufferCount--,$(K),W.deleteBuffer(K.buffer),K.buffer=null,delete re[K.id]}var te=0,re={};i.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){o(this)};var fe=[];return K.profile&&(Z.getTotalBufferSize=function(){var W=0;return Object.keys(re).forEach((function(Z){W+=re[Z].stats.size})),W}),{create:function($,te,fe,ue){function m(Z){var $=35044,ee=null,te=0,re=0,oe=1;return Array.isArray(Z)||G(Z)||u(Z)||Z instanceof ArrayBuffer?ee=Z:"number"==typeof Z?te=0|Z:Z&&("data"in Z&&(ee=Z.data),"usage"in Z&&($=ie[Z.usage]),"type"in Z&&(re=ne[Z.type]),"dimension"in Z&&(oe=0|Z.dimension),"length"in Z&&(te=0|Z.length)),ce.bind(),ee?f(ce,ee,$,re,oe,ue):(te&&W.bufferData(ce.type,te,$),ce.dtype=re||5121,ce.usage=$,ce.dimension=oe,ce.byteLength=te),K.profile&&(ce.stats.size=ce.byteLength*se[ce.dtype]),m}Z.bufferCount++;var ce=new i(te);return re[ce.id]=ce,fe||m($),m._reglType="buffer",m._buffer=ce,m.subdata=function(Z,K){var $,te=0|(K||0);if(ce.bind(),G(Z)||Z instanceof ArrayBuffer)W.bufferSubData(ce.type,te,Z);else if(Array.isArray(Z)){if(0<Z.length)if("number"==typeof Z[0]){var re=ee.allocType(ce.dtype,Z.length);l(re,Z),W.bufferSubData(ce.type,te,re),ee.freeType(re)}else(Array.isArray(Z[0])||G(Z[0]))&&($=ae(Z),re=oe(Z,$,ce.dtype),W.bufferSubData(ce.type,te,re),ee.freeType(re))}else if(u(Z)){$=Z.shape;var ne=Z.stride,ie=re=0,se=0,fe=0;1===$.length?(re=$[0],ie=1,se=ne[0],fe=0):2===$.length&&(re=$[0],ie=$[1],se=ne[0],fe=ne[1]),$=Array.isArray(Z.data)?ce.dtype:c(Z.data),p($=ee.allocType($,re*ie),Z.data,re,ie,se,fe,Z.offset),W.bufferSubData(ce.type,te,$),ee.freeType($)}return m},K.profile&&(m.stats=ce.stats),m.destroy=function(){o(ce)},m},createStream:function(W,Z){var K=fe.pop();return K||(K=new i(W)),K.bind(),f(K,Z,35040,0,1,!1),K},destroyStream:function(W){fe.push(W)},clear:function(){Y(re).forEach(o),fe.forEach(o)},getBuffer:function(W){return W&&W._buffer instanceof i?W._buffer:null},restore:function(){Y(re).forEach((function(Z){Z.buffer=W.createBuffer(),W.bindBuffer(Z.type,Z.buffer),W.bufferData(Z.type,Z.persistentData||Z.byteLength,Z.usage)}))},_initBuffer:f}}function h(W,Z,K,$){function i(W){this.id=te++,ee[this.id]=this,this.buffer=W,this.primType=4,this.type=this.vertCount=0}function a($,ee,te,re,ne,ie,oe){var ae;if($.buffer.bind(),ee?((ae=oe)||G(ee)&&(!u(ee)||G(ee.data))||(ae=Z.oes_element_index_uint?5125:5123),K._initBuffer($.buffer,ee,te,ae,3)):(W.bufferData(34963,ie,te),$.buffer.dtype=ae||5121,$.buffer.usage=te,$.buffer.dimension=3,$.buffer.byteLength=ie),ae=oe,!oe){switch($.buffer.dtype){case 5121:case 5120:ae=5121;break;case 5123:case 5122:ae=5123;break;case 5125:case 5124:ae=5125}$.buffer.dtype=ae}$.type=ae,0>(ee=ne)&&(ee=$.buffer.byteLength,5123===ae?ee>>=1:5125===ae&&(ee>>=2)),$.vertCount=ee,ee=re,0>re&&(ee=4,1===(re=$.buffer.dimension)&&(ee=0),2===re&&(ee=1),3===re&&(ee=4)),$.primType=ee}function f(W){$.elementsCount--,delete ee[W.id],W.buffer.destroy(),W.buffer=null}var ee={},te=0,re={uint8:5121,uint16:5123};Z.oes_element_index_uint&&(re.uint32=5125),i.prototype.bind=function(){this.buffer.bind()};var ne=[];return{create:function(W,Z){function o(W){if(W)if("number"==typeof W)ee(W),te.primType=4,te.vertCount=0|W,te.type=5121;else{var Z=null,K=35044,$=-1,ne=-1,oe=0,ae=0;Array.isArray(W)||G(W)||u(W)?Z=W:("data"in W&&(Z=W.data),"usage"in W&&(K=ie[W.usage]),"primitive"in W&&($=fe[W.primitive]),"count"in W&&(ne=0|W.count),"type"in W&&(ae=re[W.type]),"length"in W?oe=0|W.length:(oe=ne,5123===ae||5122===ae?oe*=2:5125!==ae&&5124!==ae||(oe*=4))),a(te,Z,K,$,ne,oe,ae)}else ee(),te.primType=4,te.vertCount=0,te.type=5121;return o}var ee=K.create(null,34963,!0),te=new i(ee._buffer);return $.elementsCount++,o(W),o._reglType="elements",o._elements=te,o.subdata=function(W,Z){return ee.subdata(W,Z),o},o.destroy=function(){f(te)},o},createStream:function(W){var Z=ne.pop();return Z||(Z=new i(K.create(null,34963,!0,!1)._buffer)),a(Z,W,35040,-1,-1,0,0),Z},destroyStream:function(W){ne.push(W)},getElements:function(W){return"function"==typeof W&&W._elements instanceof i?W._elements:null},clear:function(){Y(ee).forEach(f)}}}function m(W){for(var Z=ee.allocType(5123,W.length),K=0;K<W.length;++K)if(isNaN(W[K]))Z[K]=65535;else if(1/0===W[K])Z[K]=31744;else if(-1/0===W[K])Z[K]=64512;else{ue[0]=W[K];var $=(re=ce[0])>>>31<<15,te=(re<<1>>>24)-127,re=re>>13&1023;Z[K]=-24>te?$:-14>te?$+(re+1024>>-14-te):15<te?$+31744:$+(te+15<<10)+re}return Z}function b(W){return Array.isArray(W)||G(W)}function g(W){return"[object "+W+"]"}function y(W){return Array.isArray(W)&&(0===W.length||"number"==typeof W[0])}function v(W){return!(!Array.isArray(W)||0===W.length||!b(W[0]))}function x(W){return Object.prototype.toString.call(W)}function w(W){if(!W)return!1;var Z=x(W);return 0<=we.indexOf(Z)||y(W)||v(W)||u(W)}function A(W,Z){36193===W.type?(W.data=m(Z),ee.freeType(Z)):W.data=Z}function k(W,Z,K,$,ee,te){if(W=void 0!==De[W]?De[W]:de[W]*Ae[Z],te&&(W*=6),ee){for($=0;1<=K;)$+=W*K*K,K/=2;return $}return W*K*$}function _(W,Z,K,$,ne,ie,oe){function o(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function s(W,Z){W.internalformat=Z.internalformat,W.format=Z.format,W.type=Z.type,W.compressed=Z.compressed,W.premultiplyAlpha=Z.premultiplyAlpha,W.flipY=Z.flipY,W.unpackAlignment=Z.unpackAlignment,W.colorSpace=Z.colorSpace,W.width=Z.width,W.height=Z.height,W.channels=Z.channels}function c(W,Z){if("object"==typeof Z&&Z){"premultiplyAlpha"in Z&&(W.premultiplyAlpha=Z.premultiplyAlpha),"flipY"in Z&&(W.flipY=Z.flipY),"alignment"in Z&&(W.unpackAlignment=Z.alignment),"colorSpace"in Z&&(W.colorSpace=ce[Z.colorSpace]),"type"in Z&&(W.type=we[Z.type]);var K=W.width,$=W.height,ee=W.channels,te=!1;"shape"in Z?(K=Z.shape[0],$=Z.shape[1],3===Z.shape.length&&(ee=Z.shape[2],te=!0)):("radius"in Z&&(K=$=Z.radius),"width"in Z&&(K=Z.width),"height"in Z&&($=Z.height),"channels"in Z&&(ee=Z.channels,te=!0)),W.width=0|K,W.height=0|$,W.channels=0|ee,K=!1,"format"in Z&&(K=Z.format,$=W.internalformat=Ae[K],W.format=Ee[$],K in we&&!("type"in Z)&&(W.type=we[K]),K in De&&(W.compressed=!0),K=!0),!te&&K?W.channels=de[W.format]:te&&!K&&W.channels!==pe[W.format]&&(W.format=W.internalformat=pe[W.channels])}}function l(Z){W.pixelStorei(37440,Z.flipY),W.pixelStorei(37441,Z.premultiplyAlpha),W.pixelStorei(37443,Z.colorSpace),W.pixelStorei(3317,Z.unpackAlignment)}function p(){o.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function d(W,Z){var K=null;if(w(Z)?K=Z:Z&&(c(W,Z),"x"in Z&&(W.xOffset=0|Z.x),"y"in Z&&(W.yOffset=0|Z.y),w(Z.data)&&(K=Z.data)),Z.copy){var $=ne.viewportWidth,ie=ne.viewportHeight;W.width=W.width||$-W.xOffset,W.height=W.height||ie-W.yOffset,W.needsCopy=!0}else if(K){if(G(K))W.channels=W.channels||4,W.data=K,"type"in Z||5121!==W.type||(W.type=0|re[Object.prototype.toString.call(K)]);else if(y(K)){switch(W.channels=W.channels||4,ie=($=K).length,W.type){case 5121:case 5123:case 5125:case 5126:(ie=ee.allocType(W.type,ie)).set($),W.data=ie;break;case 36193:W.data=m($)}W.alignment=1,W.needsFree=!0}else if(u(K)){$=K.data,Array.isArray($)||5121!==W.type||(W.type=0|re[Object.prototype.toString.call($)]),ie=K.shape;var oe,ae,se,fe,ue=K.stride;3===ie.length?(se=ie[2],fe=ue[2]):fe=se=1,oe=ie[0],ae=ie[1],ie=ue[0],ue=ue[1],W.alignment=1,W.width=oe,W.height=ae,W.channels=se,W.format=W.internalformat=pe[se],W.needsFree=!0,oe=fe,K=K.offset,se=W.width,fe=W.height,ae=W.channels;for(var ce=ee.allocType(36193===W.type?5126:W.type,se*fe*ae),le=0,de=0;de<fe;++de)for(var we=0;we<se;++we)for(var Ae=0;Ae<ae;++Ae)ce[le++]=$[ie*we+ue*de+oe*Ae+K];A(W,ce)}else if(x(K)===he||x(K)===me||x(K)===ge)x(K)===he||x(K)===me?W.element=K:W.element=K.canvas,W.width=W.element.width,W.height=W.element.height,W.channels=4;else if(x(K)===ve)W.element=K,W.width=K.width,W.height=K.height,W.channels=4;else if(x(K)===be)W.element=K,W.width=K.naturalWidth,W.height=K.naturalHeight,W.channels=4;else if(x(K)===xe)W.element=K,W.width=K.videoWidth,W.height=K.videoHeight,W.channels=4;else if(v(K)){for($=W.width||K[0].length,ie=W.height||K.length,ue=W.channels,ue=b(K[0][0])?ue||K[0][0].length:ue||1,oe=te.shape(K),se=1,fe=0;fe<oe.length;++fe)se*=oe[fe];se=ee.allocType(36193===W.type?5126:W.type,se),te.flatten(K,oe,"",se),A(W,se),W.alignment=1,W.width=$,W.height=ie,W.channels=ue,W.format=W.internalformat=pe[ue],W.needsFree=!0}}else W.width=W.width||1,W.height=W.height||1,W.channels=W.channels||4}function h(Z,K,ee,te,re){var ne=Z.element,ie=Z.data,oe=Z.internalformat,ae=Z.format,se=Z.type,fe=Z.width,ue=Z.height;l(Z),ne?W.texSubImage2D(K,re,ee,te,ae,se,ne):Z.compressed?W.compressedTexSubImage2D(K,re,ee,te,oe,fe,ue,ie):Z.needsCopy?($(),W.copyTexSubImage2D(K,re,ee,te,Z.xOffset,Z.yOffset,fe,ue)):W.texSubImage2D(K,re,ee,te,fe,ue,ae,se,ie)}function g(){return Me.pop()||new p}function _(W){W.needsFree&&ee.freeType(W.data),p.call(W),Me.push(W)}function O(){o.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function E(W,Z,K){var $=W.images[0]=g();W.mipmask=1,$.width=W.width=Z,$.height=W.height=K,$.channels=W.channels=4}function D(W,Z){var K=null;if(w(Z))s(K=W.images[0]=g(),W),d(K,Z),W.mipmask=1;else if(c(W,Z),Array.isArray(Z.mipmap))for(var $=Z.mipmap,ee=0;ee<$.length;++ee)s(K=W.images[ee]=g(),W),K.width>>=ee,K.height>>=ee,d(K,$[ee]),W.mipmask|=1<<ee;else s(K=W.images[0]=g(),W),d(K,Z),W.mipmask=1;s(W,W.images[0])}function T(Z,K){for(var ee=Z.images,te=0;te<ee.length&&ee[te];++te){var re=ee[te],ne=K,ie=te,oe=re.element,ae=re.data,se=re.internalformat,fe=re.format,ue=re.type,ce=re.width,le=re.height;l(re),oe?W.texImage2D(ne,ie,fe,fe,ue,oe):re.compressed?W.compressedTexImage2D(ne,ie,se,ce,le,0,ae):re.needsCopy?($(),W.copyTexImage2D(ne,ie,fe,re.xOffset,re.yOffset,ce,le,0)):W.texImage2D(ne,ie,fe,ce,le,0,fe,ue,ae||null)}}function S(){var W=Pe.pop()||new O;o.call(W);for(var Z=W.mipmask=0;16>Z;++Z)W.images[Z]=null;return W}function j(W){for(var Z=W.images,K=0;K<Z.length;++K)Z[K]&&_(Z[K]),Z[K]=null;Pe.push(W)}function C(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function V(W,Z){"min"in Z&&(W.minFilter=ue[Z.min],0<=le.indexOf(W.minFilter)&&!("faces"in Z)&&(W.genMipmaps=!0)),"mag"in Z&&(W.magFilter=fe[Z.mag]);var K=W.wrapS,$=W.wrapT;if("wrap"in Z){var ee=Z.wrap;"string"==typeof ee?K=$=se[ee]:Array.isArray(ee)&&(K=se[ee[0]],$=se[ee[1]])}else"wrapS"in Z&&(K=se[Z.wrapS]),"wrapT"in Z&&($=se[Z.wrapT]);if(W.wrapS=K,W.wrapT=$,"anisotropic"in Z&&(W.anisotropic=Z.anisotropic),"mipmap"in Z){switch(K=!1,typeof Z.mipmap){case"string":W.mipmapHint=ae[Z.mipmap],K=W.genMipmaps=!0;break;case"boolean":K=W.genMipmaps=Z.mipmap;break;case"object":W.genMipmaps=!1,K=!0}!K||"min"in Z||(W.minFilter=9984)}}function F(K,$){W.texParameteri($,10241,K.minFilter),W.texParameteri($,10240,K.magFilter),W.texParameteri($,10242,K.wrapS),W.texParameteri($,10243,K.wrapT),Z.ext_texture_filter_anisotropic&&W.texParameteri($,34046,K.anisotropic),K.genMipmaps&&(W.hint(33170,K.mipmapHint),W.generateMipmap($))}function B(Z){o.call(this),this.mipmask=0,this.internalformat=6408,this.id=Fe++,this.refCount=1,this.target=Z,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new C,oe.profile&&(this.stats={size:0})}function z(Z){W.activeTexture(33984),W.bindTexture(Z.target,Z.texture)}function I(){var Z=Be[0];Z?W.bindTexture(Z.target,Z.texture):W.bindTexture(3553,null)}function P(Z){var K=Z.texture,$=Z.unit,ee=Z.target;0<=$&&(W.activeTexture(33984+$),W.bindTexture(ee,null),Be[$]=null),W.deleteTexture(K),Z.texture=null,Z.params=null,Z.pixels=null,Z.refCount=0,delete ze[Z.id],ie.textureCount--}var ae={"don't care":4352,"dont care":4352,nice:4354,fast:4353},se={repeat:10497,clamp:33071,mirror:33648},fe={nearest:9728,linear:9729},ue=R({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},fe),ce={none:0,browser:37444},we={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Ae={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},De={};Z.ext_srgb&&(Ae.srgb=35904,Ae.srgba=35906),Z.oes_texture_float&&(we.float32=we.float=5126),Z.oes_texture_half_float&&(we.float16=we["half float"]=36193),Z.webgl_depth_texture&&(R(Ae,{depth:6402,"depth stencil":34041}),R(we,{uint16:5123,uint32:5125,"depth stencil":34042})),Z.webgl_compressed_texture_s3tc&&R(De,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),Z.webgl_compressed_texture_atc&&R(De,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),Z.webgl_compressed_texture_pvrtc&&R(De,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),Z.webgl_compressed_texture_etc1&&(De["rgb etc1"]=36196);var Ce=Array.prototype.slice.call(W.getParameter(34467));Object.keys(De).forEach((function(W){var Z=De[W];0<=Ce.indexOf(Z)&&(Ae[W]=Z)}));var _e=Object.keys(Ae);K.textureFormats=_e;var Oe=[];Object.keys(Ae).forEach((function(W){Oe[Ae[W]]=W}));var ke=[];Object.keys(we).forEach((function(W){ke[we[W]]=W}));var Te=[];Object.keys(fe).forEach((function(W){Te[fe[W]]=W}));var Se=[];Object.keys(ue).forEach((function(W){Se[ue[W]]=W}));var je=[];Object.keys(se).forEach((function(W){je[se[W]]=W}));var Ee=_e.reduce((function(W,K){var $=Ae[K];return 6409===$||6406===$||6409===$||6410===$||6402===$||34041===$||Z.ext_srgb&&(35904===$||35906===$)?W[$]=$:32855===$||0<=K.indexOf("rgba")?W[$]=6408:W[$]=6407,W}),{}),Me=[],Pe=[],Fe=0,ze={},Ve=K.maxTextureUnits,Be=Array(Ve).map((function(){return null}));return R(B.prototype,{bind:function(){this.bindCount+=1;var Z=this.unit;if(0>Z){for(var K=0;K<Ve;++K){var $=Be[K];if($){if(0<$.bindCount)continue;$.unit=-1}Be[K]=this,Z=K;break}oe.profile&&ie.maxTextureUnits<Z+1&&(ie.maxTextureUnits=Z+1),this.unit=Z,W.activeTexture(33984+Z),W.bindTexture(this.target,this.texture)}return Z},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&P(this)}}),oe.profile&&(ie.getTotalTextureSize=function(){var W=0;return Object.keys(ze).forEach((function(Z){W+=ze[Z].stats.size})),W}),{create2D:function(Z,K){function n(W,Z){var K=$.texInfo;C.call(K);var ee=S();return"number"==typeof W?E(ee,0|W,"number"==typeof Z?0|Z:0|W):W?(V(K,W),D(ee,W)):E(ee,1,1),K.genMipmaps&&(ee.mipmask=(ee.width<<1)-1),$.mipmask=ee.mipmask,s($,ee),$.internalformat=ee.internalformat,n.width=ee.width,n.height=ee.height,z($),T(ee,3553),F(K,3553),I(),j(ee),oe.profile&&($.stats.size=k($.internalformat,$.type,ee.width,ee.height,K.genMipmaps,!1)),n.format=Oe[$.internalformat],n.type=ke[$.type],n.mag=Te[K.magFilter],n.min=Se[K.minFilter],n.wrapS=je[K.wrapS],n.wrapT=je[K.wrapT],n}var $=new B(3553);return ze[$.id]=$,ie.textureCount++,n(Z,K),n.subimage=function(W,Z,K,ee){Z|=0,K|=0,ee|=0;var te=g();return s(te,$),te.width=0,te.height=0,d(te,W),te.width=te.width||($.width>>ee)-Z,te.height=te.height||($.height>>ee)-K,z($),h(te,3553,Z,K,ee),I(),_(te),n},n.resize=function(Z,K){var ee=0|Z,te=0|K||ee;if(ee===$.width&&te===$.height)return n;n.width=$.width=ee,n.height=$.height=te,z($);for(var re=0;$.mipmask>>re;++re){var ne=ee>>re,ie=te>>re;if(!ne||!ie)break;W.texImage2D(3553,re,$.format,ne,ie,0,$.format,$.type,null)}return I(),oe.profile&&($.stats.size=k($.internalformat,$.type,ee,te,!1,!1)),n},n._reglType="texture2d",n._texture=$,oe.profile&&(n.stats=$.stats),n.destroy=function(){$.decRef()},n},createCube:function(Z,K,$,ee,te,re){function l(W,Z,K,$,ee,te){var re,ie=ne.texInfo;for(C.call(ie),re=0;6>re;++re)ae[re]=S();if("number"!=typeof W&&W){if("object"==typeof W)if(Z)D(ae[0],W),D(ae[1],Z),D(ae[2],K),D(ae[3],$),D(ae[4],ee),D(ae[5],te);else if(V(ie,W),c(ne,W),"faces"in W)for(W=W.faces,re=0;6>re;++re)s(ae[re],ne),D(ae[re],W[re]);else for(re=0;6>re;++re)D(ae[re],W)}else for(W=0|W||1,re=0;6>re;++re)E(ae[re],W,W);for(s(ne,ae[0]),ne.mipmask=ie.genMipmaps?(ae[0].width<<1)-1:ae[0].mipmask,ne.internalformat=ae[0].internalformat,l.width=ae[0].width,l.height=ae[0].height,z(ne),re=0;6>re;++re)T(ae[re],34069+re);for(F(ie,34067),I(),oe.profile&&(ne.stats.size=k(ne.internalformat,ne.type,l.width,l.height,ie.genMipmaps,!0)),l.format=Oe[ne.internalformat],l.type=ke[ne.type],l.mag=Te[ie.magFilter],l.min=Se[ie.minFilter],l.wrapS=je[ie.wrapS],l.wrapT=je[ie.wrapT],re=0;6>re;++re)j(ae[re]);return l}var ne=new B(34067);ze[ne.id]=ne,ie.cubeCount++;var ae=Array(6);return l(Z,K,$,ee,te,re),l.subimage=function(W,Z,K,$,ee){K|=0,$|=0,ee|=0;var te=g();return s(te,ne),te.width=0,te.height=0,d(te,Z),te.width=te.width||(ne.width>>ee)-K,te.height=te.height||(ne.height>>ee)-$,z(ne),h(te,34069+W,K,$,ee),I(),_(te),l},l.resize=function(Z){if((Z|=0)!==ne.width){l.width=ne.width=Z,l.height=ne.height=Z,z(ne);for(var K=0;6>K;++K)for(var $=0;ne.mipmask>>$;++$)W.texImage2D(34069+K,$,ne.format,Z>>$,Z>>$,0,ne.format,ne.type,null);return I(),oe.profile&&(ne.stats.size=k(ne.internalformat,ne.type,l.width,l.height,!1,!0)),l}},l._reglType="textureCube",l._texture=ne,oe.profile&&(l.stats=ne.stats),l.destroy=function(){ne.decRef()},l},clear:function(){for(var Z=0;Z<Ve;++Z)W.activeTexture(33984+Z),W.bindTexture(3553,null),Be[Z]=null;Y(ze).forEach(P),ie.cubeCount=0,ie.textureCount=0},getTexture:function(W){return null},restore:function(){for(var Z=0;Z<Ve;++Z){var K=Be[Z];K&&(K.bindCount=0,K.unit=-1,Be[Z]=null)}Y(ze).forEach((function(Z){Z.texture=W.createTexture(),W.bindTexture(Z.target,Z.texture);for(var K=0;32>K;++K)if(Z.mipmask&1<<K)if(3553===Z.target)W.texImage2D(3553,K,Z.internalformat,Z.width>>K,Z.height>>K,0,Z.internalformat,Z.type,null);else for(var $=0;6>$;++$)W.texImage2D(34069+$,K,Z.internalformat,Z.width>>K,Z.height>>K,0,Z.internalformat,Z.type,null);F(Z.texInfo,Z.target)}))},refresh:function(){for(var Z=0;Z<Ve;++Z){var K=Be[Z];K&&(K.bindCount=0,K.unit=-1,Be[Z]=null),W.activeTexture(33984+Z),W.bindTexture(3553,null),W.bindTexture(34067,null)}}}}function O(W,Z,K,$,ee,te){function f(W,Z,K){this.target=W,this.texture=Z,this.renderbuffer=K;var $=W=0;Z?(W=Z.width,$=Z.height):K&&(W=K.width,$=K.height),this.width=W,this.height=$}function o(W){W&&(W.texture&&W.texture._texture.decRef(),W.renderbuffer&&W.renderbuffer._renderbuffer.decRef())}function u(W,Z,K){W&&(W.texture?W.texture._texture.refCount+=1:W.renderbuffer._renderbuffer.refCount+=1)}function s(Z,K){K&&(K.texture?W.framebufferTexture2D(36160,Z,K.target,K.texture._texture.texture,0):W.framebufferRenderbuffer(36160,Z,36161,K.renderbuffer._renderbuffer.renderbuffer))}function c(W){var Z=3553,K=null,$=null,ee=W;return"object"==typeof W&&(ee=W.data,"target"in W&&(Z=0|W.target)),"texture2d"===(W=ee._reglType)||"textureCube"===W?K=ee:"renderbuffer"===W&&($=ee,Z=36161),new f(Z,K,$)}function l(W,Z,K,te,re){return K?((W=$.create2D({width:W,height:Z,format:te,type:re}))._texture.refCount=0,new f(3553,W,null)):((W=ee.create({width:W,height:Z,format:te}))._renderbuffer.refCount=0,new f(36161,null,W))}function p(W){return W&&(W.texture||W.renderbuffer)}function d(W,Z,K){W&&(W.texture?W.texture.resize(Z,K):W.renderbuffer&&W.renderbuffer.resize(Z,K),W.width=Z,W.height=K)}function h(){this.id=ae++,se[this.id]=this,this.framebuffer=W.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function m(W){W.colorAttachments.forEach(o),o(W.depthAttachment),o(W.stencilAttachment),o(W.depthStencilAttachment)}function b(Z){W.deleteFramebuffer(Z.framebuffer),Z.framebuffer=null,te.framebufferCount--,delete se[Z.id]}function g(Z){var $;W.bindFramebuffer(36160,Z.framebuffer);var ee=Z.colorAttachments;for($=0;$<ee.length;++$)s(36064+$,ee[$]);for($=ee.length;$<K.maxColorAttachments;++$)W.framebufferTexture2D(36160,36064+$,3553,null,0);W.framebufferTexture2D(36160,33306,3553,null,0),W.framebufferTexture2D(36160,36096,3553,null,0),W.framebufferTexture2D(36160,36128,3553,null,0),s(36096,Z.depthAttachment),s(36128,Z.stencilAttachment),s(33306,Z.depthStencilAttachment),W.checkFramebufferStatus(36160),W.isContextLost(),W.bindFramebuffer(36160,re.next?re.next.framebuffer:null),re.cur=re.next,W.getError()}function y(W,Z){function r(W,Z){var $,ee=0,te=0,re=!0,oe=!0;$=null;var ae=!0,se="rgba",fe="uint8",ue=1,ce=null,le=null,pe=null,de=!1;"number"==typeof W?(ee=0|W,te=0|Z||ee):W?("shape"in W?(ee=(te=W.shape)[0],te=te[1]):("radius"in W&&(ee=te=W.radius),"width"in W&&(ee=W.width),"height"in W&&(te=W.height)),("color"in W||"colors"in W)&&($=W.color||W.colors,Array.isArray($)),$||("colorCount"in W&&(ue=0|W.colorCount),"colorTexture"in W&&(ae=!!W.colorTexture,se="rgba4"),"colorType"in W&&(fe=W.colorType,!ae)&&("half float"===fe||"float16"===fe?se="rgba16f":"float"!==fe&&"float32"!==fe||(se="rgba32f")),"colorFormat"in W&&(se=W.colorFormat,0<=ne.indexOf(se)?ae=!0:0<=ie.indexOf(se)&&(ae=!1))),("depthTexture"in W||"depthStencilTexture"in W)&&(de=!(!W.depthTexture&&!W.depthStencilTexture)),"depth"in W&&("boolean"==typeof W.depth?re=W.depth:(ce=W.depth,oe=!1)),"stencil"in W&&("boolean"==typeof W.stencil?oe=W.stencil:(le=W.stencil,re=!1)),"depthStencil"in W&&("boolean"==typeof W.depthStencil?re=oe=W.depthStencil:(pe=W.depthStencil,oe=re=!1))):ee=te=1;var he=null,me=null,ge=null,ve=null;if(Array.isArray($))he=$.map(c);else if($)he=[c($)];else for(he=Array(ue),$=0;$<ue;++$)he[$]=l(ee,te,ae,se,fe);for(ee=ee||he[0].width,te=te||he[0].height,ce?me=c(ce):re&&!oe&&(me=l(ee,te,de,"depth","uint32")),le?ge=c(le):oe&&!re&&(ge=l(ee,te,!1,"stencil","uint8")),pe?ve=c(pe):!ce&&!le&&oe&&re&&(ve=l(ee,te,de,"depth stencil","depth stencil")),re=null,$=0;$<he.length;++$)u(he[$]),he[$]&&he[$].texture&&(oe=_e[he[$].texture._texture.format]*Oe[he[$].texture._texture.type],null===re&&(re=oe));return u(me),u(ge),u(ve),m(K),K.width=ee,K.height=te,K.colorAttachments=he,K.depthAttachment=me,K.stencilAttachment=ge,K.depthStencilAttachment=ve,r.color=he.map(p),r.depth=p(me),r.stencil=p(ge),r.depthStencil=p(ve),r.width=K.width,r.height=K.height,g(K),r}var K=new h;return te.framebufferCount++,r(W,Z),R(r,{resize:function(W,Z){var $=Math.max(0|W,1),ee=Math.max(0|Z||$,1);if($===K.width&&ee===K.height)return r;for(var te=K.colorAttachments,re=0;re<te.length;++re)d(te[re],$,ee);return d(K.depthAttachment,$,ee),d(K.stencilAttachment,$,ee),d(K.depthStencilAttachment,$,ee),K.width=r.width=$,K.height=r.height=ee,g(K),r},_reglType:"framebuffer",_framebuffer:K,destroy:function(){b(K),m(K)},use:function(W){re.setFBO({framebuffer:r},W)}})}var re={cur:null,next:null,dirty:!1,setFBO:null},ne=["rgba"],ie=["rgba4","rgb565","rgb5 a1"];Z.ext_srgb&&ie.push("srgba"),Z.ext_color_buffer_half_float&&ie.push("rgba16f","rgb16f"),Z.webgl_color_buffer_float&&ie.push("rgba32f");var oe=["uint8"];Z.oes_texture_half_float&&oe.push("half float","float16"),Z.oes_texture_float&&oe.push("float","float32");var ae=0,se={};return R(re,{getFramebuffer:function(W){return"function"==typeof W&&"framebuffer"===W._reglType&&(W=W._framebuffer)instanceof h?W:null},create:y,createCube:function(W){function t(W){var K,ee={color:null},te=0,re=null;K="rgba";var ne="uint8",ie=1;if("number"==typeof W?te=0|W:W?("shape"in W?te=W.shape[0]:("radius"in W&&(te=0|W.radius),"width"in W?te=0|W.width:"height"in W&&(te=0|W.height)),("color"in W||"colors"in W)&&(re=W.color||W.colors,Array.isArray(re)),re||("colorCount"in W&&(ie=0|W.colorCount),"colorType"in W&&(ne=W.colorType),"colorFormat"in W&&(K=W.colorFormat)),"depth"in W&&(ee.depth=W.depth),"stencil"in W&&(ee.stencil=W.stencil),"depthStencil"in W&&(ee.depthStencil=W.depthStencil)):te=1,re)if(Array.isArray(re))for(W=[],K=0;K<re.length;++K)W[K]=re[K];else W=[re];else for(W=Array(ie),re={radius:te,format:K,type:ne},K=0;K<ie;++K)W[K]=$.createCube(re);for(ee.color=Array(W.length),K=0;K<W.length;++K)ie=W[K],te=te||ie.width,ee.color[K]={target:34069,data:W[K]};for(K=0;6>K;++K){for(ie=0;ie<W.length;++ie)ee.color[ie].target=34069+K;0<K&&(ee.depth=Z[0].depth,ee.stencil=Z[0].stencil,ee.depthStencil=Z[0].depthStencil),Z[K]?Z[K](ee):Z[K]=y(ee)}return R(t,{width:te,height:te,color:W})}var Z=Array(6);return t(W),R(t,{faces:Z,resize:function(W){var K=0|W;if(K===t.width)return t;var $=t.color;for(W=0;W<$.length;++W)$[W].resize(K);for(W=0;6>W;++W)Z[W].resize(K);return t.width=t.height=K,t},_reglType:"framebufferCube",destroy:function(){Z.forEach((function(W){W.destroy()}))}})},clear:function(){Y(se).forEach(b)},restore:function(){re.cur=null,re.next=null,re.dirty=!0,Y(se).forEach((function(Z){Z.framebuffer=W.createFramebuffer(),g(Z)}))}})}function E(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function D(W,Z,K,$,ee,te,re){function o(){this.id=++ae,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var W=Z.oes_vertex_array_object;this.vao=W?W.createVertexArrayOES():null,se[this.id]=this,this.buffers=[]}var ie=K.maxAttributes,oe=Array(ie);for(K=0;K<ie;++K)oe[K]=new E;var ae=0,se={},ue={Record:E,scope:{},state:oe,currentVAO:null,targetVAO:null,restore:Z.oes_vertex_array_object?function(){Z.oes_vertex_array_object&&Y(se).forEach((function(W){W.refresh()}))}:function(){},createVAO:function(W){function t(W){var K;Array.isArray(W)?(K=W,Z.elements&&Z.ownsElements&&Z.elements.destroy(),Z.elements=null,Z.ownsElements=!1,Z.offset=0,Z.count=0,Z.instances=-1,Z.primitive=4):(W.elements?(K=W.elements,Z.ownsElements?("function"==typeof K&&"elements"===K._reglType?Z.elements.destroy():Z.elements(K),Z.ownsElements=!1):te.getElements(W.elements)?(Z.elements=W.elements,Z.ownsElements=!1):(Z.elements=te.create(W.elements),Z.ownsElements=!0)):(Z.elements=null,Z.ownsElements=!1),K=W.attributes,Z.offset=0,Z.count=-1,Z.instances=-1,Z.primitive=4,Z.elements&&(Z.count=Z.elements._elements.vertCount,Z.primitive=Z.elements._elements.primType),"offset"in W&&(Z.offset=0|W.offset),"count"in W&&(Z.count=0|W.count),"instances"in W&&(Z.instances=0|W.instances),"primitive"in W&&(Z.primitive=fe[W.primitive])),W={};var $=Z.attributes;$.length=K.length;for(var re=0;re<K.length;++re){var ie,oe=K[re],ae=$[re]=new E,se=oe.data||oe;Array.isArray(se)||G(se)||u(se)?(Z.buffers[re]&&(ie=Z.buffers[re],G(se)&&ie._buffer.byteLength>=se.byteLength?ie.subdata(se):(ie.destroy(),Z.buffers[re]=null)),Z.buffers[re]||(ie=Z.buffers[re]=ee.create(oe,34962,!1,!0)),ae.buffer=ee.getBuffer(ie),ae.size=0|ae.buffer.dimension,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1,W[re]=1):ee.getBuffer(oe)?(ae.buffer=ee.getBuffer(oe),ae.size=0|ae.buffer.dimension,ae.normalized=!1,ae.type=ae.buffer.dtype,ae.offset=0,ae.stride=0,ae.divisor=0,ae.state=1):ee.getBuffer(oe.buffer)?(ae.buffer=ee.getBuffer(oe.buffer),ae.size=0|(+oe.size||ae.buffer.dimension),ae.normalized=!!oe.normalized||!1,ae.type="type"in oe?ne[oe.type]:ae.buffer.dtype,ae.offset=0|(oe.offset||0),ae.stride=0|(oe.stride||0),ae.divisor=0|(oe.divisor||0),ae.state=1):"x"in oe&&(ae.x=+oe.x||0,ae.y=+oe.y||0,ae.z=+oe.z||0,ae.w=+oe.w||0,ae.state=2)}for(ie=0;ie<Z.buffers.length;++ie)!W[ie]&&Z.buffers[ie]&&(Z.buffers[ie].destroy(),Z.buffers[ie]=null);return Z.refresh(),t}var Z=new o;return $.vaoCount+=1,t.destroy=function(){for(var W=0;W<Z.buffers.length;++W)Z.buffers[W]&&Z.buffers[W].destroy();Z.buffers.length=0,Z.ownsElements&&(Z.elements.destroy(),Z.elements=null,Z.ownsElements=!1),Z.destroy()},t._vao=Z,t._reglType="vao",t(W)},getVAO:function(W){return"function"==typeof W&&W._vao?W._vao:null},destroyBuffer:function(Z){for(var K=0;K<oe.length;++K){var $=oe[K];$.buffer===Z&&(W.disableVertexAttribArray(K),$.buffer=null)}},setVAO:Z.oes_vertex_array_object?function(W){if(W!==ue.currentVAO){var K=Z.oes_vertex_array_object;W?K.bindVertexArrayOES(W.vao):K.bindVertexArrayOES(null),ue.currentVAO=W}}:function(K){if(K!==ue.currentVAO){if(K)K.bindAttrs();else{for(var $=Z.angle_instanced_arrays,ee=0;ee<oe.length;++ee){var te=oe[ee];te.buffer?(W.enableVertexAttribArray(ee),te.buffer.bind(),W.vertexAttribPointer(ee,te.size,te.type,te.normalized,te.stride,te.offfset),$&&te.divisor&&$.vertexAttribDivisorANGLE(ee,te.divisor)):(W.disableVertexAttribArray(ee),W.vertexAttrib4f(ee,te.x,te.y,te.z,te.w))}re.elements?W.bindBuffer(34963,re.elements.buffer.buffer):W.bindBuffer(34963,null)}ue.currentVAO=K}},clear:Z.oes_vertex_array_object?function(){Y(se).forEach((function(W){W.destroy()}))}:function(){}};return o.prototype.bindAttrs=function(){for(var K=Z.angle_instanced_arrays,$=this.attributes,ee=0;ee<$.length;++ee){var re=$[ee];re.buffer?(W.enableVertexAttribArray(ee),W.bindBuffer(34962,re.buffer.buffer),W.vertexAttribPointer(ee,re.size,re.type,re.normalized,re.stride,re.offset),K&&re.divisor&&K.vertexAttribDivisorANGLE(ee,re.divisor)):(W.disableVertexAttribArray(ee),W.vertexAttrib4f(ee,re.x,re.y,re.z,re.w))}for(K=$.length;K<ie;++K)W.disableVertexAttribArray(K);(K=te.getElements(this.elements))?W.bindBuffer(34963,K.buffer.buffer):W.bindBuffer(34963,null)},o.prototype.refresh=function(){var W=Z.oes_vertex_array_object;W&&(W.bindVertexArrayOES(this.vao),this.bindAttrs(),ue.currentVAO=null,W.bindVertexArrayOES(null))},o.prototype.destroy=function(){if(this.vao){var W=Z.oes_vertex_array_object;this===ue.currentVAO&&(ue.currentVAO=null,W.bindVertexArrayOES(null)),W.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),se[this.id]&&(delete se[this.id],--$.vaoCount)},ue}function T(W,Z,K,$){function i(W,Z,K,$){this.name=W,this.id=Z,this.location=K,this.info=$}function a(W,Z){for(var K=0;K<W.length;++K)if(W[K].id===Z.id)return void(W[K].location=Z.location);W.push(Z)}function f(K,$,re){if(!(ie=(re=35632===K?ee:te)[$])){var ne=Z.str($),ie=W.createShader(K);W.shaderSource(ie,ne),W.compileShader(ie),re[$]=ie}return ie}function o(W,Z){this.id=ie++,this.fragId=W,this.vertId=Z,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,$.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(K,ee,te){var re;re=f(35632,K.fragId);var ne=f(35633,K.vertId);if(ee=K.program=W.createProgram(),W.attachShader(ee,re),W.attachShader(ee,ne),te)for(re=0;re<te.length;++re)ne=te[re],W.bindAttribLocation(ee,ne[0],ne[1]);W.linkProgram(ee),ne=W.getProgramParameter(ee,35718),$.profile&&(K.stats.uniformsCount=ne);var ie=K.uniforms;for(re=0;re<ne;++re)if(te=W.getActiveUniform(ee,re)){if(1<te.size)for(var oe=0;oe<te.size;++oe){var ae=te.name.replace("[0]","["+oe+"]");a(ie,new i(ae,Z.id(ae),W.getUniformLocation(ee,ae),te))}oe=te.name,1<te.size&&(oe=oe.replace("[0]","")),a(ie,new i(oe,Z.id(oe),W.getUniformLocation(ee,oe),te))}for(ne=W.getProgramParameter(ee,35721),$.profile&&(K.stats.attributesCount=ne),K=K.attributes,re=0;re<ne;++re)(te=W.getActiveAttrib(ee,re))&&a(K,new i(te.name,Z.id(te.name),W.getAttribLocation(ee,te.name),te))}var ee={},te={},re={},ne=[],ie=0;return $.profile&&(K.getMaxUniformsCount=function(){var W=0;return ne.forEach((function(Z){Z.stats.uniformsCount>W&&(W=Z.stats.uniformsCount)})),W},K.getMaxAttributesCount=function(){var W=0;return ne.forEach((function(Z){Z.stats.attributesCount>W&&(W=Z.stats.attributesCount)})),W}),{clear:function(){var Z=W.deleteShader.bind(W);Y(ee).forEach(Z),ee={},Y(te).forEach(Z),te={},ne.forEach((function(Z){W.deleteProgram(Z.program)})),ne.length=0,re={},K.shaderCount=0},program:function(Z,$,ie,oe){var ae=re[$];ae||(ae=re[$]={});var se=ae[Z];if(se&&(se.refCount++,!oe))return se;var fe=new o($,Z);return K.shaderCount++,u(fe,ie,oe),se||(ae[Z]=fe),ne.push(fe),R(fe,{destroy:function(){if(fe.refCount--,0>=fe.refCount){W.deleteProgram(fe.program);var Z=ne.indexOf(fe);ne.splice(Z,1),K.shaderCount--}0>=ae[fe.vertId].refCount&&(W.deleteShader(te[fe.vertId]),delete te[fe.vertId],delete re[fe.fragId][fe.vertId]),Object.keys(re[fe.fragId]).length||(W.deleteShader(ee[fe.fragId]),delete ee[fe.fragId],delete re[fe.fragId])}})},restore:function(){ee={},te={};for(var W=0;W<ne.length;++W)u(ne[W],null,ne[W].attributes.map((function(W){return[W.location,W.name]})))},shader:f,frag:-1,vert:-1}}function S(W,Z,K,$,ee,te,re){function o(ee){var te;te=null===Z.next?5121:Z.next.colorAttachments[0].texture._texture.type;var re=0,ne=0,ie=$.framebufferWidth,oe=$.framebufferHeight,ae=null;return G(ee)?ae=ee:ee&&(re=0|ee.x,ne=0|ee.y,ie=0|(ee.width||$.framebufferWidth-re),oe=0|(ee.height||$.framebufferHeight-ne),ae=ee.data||null),K(),ee=ie*oe*4,ae||(5121===te?ae=new Uint8Array(ee):5126===te&&(ae=ae||new Float32Array(ee))),W.pixelStorei(3333,4),W.readPixels(re,ne,ie,oe,6408,te,ae),ae}return function(W){return W&&"framebuffer"in W?function(W){var K;return Z.setFBO({framebuffer:W.framebuffer},(function(){K=o(W)})),K}(W):o(W)}}function j(W){return Array.prototype.slice.call(W)}function C(W){return j(W).join("")}function V(W){return Array.isArray(W)||G(W)||u(W)}function F(W){return W.sort((function(W,Z){return"viewport"===W?-1:"viewport"===Z?1:W<Z?-1:1}))}function B(W,Z,K,$){this.thisDep=W,this.contextDep=Z,this.propDep=K,this.append=$}function z(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function I(W){return new B(!1,!1,!1,W)}function P(W,Z){var K=W.type;if(0===K)return new B(!0,1<=(K=W.data.length),2<=K,Z);if(4===K)return new B((K=W.data).thisDep,K.contextDep,K.propDep,Z);if(5===K)return new B(!1,!1,!1,Z);if(6===K){for(var $=K=!1,ee=!1,te=0;te<W.data.length;++te){var re=W.data[te];1===re.type?ee=!0:2===re.type?$=!0:3===re.type?K=!0:0===re.type?(K=!0,1<=(re=re.data)&&($=!0),2<=re&&(ee=!0)):4===re.type&&(K=K||re.data.thisDep,$=$||re.data.contextDep,ee=ee||re.data.propDep)}return new B(K,$,ee,Z)}return new B(3===K,2===K,1===K,Z)}function L(W,K,$,ee,te,re,ie,oe,ae,se,ue,ce,le,pe,de){function g(W){return W.replace(".","_")}function y(W,Z,K){var $=g(W);Ae.push(W),we[$]=xe[$]=!!K,De[$]=Z}function v(W,Z,K){var $=g(W);Ae.push(W),Array.isArray(K)?(xe[$]=K.slice(),we[$]=K.slice()):xe[$]=we[$]=K,Ce[$]=Z}function x(){var W=function(){function e(){var Z=[],K=[];return R((function(){Z.push.apply(Z,j(arguments))}),{def:function(){var $="v"+W++;return K.push($),0<arguments.length&&(Z.push($,"="),Z.push.apply(Z,j(arguments)),Z.push(";")),$},toString:function(){return C([0<K.length?"var "+K.join(",")+";":"",C(Z)])}})}function t(){function t(K,$){Z(K,$,"=",W.def(K,$),";")}var W=e(),Z=e(),K=W.toString,$=Z.toString;return R((function(){W.apply(W,j(arguments))}),{def:W.def,entry:W,exit:Z,save:t,set:function(Z,K,$){t(Z,K),W(Z,K,"=",$,";")},toString:function(){return K()+$()}})}var W=0,Z=[],K=[],$=e(),ee={};return{global:$,link:function($){for(var ee=0;ee<K.length;++ee)if(K[ee]===$)return Z[ee];return ee="g"+W++,Z.push(ee),K.push($),ee},block:e,proc:function(W,Z){function n(){var W="a"+K.length;return K.push(W),W}var K=[];Z=Z||0;for(var $=0;$<Z;++$)n();var te=($=t()).toString;return ee[W]=R($,{arg:n,toString:function(){return C(["function(",K.join(),"){",te(),"}"])}})},scope:t,cond:function(){var W=C(arguments),Z=t(),K=t(),$=Z.toString,ee=K.toString;return R(Z,{then:function(){return Z.apply(Z,j(arguments)),this},else:function(){return K.apply(K,j(arguments)),this},toString:function(){var Z=ee();return Z&&(Z="else{"+Z+"}"),C(["if(",W,"){",$(),"}",Z])}})},compile:function(){var W=['"use strict";',$,"return {"];Object.keys(ee).forEach((function(Z){W.push('"',Z,'":',ee[Z].toString(),",")})),W.push("}");var te=C(W).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,Z.concat(te)).apply(null,K)}}}(),Z=W.link,$=W.global;W.id=Fe++,W.batchId="0";var ee=Z(_e),te=W.shared={props:"a0"};Object.keys(_e).forEach((function(W){te[W]=$.def(ee,".",W)}));var re=W.next={},ne=W.current={};Object.keys(Ce).forEach((function(W){Array.isArray(xe[W])&&(re[W]=$.def(te.next,".",W),ne[W]=$.def(te.current,".",W))}));var ie=W.constants={};Object.keys(Oe).forEach((function(W){ie[W]=$.def(JSON.stringify(Oe[W]))})),W.invoke=function(K,$){switch($.type){case 0:var ee=["this",te.context,te.props,W.batchId];return K.def(Z($.data),".call(",ee.slice(0,Math.max($.data.length+1,4)),")");case 1:return K.def(te.props,$.data);case 2:return K.def(te.context,$.data);case 3:return K.def("this",$.data);case 4:return $.data.append(W,K),$.data.ref;case 5:return $.data.toString();case 6:return $.data.map((function(Z){return W.invoke(K,Z)}))}},W.attribCache={};var oe={};return W.scopeAttrib=function(W){if((W=K.id(W))in oe)return oe[W];var $=se.scope[W];return $||($=se.scope[W]=new he),oe[W]=Z($)},W}function w(W,Z){var K=W.static,$=W.dynamic;if("framebuffer"in K){var ee=K.framebuffer;return ee?(ee=oe.getFramebuffer(ee),I((function(W,Z){var K=W.link(ee),$=W.shared;return Z.set($.framebuffer,".next",K),$=$.context,Z.set($,".framebufferWidth",K+".width"),Z.set($,".framebufferHeight",K+".height"),K}))):I((function(W,Z){var K=W.shared;return Z.set(K.framebuffer,".next","null"),K=K.context,Z.set(K,".framebufferWidth",K+".drawingBufferWidth"),Z.set(K,".framebufferHeight",K+".drawingBufferHeight"),"null"}))}if("framebuffer"in $){var te=$.framebuffer;return P(te,(function(W,Z){var K=W.invoke(Z,te),$=W.shared,ee=$.framebuffer;return K=Z.def(ee,".getFramebuffer(",K,")"),Z.set(ee,".next",K),$=$.context,Z.set($,".framebufferWidth",K+"?"+K+".width:"+$+".drawingBufferWidth"),Z.set($,".framebufferHeight",K+"?"+K+".height:"+$+".drawingBufferHeight"),K}))}return null}function A(W,Z,$){function i(W){if(W in ee){var Z=K.id(ee[W]);return(W=I((function(){return Z}))).id=Z,W}if(W in te){var $=te[W];return P($,(function(W,Z){var K=W.invoke(Z,$);return Z.def(W.shared.strings,".id(",K,")")}))}return null}var ee=W.static,te=W.dynamic,re=i("frag"),ne=i("vert"),ie=null;return z(re)&&z(ne)?(ie=ue.program(ne.id,re.id,null,$),W=I((function(W,Z){return W.link(ie)}))):W=new B(re&&re.thisDep||ne&&ne.thisDep,re&&re.contextDep||ne&&ne.contextDep,re&&re.propDep||ne&&ne.propDep,(function(W,Z){var K,$,ee=W.shared.shader;return K=re?re.append(W,Z):Z.def(ee,".","frag"),$=ne?ne.append(W,Z):Z.def(ee,".","vert"),Z.def(ee+".program("+$+","+K+")")})),{frag:re,vert:ne,progVar:W,program:ie}}function k(W,Z){function r(W,Z){if(W in K){var re=0|K[W];return Z?ee.offset=re:ee.instances=re,I((function(W,K){return Z&&(W.OFFSET=re),re}))}if(W in $){var oe=$[W];return P(oe,(function(W,K){var $=W.invoke(K,oe);return Z&&(W.OFFSET=$),$}))}if(Z){if(ie)return I((function(W,Z){return W.OFFSET=0}));if(te)return new B(ne.thisDep,ne.contextDep,ne.propDep,(function(W,Z){return Z.def(W.shared.vao+".currentVAO?"+W.shared.vao+".currentVAO.offset:0")}))}else if(te)return new B(ne.thisDep,ne.contextDep,ne.propDep,(function(W,Z){return Z.def(W.shared.vao+".currentVAO?"+W.shared.vao+".currentVAO.instances:-1")}));return null}var K=W.static,$=W.dynamic,ee={},te=!1,ne=function(){if("vao"in K){var W=K.vao;return null!==W&&null===se.getVAO(W)&&(W=se.createVAO(W)),te=!0,ee.vao=W,I((function(Z){var K=se.getVAO(W);return K?Z.link(K):"null"}))}if("vao"in $){te=!0;var Z=$.vao;return P(Z,(function(W,K){var $=W.invoke(K,Z);return K.def(W.shared.vao+".getVAO("+$+")")}))}return null}(),ie=!1,oe=function(){if("elements"in K){var W=K.elements;if(ee.elements=W,V(W)){var Z=ee.elements=re.create(W,!0);W=re.getElements(Z),ie=!0}else W&&(W=re.getElements(W),ie=!0);return(Z=I((function(Z,K){if(W){var $=Z.link(W);return Z.ELEMENTS=$}return Z.ELEMENTS=null}))).value=W,Z}if("elements"in $){ie=!0;var oe=$.elements;return P(oe,(function(W,Z){var K=($=W.shared).isBufferArgs,$=$.elements,ee=W.invoke(Z,oe),te=Z.def("null");return K=Z.def(K,"(",ee,")"),ee=W.cond(K).then(te,"=",$,".createStream(",ee,");").else(te,"=",$,".getElements(",ee,");"),Z.entry(ee),Z.exit(W.cond(K).then($,".destroyStream(",te,");")),W.ELEMENTS=te}))}return te?new B(ne.thisDep,ne.contextDep,ne.propDep,(function(W,Z){return Z.def(W.shared.vao+".currentVAO?"+W.shared.elements+".getElements("+W.shared.vao+".currentVAO.elements):null")})):null}(),ae=r("offset",!0),ue=function(){if("primitive"in K){var W=K.primitive;return ee.primitive=W,I((function(Z,K){return fe[W]}))}if("primitive"in $){var Z=$.primitive;return P(Z,(function(W,K){var $=W.constants.primTypes,ee=W.invoke(K,Z);return K.def($,"[",ee,"]")}))}return ie?z(oe)?oe.value?I((function(W,Z){return Z.def(W.ELEMENTS,".primType")})):I((function(){return 4})):new B(oe.thisDep,oe.contextDep,oe.propDep,(function(W,Z){var K=W.ELEMENTS;return Z.def(K,"?",K,".primType:",4)})):te?new B(ne.thisDep,ne.contextDep,ne.propDep,(function(W,Z){return Z.def(W.shared.vao+".currentVAO?"+W.shared.vao+".currentVAO.primitive:4")})):null}(),ce=function(){if("count"in K){var W=0|K.count;return ee.count=W,I((function(){return W}))}if("count"in $){var Z=$.count;return P(Z,(function(W,K){return W.invoke(K,Z)}))}return ie?z(oe)?oe?ae?new B(ae.thisDep,ae.contextDep,ae.propDep,(function(W,Z){return Z.def(W.ELEMENTS,".vertCount-",W.OFFSET)})):I((function(W,Z){return Z.def(W.ELEMENTS,".vertCount")})):I((function(){return-1})):new B(oe.thisDep||ae.thisDep,oe.contextDep||ae.contextDep,oe.propDep||ae.propDep,(function(W,Z){var K=W.ELEMENTS;return W.OFFSET?Z.def(K,"?",K,".vertCount-",W.OFFSET,":-1"):Z.def(K,"?",K,".vertCount:-1")})):te?new B(ne.thisDep,ne.contextDep,ne.propDep,(function(W,Z){return Z.def(W.shared.vao,".currentVAO?",W.shared.vao,".currentVAO.count:-1")})):null}(),le=r("instances",!1);return{elements:oe,primitive:ue,count:ce,instances:le,offset:ae,vao:ne,vaoActive:te,elementsActive:ie,static:ee}}function _(W,Z){var $=W.static,ee=W.dynamic,re={};return Object.keys($).forEach((function(W){var Z=$[W],ee=K.id(W),ie=new he;if(V(Z))ie.state=1,ie.buffer=te.getBuffer(te.create(Z,34962,!1,!0)),ie.type=0;else if(ae=te.getBuffer(Z))ie.state=1,ie.buffer=ae,ie.type=0;else if("constant"in Z){var oe=Z.constant;ie.buffer="null",ie.state=2,"number"==typeof oe?ie.x=oe:ke.forEach((function(W,Z){Z<oe.length&&(ie[W]=oe[Z])}))}else{var ae=V(Z.buffer)?te.getBuffer(te.create(Z.buffer,34962,!1,!0)):te.getBuffer(Z.buffer),se=0|Z.offset,fe=0|Z.stride,ue=0|Z.size,ce=!!Z.normalized,le=0;"type"in Z&&(le=ne[Z.type]),Z=0|Z.divisor,ie.buffer=ae,ie.state=1,ie.size=ue,ie.normalized=ce,ie.type=le||ae.dtype,ie.offset=se,ie.stride=fe,ie.divisor=Z}re[W]=I((function(W,Z){var K=W.attribCache;if(ee in K)return K[ee];var $={isStream:!1};return Object.keys(ie).forEach((function(W){$[W]=ie[W]})),ie.buffer&&($.buffer=W.link(ie.buffer),$.type=$.type||$.buffer+".dtype"),K[ee]=$}))})),Object.keys(ee).forEach((function(W){var Z=ee[W];re[W]=P(Z,(function(W,K){function n(W){K(ne[W],"=",$,".",W,"|0;")}var $=W.invoke(K,Z),ee=W.shared,te=W.constants,re=ee.isBufferArgs,ne=(ee=ee.buffer,{isStream:K.def(!1)}),ie=new he;ie.state=1,Object.keys(ie).forEach((function(W){ne[W]=K.def(""+ie[W])}));var oe=ne.buffer,ae=ne.type;return K("if(",re,"(",$,")){",ne.isStream,"=true;",oe,"=",ee,".createStream(",34962,",",$,");",ae,"=",oe,".dtype;","}else{",oe,"=",ee,".getBuffer(",$,");","if(",oe,"){",ae,"=",oe,".dtype;",'}else if("constant" in ',$,"){",ne.state,"=",2,";","if(typeof "+$+'.constant === "number"){',ne[ke[0]],"=",$,".constant;",ke.slice(1).map((function(W){return ne[W]})).join("="),"=0;","}else{",ke.map((function(W,Z){return ne[W]+"="+$+".constant.length>"+Z+"?"+$+".constant["+Z+"]:0;"})).join(""),"}}else{","if(",re,"(",$,".buffer)){",oe,"=",ee,".createStream(",34962,",",$,".buffer);","}else{",oe,"=",ee,".getBuffer(",$,".buffer);","}",ae,'="type" in ',$,"?",te.glTypes,"[",$,".type]:",oe,".dtype;",ne.normalized,"=!!",$,".normalized;"),n("size"),n("offset"),n("stride"),n("divisor"),K("}}"),K.exit("if(",ne.isStream,"){",ee,".destroyStream(",oe,");","}"),ne}))})),re}function O(W,Z,K,ee,te){function o(W){var Z=ne[W];Z&&(oe[W]=Z)}var re=function(W,Z){if("string"==typeof(K=W.static).frag&&"string"==typeof K.vert){if(0<Object.keys(Z.dynamic).length)return null;var K=Z.static,$=Object.keys(K);if(0<$.length&&"number"==typeof K[$[0]]){for(var ee=[],te=0;te<$.length;++te)ee.push([0|K[$[te]],$[te]]);return ee}}return null}(W,Z),ne=function(W,Z,K){function n(W){if(W in $){var K=$[W];W=!0;var te,re,ne=0|K.x,ie=0|K.y;return"width"in K?te=0|K.width:W=!1,"height"in K?re=0|K.height:W=!1,new B(!W&&Z&&Z.thisDep,!W&&Z&&Z.contextDep,!W&&Z&&Z.propDep,(function(W,Z){var $=W.shared.context,ee=te;"width"in K||(ee=Z.def($,".","framebufferWidth","-",ne));var oe=re;return"height"in K||(oe=Z.def($,".","framebufferHeight","-",ie)),[ne,ie,ee,oe]}))}if(W in ee){var oe=ee[W];return W=P(oe,(function(W,Z){var K=W.invoke(Z,oe),$=W.shared.context,ee=Z.def(K,".x|0"),te=Z.def(K,".y|0");return[ee,te,Z.def('"width" in ',K,"?",K,".width|0:","(",$,".","framebufferWidth","-",ee,")"),K=Z.def('"height" in ',K,"?",K,".height|0:","(",$,".","framebufferHeight","-",te,")")]})),Z&&(W.thisDep=W.thisDep||Z.thisDep,W.contextDep=W.contextDep||Z.contextDep,W.propDep=W.propDep||Z.propDep),W}return Z?new B(Z.thisDep,Z.contextDep,Z.propDep,(function(W,Z){var K=W.shared.context;return[0,0,Z.def(K,".","framebufferWidth"),Z.def(K,".","framebufferHeight")]})):null}var $=W.static,ee=W.dynamic;if(W=n("viewport")){var te=W;W=new B(W.thisDep,W.contextDep,W.propDep,(function(W,Z){var K=te.append(W,Z),$=W.shared.context;return Z.set($,".viewportWidth",K[2]),Z.set($,".viewportHeight",K[3]),K}))}return{viewport:W,scissor_box:n("scissor.box")}}(W,fe=w(W)),ie=k(W),oe=function(W,Z){var K=W.static,$=W.dynamic,ee={};return Ae.forEach((function(W){function t(te,re){if(W in K){var ne=te(K[W]);ee[Z]=I((function(){return ne}))}else if(W in $){var ie=$[W];ee[Z]=P(ie,(function(W,Z){return re(W,Z,W.invoke(Z,ie))}))}}var Z=g(W);switch(W){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return t((function(W){return W}),(function(W,Z,K){return K}));case"depth.func":return t((function(W){return je[W]}),(function(W,Z,K){return Z.def(W.constants.compareFuncs,"[",K,"]")}));case"depth.range":return t((function(W){return W}),(function(W,Z,K){return[Z.def("+",K,"[0]"),Z=Z.def("+",K,"[1]")]}));case"blend.func":return t((function(W){return[Se["srcRGB"in W?W.srcRGB:W.src],Se["dstRGB"in W?W.dstRGB:W.dst],Se["srcAlpha"in W?W.srcAlpha:W.src],Se["dstAlpha"in W?W.dstAlpha:W.dst]]}),(function(W,Z,K){function n(W,$){return Z.def('"',W,$,'" in ',K,"?",K,".",W,$,":",K,".",W)}W=W.constants.blendFuncs;var $=n("src","RGB"),ee=n("dst","RGB"),te=($=Z.def(W,"[",$,"]"),Z.def(W,"[",n("src","Alpha"),"]"));return[$,ee=Z.def(W,"[",ee,"]"),te,W=Z.def(W,"[",n("dst","Alpha"),"]")]}));case"blend.equation":return t((function(W){return"string"==typeof W?[me[W],me[W]]:"object"==typeof W?[me[W.rgb],me[W.alpha]]:void 0}),(function(W,Z,K){var $=W.constants.blendEquations,ee=Z.def(),te=Z.def();return(W=W.cond("typeof ",K,'==="string"')).then(ee,"=",te,"=",$,"[",K,"];"),W.else(ee,"=",$,"[",K,".rgb];",te,"=",$,"[",K,".alpha];"),Z(W),[ee,te]}));case"blend.color":return t((function(W){return a(4,(function(Z){return+W[Z]}))}),(function(W,Z,K){return a(4,(function(W){return Z.def("+",K,"[",W,"]")}))}));case"stencil.mask":return t((function(W){return 0|W}),(function(W,Z,K){return Z.def(K,"|0")}));case"stencil.func":return t((function(W){return[je[W.cmp||"keep"],W.ref||0,"mask"in W?W.mask:-1]}),(function(W,Z,K){return[W=Z.def('"cmp" in ',K,"?",W.constants.compareFuncs,"[",K,".cmp]",":",7680),Z.def(K,".ref|0"),Z=Z.def('"mask" in ',K,"?",K,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return t((function(Z){return["stencil.opBack"===W?1029:1028,Ee[Z.fail||"keep"],Ee[Z.zfail||"keep"],Ee[Z.zpass||"keep"]]}),(function(Z,K,$){function i(W){return K.def('"',W,'" in ',$,"?",ee,"[",$,".",W,"]:",7680)}var ee=Z.constants.stencilOps;return["stencil.opBack"===W?1029:1028,i("fail"),i("zfail"),i("zpass")]}));case"polygonOffset.offset":return t((function(W){return[0|W.factor,0|W.units]}),(function(W,Z,K){return[Z.def(K,".factor|0"),Z=Z.def(K,".units|0")]}));case"cull.face":return t((function(W){var Z=0;return"front"===W?Z=1028:"back"===W&&(Z=1029),Z}),(function(W,Z,K){return Z.def(K,'==="front"?',1028,":",1029)}));case"frontFace":return t((function(W){return Me[W]}),(function(W,Z,K){return Z.def(K+'==="cw"?2304:2305')}));case"colorMask":return t((function(W){return W.map((function(W){return!!W}))}),(function(W,Z,K){return a(4,(function(W){return"!!"+K+"["+W+"]"}))}));case"sample.coverage":return t((function(W){return["value"in W?W.value:1,!!W.invert]}),(function(W,Z,K){return[Z.def('"value" in ',K,"?+",K,".value:1"),Z=Z.def("!!",K,".invert")]}))}})),ee}(W),ae=A(W,0,re);o("viewport"),o(g("scissor.box"));var fe,ue=0<Object.keys(oe).length;if((fe={framebuffer:fe,draw:ie,shader:ae,state:oe,dirty:ue,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=function(W){var Z,K=W.static;if(W=W.dynamic,"profile"in K){var $=!!K.profile;(Z=I((function(W,Z){return $}))).enable=$}else if("profile"in W){var ee=W.profile;Z=P(ee,(function(W,Z){return W.invoke(Z,ee)}))}return Z}(W),fe.uniforms=function(W,Z){var K=W.static,$=W.dynamic,ee={};return Object.keys(K).forEach((function(W){var Z,$=K[W];if("number"==typeof $||"boolean"==typeof $)Z=I((function(){return $}));else if("function"==typeof $){var te=$._reglType;"texture2d"===te||"textureCube"===te?Z=I((function(W){return W.link($)})):"framebuffer"!==te&&"framebufferCube"!==te||(Z=I((function(W){return W.link($.color[0])})))}else b($)&&(Z=I((function(W){return W.global.def("[",a($.length,(function(W){return $[W]})),"]")})));Z.value=$,ee[W]=Z})),Object.keys($).forEach((function(W){var Z=$[W];ee[W]=P(Z,(function(W,K){return W.invoke(K,Z)}))})),ee}(K),fe.drawVAO=fe.scopeVAO=ie.vao,!fe.drawVAO&&ae.program&&!re&&$.angle_instanced_arrays&&ie.static.elements){var ce=!0;if(W=ae.program.attributes.map((function(W){return W=Z.static[W],ce=ce&&!!W,W})),ce&&0<W.length){var le=se.getVAO(se.createVAO({attributes:W,elements:ie.static.elements}));fe.drawVAO=new B(null,null,null,(function(W,Z){return W.link(le)})),fe.useVAO=!0}}return re?fe.useVAO=!0:fe.attributes=_(Z),fe.context=function(W){var Z=W.static,K=W.dynamic,$={};return Object.keys(Z).forEach((function(W){var K=Z[W];$[W]=I((function(W,Z){return"number"==typeof K||"boolean"==typeof K?""+K:W.link(K)}))})),Object.keys(K).forEach((function(W){var Z=K[W];$[W]=P(Z,(function(W,K){return W.invoke(K,Z)}))})),$}(ee),fe}function E(W,Z,K){var $=W.shared.context,ee=W.scope();Object.keys(K).forEach((function(te){Z.save($,"."+te);var re=K[te].append(W,Z);Array.isArray(re)?ee($,".",te,"=[",re.join(),"];"):ee($,".",te,"=",re,";")})),Z(ee)}function D(W,Z,K,$){var ee,te=(ne=W.shared).gl,re=ne.framebuffer;ve&&(ee=Z.def(ne.extensions,".webgl_draw_buffers"));var ne=(ie=W.constants).drawBuffer,ie=ie.backBuffer;W=K?K.append(W,Z):Z.def(re,".next"),$||Z("if(",W,"!==",re,".cur){"),Z("if(",W,"){",te,".bindFramebuffer(",36160,",",W,".framebuffer);"),ve&&Z(ee,".drawBuffersWEBGL(",ne,"[",W,".colorAttachments.length]);"),Z("}else{",te,".bindFramebuffer(",36160,",null);"),ve&&Z(ee,".drawBuffersWEBGL(",ie,");"),Z("}",re,".cur=",W,";"),$||Z("}")}function T(W,Z,K){var $=W.shared,ee=$.gl,te=W.current,re=W.next,ne=$.current,ie=$.next,oe=W.cond(ne,".dirty");Ae.forEach((function(Z){var $,ae;if(!((Z=g(Z))in K.state))if(Z in re){$=re[Z],ae=te[Z];var se=a(xe[Z].length,(function(W){return oe.def($,"[",W,"]")}));oe(W.cond(se.map((function(W,Z){return W+"!=="+ae+"["+Z+"]"})).join("||")).then(ee,".",Ce[Z],"(",se,");",se.map((function(W,Z){return ae+"["+Z+"]="+W})).join(";"),";"))}else $=oe.def(ie,".",Z),se=W.cond($,"!==",ne,".",Z),oe(se),Z in De?se(W.cond($).then(ee,".enable(",De[Z],");").else(ee,".disable(",De[Z],");"),ne,".",Z,"=",$,";"):se(ee,".",Ce[Z],"(",$,");",ne,".",Z,"=",$,";")})),0===Object.keys(K.state).length&&oe(ne,".dirty=false;"),Z(oe)}function S(W,Z,K,$){var ee=W.shared,te=W.current,re=ee.current,ne=ee.gl;F(Object.keys(K)).forEach((function(ee){var ie=K[ee];if(!$||$(ie)){var oe=ie.append(W,Z);if(De[ee]){var ae=De[ee];z(ie)?Z(ne,oe?".enable(":".disable(",ae,");"):Z(W.cond(oe).then(ne,".enable(",ae,");").else(ne,".disable(",ae,");")),Z(re,".",ee,"=",oe,";")}else if(b(oe)){var se=te[ee];Z(ne,".",Ce[ee],"(",oe,");",oe.map((function(W,Z){return se+"["+Z+"]="+W})).join(";"),";")}else Z(ne,".",Ce[ee],"(",oe,");",re,".",ee,"=",oe,";")}}))}function L(W,Z){ge&&(W.instancing=Z.def(W.shared.extensions,".angle_instanced_arrays"))}function M(W,Z,K,$,ee){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function f(W){W(te=Z.def(),"=",a(),";"),"string"==typeof ee?W(ie,".count+=",ee,";"):W(ie,".count++;"),pe&&($?W(re=Z.def(),"=",ae,".getNumPendingQueries();"):W(ae,".beginQuery(",ie,");"))}function o(W){W(ie,".cpuTime+=",a(),"-",te,";"),pe&&($?W(ae,".pushScopeStats(",re,",",ae,".getNumPendingQueries(),",ie,");"):W(ae,".endQuery();"))}function u(W){var K=Z.def(oe,".profile");Z(oe,".profile=",W,";"),Z.exit(oe,".profile=",K,";")}var te,re,ne=W.shared,ie=W.stats,oe=ne.current,ae=ne.timer;if(K=K.profile){if(z(K))return void(K.enable?(f(Z),o(Z.exit),u("true")):u("false"));u(K=K.append(W,Z))}else K=Z.def(oe,".profile");f(ne=W.block()),Z("if(",K,"){",ne,"}"),o(W=W.block()),Z.exit("if(",K,"){",W,"}")}function H(W,Z,K,$,ee){function a(K,$,ee){function a(){Z("if(!",ie,".buffer){",re,".enableVertexAttribArray(",ne,");}");var K,te=ee.type;K=ee.size?Z.def(ee.size,"||",$):$,Z("if(",ie,".type!==",te,"||",ie,".size!==",K,"||",se.map((function(W){return ie+"."+W+"!=="+ee[W]})).join("||"),"){",re,".bindBuffer(",34962,",",oe,".buffer);",re,".vertexAttribPointer(",[ne,K,te,ee.normalized,ee.stride,ee.offset],");",ie,".type=",te,";",ie,".size=",K,";",se.map((function(W){return ie+"."+W+"="+ee[W]+";"})).join(""),"}"),ge&&(te=ee.divisor,Z("if(",ie,".divisor!==",te,"){",W.instancing,".vertexAttribDivisorANGLE(",[ne,te],");",ie,".divisor=",te,";}"))}function o(){Z("if(",ie,".buffer){",re,".disableVertexAttribArray(",ne,");",ie,".buffer=null;","}if(",ke.map((function(W,Z){return ie+"."+W+"!=="+ae[Z]})).join("||"),"){",re,".vertexAttrib4f(",ne,",",ae,");",ke.map((function(W,Z){return ie+"."+W+"="+ae[Z]+";"})).join(""),"}")}var re=te.gl,ne=Z.def(K,".location"),ie=Z.def(te.attributes,"[",ne,"]");K=ee.state;var oe=ee.buffer,ae=[ee.x,ee.y,ee.z,ee.w],se=["buffer","normalized","offset","stride"];1===K?a():2===K?o():(Z("if(",K,"===",1,"){"),a(),Z("}else{"),o(),Z("}"))}var te=W.shared;$.forEach((function($){var te,re=$.name,ne=K.attributes[re];if(ne){if(!ee(ne))return;te=ne.append(W,Z)}else{if(!ee(Pe))return;var ie=W.scopeAttrib(re);te={},Object.keys(new he).forEach((function(W){te[W]=Z.def(ie,".",W)}))}a(W.link($),function(W){switch(W){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}($.info.type),te)}))}function U(W,Z,$,ee,te,re){for(var ne,ie=W.shared,oe=ie.gl,ae={},se=0;se<ee.length;++se){var fe=(he=ee[se]).name,ue=he.info.type,ce=he.info.size,le=$.uniforms[fe];if(1<ce){if(!le)continue;var pe=fe.replace("[0]","");if(ae[pe])continue;ae[pe]=1}var de,he=W.link(he)+".location";if(le){if(!te(le))continue;if(z(le)){if(fe=le.value,35678===ue||35680===ue)Z(oe,".uniform1i(",he,",",(ue=W.link(fe._texture||fe.color[0]._texture))+".bind());"),Z.exit(ue,".unbind();");else if(35674===ue||35675===ue||35676===ue)ce=W.global.def("new Float32Array(["+Array.prototype.slice.call(fe)+"])"),fe=2,35675===ue?fe=3:35676===ue&&(fe=4),Z(oe,".uniformMatrix",fe,"fv(",he,",false,",ce,");");else{switch(ue){case 5126:ne="1f";break;case 35664:ne="2f";break;case 35665:ne="3f";break;case 35666:ne="4f";break;case 35670:case 5124:ne="1i";break;case 35671:case 35667:ne="2i";break;case 35672:case 35668:ne="3i";break;case 35673:case 35669:ne="4i"}1<ce?(ne+="v",fe=W.global.def("["+Array.prototype.slice.call(fe)+"]")):fe=b(fe)?Array.prototype.slice.call(fe):fe,Z(oe,".uniform",ne,"(",he,",",fe,");")}continue}de=le.append(W,Z)}else{if(!te(Pe))continue;de=Z.def(ie.uniforms,"[",K.id(fe),"]")}switch(35678===ue?Z("if(",de,"&&",de,'._reglType==="framebuffer"){',de,"=",de,".color[0];","}"):35680===ue&&Z("if(",de,"&&",de,'._reglType==="framebufferCube"){',de,"=",de,".color[0];","}"),fe=1,ue){case 35678:case 35680:ue=Z.def(de,"._texture"),Z(oe,".uniform1i(",he,",",ue,".bind());"),Z.exit(ue,".unbind();");continue;case 5124:case 35670:ne="1i";break;case 35667:case 35671:ne="2i",fe=2;break;case 35668:case 35672:ne="3i",fe=3;break;case 35669:case 35673:ne="4i",fe=4;break;case 5126:ne="1f";break;case 35664:ne="2f",fe=2;break;case 35665:ne="3f",fe=3;break;case 35666:ne="4f",fe=4;break;case 35674:ne="Matrix2fv";break;case 35675:ne="Matrix3fv";break;case 35676:ne="Matrix4fv"}if(-1===ne.indexOf("Matrix")&&1<ce&&(ne+="v",fe=1),"M"===ne.charAt(0)){Z(oe,".uniform",ne,"(",he,","),he=Math.pow(ue-35674+2,2);var me=W.global.def("new Float32Array(",he,")");Array.isArray(de)?Z("false,(",a(he,(function(W){return me+"["+W+"]="+de[W]})),",",me,")"):Z("false,(Array.isArray(",de,")||",de," instanceof Float32Array)?",de,":(",a(he,(function(W){return me+"["+W+"]="+de+"["+W+"]"})),",",me,")"),Z(");")}else{if(1<fe){ue=[];var ge=[];for(ce=0;ce<fe;++ce)Array.isArray(de)?ge.push(de[ce]):ge.push(Z.def(de+"["+ce+"]")),re&&ue.push(Z.def());re&&Z("if(!",W.batchId,"||",ue.map((function(W,Z){return W+"!=="+ge[Z]})).join("||"),"){",ue.map((function(W,Z){return W+"="+ge[Z]+";"})).join("")),Z(oe,".uniform",ne,"(",he,",",ge.join(","),");")}else re&&(ue=Z.def(),Z("if(!",W.batchId,"||",ue,"!==",de,"){",ue,"=",de,";")),Z(oe,".uniform",ne,"(",he,",",de,");");re&&Z("}")}}}function N(W,Z,K,$){function i(ee){var te=oe[ee];return te?te.contextDep&&$.contextDynamic||te.propDep?te.append(W,K):te.append(W,Z):Z.def(ie,".",ee)}function a(){function e(){K(te,".drawElementsInstancedANGLE(",[se,ue,ce,fe+"<<(("+ce+"-5121)>>1)",ee],");")}function t(){K(te,".drawArraysInstancedANGLE(",[se,fe,ue,ee],");")}ae&&"null"!==ae?le?e():(K("if(",ae,"){"),e(),K("}else{"),t(),K("}")):t()}function f(){function e(){K(ne+".drawElements("+[se,ue,ce,fe+"<<(("+ce+"-5121)>>1)"]+");")}function t(){K(ne+".drawArrays("+[se,fe,ue]+");")}ae&&"null"!==ae?le?e():(K("if(",ae,"){"),e(),K("}else{"),t(),K("}")):t()}var ee,te,re=W.shared,ne=re.gl,ie=re.draw,oe=$.draw,ae=function(){var ee=oe.elements,te=Z;return ee?((ee.contextDep&&$.contextDynamic||ee.propDep)&&(te=K),ee=ee.append(W,te),oe.elementsActive&&te("if("+ee+")"+ne+".bindBuffer(34963,"+ee+".buffer.buffer);")):(ee=te.def(),te(ee,"=",ie,".","elements",";","if(",ee,"){",ne,".bindBuffer(",34963,",",ee,".buffer.buffer);}","else if(",re.vao,".currentVAO){",ee,"=",W.shared.elements+".getElements("+re.vao,".currentVAO.elements);",be?"":"if("+ee+")"+ne+".bindBuffer(34963,"+ee+".buffer.buffer);","}")),ee}(),se=i("primitive"),fe=i("offset"),ue=function(){var ee=oe.count,te=Z;return ee?((ee.contextDep&&$.contextDynamic||ee.propDep)&&(te=K),ee=ee.append(W,te)):ee=te.def(ie,".","count"),ee}();if("number"==typeof ue){if(0===ue)return}else K("if(",ue,"){"),K.exit("}");ge&&(ee=i("instances"),te=W.instancing);var ce=ae+".type",le=oe.elements&&z(oe.elements)&&!oe.vaoActive;ge&&("number"!=typeof ee||0<=ee)?"string"==typeof ee?(K("if(",ee,">0){"),a(),K("}else if(",ee,"<0){"),f(),K("}")):a():f()}function q(W,Z,K,$,ee){return ee=(Z=x()).proc("body",ee),ge&&(Z.instancing=ee.def(Z.shared.extensions,".angle_instanced_arrays")),W(Z,ee,K,$),Z.compile().body}function Q(W,Z,K,$){L(W,Z),K.useVAO?K.drawVAO?Z(W.shared.vao,".setVAO(",K.drawVAO.append(W,Z),");"):Z(W.shared.vao,".setVAO(",W.shared.vao,".targetVAO);"):(Z(W.shared.vao,".setVAO(null);"),H(W,Z,K,$.attributes,(function(){return!0}))),U(W,Z,K,$.uniforms,(function(){return!0}),!1),N(W,Z,Z,K)}function G(W,Z,K,$){function i(){return!0}W.batchId="a1",L(W,Z),H(W,Z,K,$.attributes,i),U(W,Z,K,$.uniforms,i,!1),N(W,Z,Z,K)}function Y(W,Z,K,$){function i(W){return W.contextDep&&ee||W.propDep}function a(W){return!i(W)}L(W,Z);var ee=K.contextDep,te=Z.def(),re=Z.def();W.shared.props=re,W.batchId=te;var ne=W.scope(),ie=W.scope();Z(ne.entry,"for(",te,"=0;",te,"<","a1",";++",te,"){",re,"=","a0","[",te,"];",ie,"}",ne.exit),K.needsContext&&E(W,ie,K.context),K.needsFramebuffer&&D(W,ie,K.framebuffer),S(W,ie,K.state,i),K.profile&&i(K.profile)&&M(W,ie,K,!1,!0),$?(K.useVAO?K.drawVAO?i(K.drawVAO)?ie(W.shared.vao,".setVAO(",K.drawVAO.append(W,ie),");"):ne(W.shared.vao,".setVAO(",K.drawVAO.append(W,ne),");"):ne(W.shared.vao,".setVAO(",W.shared.vao,".targetVAO);"):(ne(W.shared.vao,".setVAO(null);"),H(W,ne,K,$.attributes,a),H(W,ie,K,$.attributes,i)),U(W,ne,K,$.uniforms,a,!1),U(W,ie,K,$.uniforms,i,!0),N(W,ne,ie,K)):(Z=W.global.def("{}"),$=K.shader.progVar.append(W,ie),re=ie.def($,".id"),ne=ie.def(Z,"[",re,"]"),ie(W.shared.gl,".useProgram(",$,".program);","if(!",ne,"){",ne,"=",Z,"[",re,"]=",W.link((function(Z){return q(G,W,K,Z,2)})),"(",$,");}",ne,".call(this,a0[",te,"],",te,");"))}function X(W,Z){function n(K){var te=Z.shader[K];te&&$.set(ee.shader,"."+K,te.append(W,$))}var $=W.proc("scope",3);W.batchId="a2";var ee=W.shared,te=ee.current;E(W,$,Z.context),Z.framebuffer&&Z.framebuffer.append(W,$),F(Object.keys(Z.state)).forEach((function(K){var te=Z.state[K].append(W,$);b(te)?te.forEach((function(Z,ee){$.set(W.next[K],"["+ee+"]",Z)})):$.set(ee.next,"."+K,te)})),M(W,$,Z,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(K){var te=Z.draw[K];te&&$.set(ee.draw,"."+K,""+te.append(W,$))})),Object.keys(Z.uniforms).forEach((function(te){var re=Z.uniforms[te].append(W,$);Array.isArray(re)&&(re="["+re.join()+"]"),$.set(ee.uniforms,"["+K.id(te)+"]",re)})),Object.keys(Z.attributes).forEach((function(K){var ee=Z.attributes[K].append(W,$),te=W.scopeAttrib(K);Object.keys(new he).forEach((function(W){$.set(te,"."+W,ee[W])}))})),Z.scopeVAO&&$.set(ee.vao,".targetVAO",Z.scopeVAO.append(W,$)),n("vert"),n("frag"),0<Object.keys(Z.state).length&&($(te,".dirty=true;"),$.exit(te,".dirty=true;")),$("a1(",W.shared.context,",a0,",W.batchId,");")}function J(W,K,$){var ee=K.static[$];if(ee&&function(W){if("object"==typeof W&&!b(W)){for(var K=Object.keys(W),$=0;$<K.length;++$)if(Z.isDynamic(W[K[$]]))return!0;return!1}}(ee)){var te=W.global,re=Object.keys(ee),ne=!1,ie=!1,oe=!1,ae=W.global.def("{}");re.forEach((function(K){var $=ee[K];if(Z.isDynamic($))"function"==typeof $&&($=ee[K]=Z.unbox($)),K=P($,null),ne=ne||K.thisDep,oe=oe||K.propDep,ie=ie||K.contextDep;else{switch(te(ae,".",K,"="),typeof $){case"number":te($);break;case"string":te('"',$,'"');break;case"object":Array.isArray($)&&te("[",$.join(),"]");break;default:te(W.link($))}te(";")}})),K.dynamic[$]=new Z.DynamicVariable(4,{thisDep:ne,contextDep:ie,propDep:oe,ref:ae,append:function(W,K){re.forEach((function($){var te=ee[$];Z.isDynamic(te)&&(te=W.invoke(K,te),K(ae,".",$,"=",te,";"))}))}}),delete K.static[$]}}var he=se.Record,me={add:32774,subtract:32778,"reverse subtract":32779};$.ext_blend_minmax&&(me.min=32775,me.max=32776);var ge=$.angle_instanced_arrays,ve=$.webgl_draw_buffers,be=$.oes_vertex_array_object,xe={dirty:!0,profile:de.profile},we={},Ae=[],De={},Ce={};y("dither",3024),y("blend.enable",3042),v("blend.color","blendColor",[0,0,0,0]),v("blend.equation","blendEquationSeparate",[32774,32774]),v("blend.func","blendFuncSeparate",[1,0,1,0]),y("depth.enable",2929,!0),v("depth.func","depthFunc",513),v("depth.range","depthRange",[0,1]),v("depth.mask","depthMask",!0),v("colorMask","colorMask",[!0,!0,!0,!0]),y("cull.enable",2884),v("cull.face","cullFace",1029),v("frontFace","frontFace",2305),v("lineWidth","lineWidth",1),y("polygonOffset.enable",32823),v("polygonOffset.offset","polygonOffset",[0,0]),y("sample.alpha",32926),y("sample.enable",32928),v("sample.coverage","sampleCoverage",[1,!1]),y("stencil.enable",2960),v("stencil.mask","stencilMask",-1),v("stencil.func","stencilFunc",[519,0,-1]),v("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),v("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),y("scissor.enable",3089),v("scissor.box","scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),v("viewport","viewport",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var _e={gl:W,context:le,strings:K,next:we,current:xe,draw:ce,elements:re,buffer:te,shader:ue,attributes:se.state,vao:se,uniforms:ae,framebuffer:oe,extensions:$,timer:pe,isBufferArgs:V},Oe={primTypes:fe,compareFuncs:je,blendFuncs:Se,blendEquations:me,stencilOps:Ee,glTypes:ne,orientationType:Me};ve&&(Oe.backBuffer=[1029],Oe.drawBuffer=a(ee.maxDrawbuffers,(function(W){return 0===W?[0]:a(W,(function(W){return 36064+W}))})));var Fe=0;return{next:we,current:xe,procs:function(){var W=x(),Z=W.proc("poll"),K=W.proc("refresh"),te=W.block();Z(te),K(te);var re,ne=W.shared,ie=ne.gl,oe=ne.next,ae=ne.current;te(ae,".dirty=false;"),D(W,Z),D(W,K,null,!0),ge&&(re=W.link(ge)),$.oes_vertex_array_object&&K(W.link($.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var se=0;se<ee.maxAttributes;++se){var fe=K.def(ne.attributes,"[",se,"]"),ue=W.cond(fe,".buffer");ue.then(ie,".enableVertexAttribArray(",se,");",ie,".bindBuffer(",34962,",",fe,".buffer.buffer);",ie,".vertexAttribPointer(",se,",",fe,".size,",fe,".type,",fe,".normalized,",fe,".stride,",fe,".offset);").else(ie,".disableVertexAttribArray(",se,");",ie,".vertexAttrib4f(",se,",",fe,".x,",fe,".y,",fe,".z,",fe,".w);",fe,".buffer=null;"),K(ue),ge&&K(re,".vertexAttribDivisorANGLE(",se,",",fe,".divisor);")}return K(W.shared.vao,".currentVAO=null;",W.shared.vao,".setVAO(",W.shared.vao,".targetVAO);"),Object.keys(De).forEach((function($){var ee=De[$],re=te.def(oe,".",$),ne=W.block();ne("if(",re,"){",ie,".enable(",ee,")}else{",ie,".disable(",ee,")}",ae,".",$,"=",re,";"),K(ne),Z("if(",re,"!==",ae,".",$,"){",ne,"}")})),Object.keys(Ce).forEach((function($){var ee,re,ne=Ce[$],se=xe[$],fe=W.block();fe(ie,".",ne,"("),b(se)?(ne=se.length,ee=W.global.def(oe,".",$),re=W.global.def(ae,".",$),fe(a(ne,(function(W){return ee+"["+W+"]"})),");",a(ne,(function(W){return re+"["+W+"]="+ee+"["+W+"];"})).join("")),Z("if(",a(ne,(function(W){return ee+"["+W+"]!=="+re+"["+W+"]"})).join("||"),"){",fe,"}")):(ee=te.def(oe,".",$),re=te.def(ae,".",$),fe(ee,");",ae,".",$,"=",ee,";"),Z("if(",ee,"!==",re,"){",fe,"}")),K(fe)})),W.compile()}(),compile:function(W,Z,K,$,ee){var te=x();te.stats=te.link(ee),Object.keys(Z.static).forEach((function(W){J(te,Z,W)})),Te.forEach((function(Z){J(te,W,Z)}));var re=O(W,Z,K,$);return function(W,Z){var K=W.proc("draw",1);L(W,K),E(W,K,Z.context),D(W,K,Z.framebuffer),T(W,K,Z),S(W,K,Z.state),M(W,K,Z,!1,!0);var $=Z.shader.progVar.append(W,K);if(K(W.shared.gl,".useProgram(",$,".program);"),Z.shader.program)Q(W,K,Z,Z.shader.program);else{K(W.shared.vao,".setVAO(null);");var ee=W.global.def("{}"),te=K.def($,".id"),re=K.def(ee,"[",te,"]");K(W.cond(re).then(re,".call(this,a0);").else(re,"=",ee,"[",te,"]=",W.link((function(K){return q(Q,W,Z,K,1)})),"(",$,");",re,".call(this,a0);"))}0<Object.keys(Z.state).length&&K(W.shared.current,".dirty=true;"),W.shared.vao&&K(W.shared.vao,".setVAO(null);")}(te,re),X(te,re),function(W,Z){function r(W){return W.contextDep&&$||W.propDep}var K=W.proc("batch",2);W.batchId="0",L(W,K);var $=!1,ee=!0;Object.keys(Z.context).forEach((function(W){$=$||Z.context[W].propDep})),$||(E(W,K,Z.context),ee=!1);var te=!1;if((re=Z.framebuffer)?(re.propDep?$=te=!0:re.contextDep&&$&&(te=!0),te||D(W,K,re)):D(W,K,null),Z.state.viewport&&Z.state.viewport.propDep&&($=!0),T(W,K,Z),S(W,K,Z.state,(function(W){return!r(W)})),Z.profile&&r(Z.profile)||M(W,K,Z,!1,"a1"),Z.contextDep=$,Z.needsContext=ee,Z.needsFramebuffer=te,(ee=Z.shader.progVar).contextDep&&$||ee.propDep)Y(W,K,Z,null);else if(ee=ee.append(W,K),K(W.shared.gl,".useProgram(",ee,".program);"),Z.shader.program)Y(W,K,Z,Z.shader.program);else{K(W.shared.vao,".setVAO(null);");var re=W.global.def("{}"),ne=(te=K.def(ee,".id"),K.def(re,"[",te,"]"));K(W.cond(ne).then(ne,".call(this,a0,a1);").else(ne,"=",re,"[",te,"]=",W.link((function(K){return q(Y,W,Z,K,2)})),"(",ee,");",ne,".call(this,a0,a1);"))}0<Object.keys(Z.state).length&&K(W.shared.current,".dirty=true;"),W.shared.vao&&K(W.shared.vao,".setVAO(null);")}(te,re),R(te.compile(),{destroy:function(){re.shader.program.destroy()}})}}}function M(W,Z){for(var K=0;K<W.length;++K)if(W[K]===Z)return K;return-1}var R=function(W,Z){for(var K=Object.keys(Z),$=0;$<K.length;++$)W[K[$]]=Z[K[$]];return W},W=0,Z={DynamicVariable:e,define:function(W,Z){return new e(W,t(Z+""))},isDynamic:function(W){return"function"==typeof W&&!W._reglType||W instanceof e},unbox:function t(W,Z){return"function"==typeof W?new e(0,W):"number"==typeof W||"boolean"==typeof W?new e(5,W):Array.isArray(W)?new e(6,W.map((function(W,K){return t(W,Z+"["+K+"]")}))):W instanceof e?W:void 0},accessor:t},K={next:"function"==typeof requestAnimationFrame?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:"function"==typeof cancelAnimationFrame?function(W){return cancelAnimationFrame(W)}:clearTimeout},$="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},ee=o();ee.zero=o();var Q=function(W,Z){var K=1;Z.ext_texture_filter_anisotropic&&(K=W.getParameter(34047));var $=1,te=1;Z.webgl_draw_buffers&&($=W.getParameter(34852),te=W.getParameter(36063));var re=!!Z.oes_texture_float;if(re){re=W.createTexture(),W.bindTexture(3553,re),W.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var ne=W.createFramebuffer();if(W.bindFramebuffer(36160,ne),W.framebufferTexture2D(36160,36064,3553,re,0),W.bindTexture(3553,null),36053!==W.checkFramebufferStatus(36160))re=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(16384);var ie=ee.allocType(5126,4);W.readPixels(0,0,1,1,6408,5126,ie),W.getError()?re=!1:(W.deleteFramebuffer(ne),W.deleteTexture(re),re=1===ie[0]),ee.freeType(ie)}}return ie=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(ie=W.createTexture(),ne=ee.allocType(5121,36),W.activeTexture(33984),W.bindTexture(34067,ie),W.texImage2D(34069,0,6408,3,3,0,6408,5121,ne),ee.freeType(ne),W.bindTexture(34067,null),W.deleteTexture(ie),ie=!W.getError()),{colorBits:[W.getParameter(3410),W.getParameter(3411),W.getParameter(3412),W.getParameter(3413)],depthBits:W.getParameter(3414),stencilBits:W.getParameter(3415),subpixelBits:W.getParameter(3408),extensions:Object.keys(Z).filter((function(W){return!!Z[W]})),maxAnisotropic:K,maxDrawbuffers:$,maxColorAttachments:te,pointSizeDims:W.getParameter(33901),lineWidthDims:W.getParameter(33902),maxViewportDims:W.getParameter(3386),maxCombinedTextureUnits:W.getParameter(35661),maxCubeMapSize:W.getParameter(34076),maxRenderbufferSize:W.getParameter(34024),maxTextureUnits:W.getParameter(34930),maxTextureSize:W.getParameter(3379),maxAttributes:W.getParameter(34921),maxVertexUniforms:W.getParameter(36347),maxVertexTextureUnits:W.getParameter(35660),maxVaryingVectors:W.getParameter(36348),maxFragmentUniforms:W.getParameter(36349),glsl:W.getParameter(35724),renderer:W.getParameter(7937),vendor:W.getParameter(7936),version:W.getParameter(7938),readFloat:re,npotTextureCube:ie}},G=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},Y=function(W){return Object.keys(W).map((function(Z){return W[Z]}))},te={shape:function(W){for(var Z=[];W.length;W=W[0])Z.push(W.length);return Z},flatten:function(W,Z,K,$){var te=1;if(Z.length)for(var re=0;re<Z.length;++re)te*=Z[re];else te=0;switch(K=$||ee.allocType(K,te),Z.length){case 0:break;case 1:for($=Z[0],Z=0;Z<$;++Z)K[Z]=W[Z];break;case 2:for($=Z[0],Z=Z[1],re=te=0;re<$;++re)for(var ne=W[re],ie=0;ie<Z;++ie)K[te++]=ne[ie];break;case 3:s(W,Z[0],Z[1],Z[2],K,0);break;default:!function e(W,Z,K,$,ee){for(var te=1,re=K+1;re<Z.length;++re)te*=Z[re];var ne=Z[K];if(4==Z.length-K){var ie=Z[K+1],oe=Z[K+2];for(Z=Z[K+3],re=0;re<ne;++re)s(W[re],ie,oe,Z,$,ee),ee+=te}else for(re=0;re<ne;++re)e(W[re],Z,K+1,$,ee),ee+=te}(W,Z,0,K,0)}return K}},re={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ne={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},ie={dynamic:35048,stream:35040,static:35044},oe=te.flatten,ae=te.shape,se=[];se[5120]=1,se[5122]=2,se[5124]=4,se[5121]=1,se[5123]=2,se[5125]=4,se[5126]=4;var fe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ue=new Float32Array(1),ce=new Uint32Array(ue.buffer),le=[9984,9986,9985,9987],pe=[0,6409,6410,6407,6408],de={};de[6409]=de[6406]=de[6402]=1,de[34041]=de[6410]=2,de[6407]=de[35904]=3,de[6408]=de[35906]=4;var he=g("HTMLCanvasElement"),me=g("OffscreenCanvas"),ge=g("CanvasRenderingContext2D"),ve=g("ImageBitmap"),be=g("HTMLImageElement"),xe=g("HTMLVideoElement"),we=Object.keys(re).concat([he,me,ge,ve,be,xe]),Ae=[];Ae[5121]=1,Ae[5126]=4,Ae[36193]=2,Ae[5123]=2,Ae[5125]=4;var De=[];De[32854]=2,De[32855]=2,De[36194]=2,De[34041]=4,De[33776]=.5,De[33777]=.5,De[33778]=1,De[33779]=1,De[35986]=.5,De[35987]=1,De[34798]=1,De[35840]=.5,De[35841]=.25,De[35842]=.5,De[35843]=.25,De[36196]=.5;var Ce=[];Ce[32854]=2,Ce[32855]=2,Ce[36194]=2,Ce[33189]=2,Ce[36168]=1,Ce[34041]=4,Ce[35907]=4,Ce[34836]=16,Ce[34842]=8,Ce[34843]=6;var ye=function(W,Z,K,$,ee){function a(W){this.id=ne++,this.refCount=1,this.renderbuffer=W,this.format=32854,this.height=this.width=0,ee.profile&&(this.stats={size:0})}function f(Z){var K=Z.renderbuffer;W.bindRenderbuffer(36161,null),W.deleteRenderbuffer(K),Z.renderbuffer=null,Z.refCount=0,delete ie[Z.id],$.renderbufferCount--}var te={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};Z.ext_srgb&&(te.srgba=35907),Z.ext_color_buffer_half_float&&(te.rgba16f=34842,te.rgb16f=34843),Z.webgl_color_buffer_float&&(te.rgba32f=34836);var re=[];Object.keys(te).forEach((function(W){re[te[W]]=W}));var ne=0,ie={};return a.prototype.decRef=function(){0>=--this.refCount&&f(this)},ee.profile&&($.getTotalRenderbufferSize=function(){var W=0;return Object.keys(ie).forEach((function(Z){W+=ie[Z].stats.size})),W}),{create:function(Z,K){function f(Z,K){var $=0,ie=0,oe=32854;if("object"==typeof Z&&Z?("shape"in Z?($=0|(ie=Z.shape)[0],ie=0|ie[1]):("radius"in Z&&($=ie=0|Z.radius),"width"in Z&&($=0|Z.width),"height"in Z&&(ie=0|Z.height)),"format"in Z&&(oe=te[Z.format])):"number"==typeof Z?($=0|Z,ie="number"==typeof K?0|K:$):Z||($=ie=1),$!==ne.width||ie!==ne.height||oe!==ne.format)return f.width=ne.width=$,f.height=ne.height=ie,ne.format=oe,W.bindRenderbuffer(36161,ne.renderbuffer),W.renderbufferStorage(36161,oe,$,ie),ee.profile&&(ne.stats.size=Ce[ne.format]*ne.width*ne.height),f.format=re[ne.format],f}var ne=new a(W.createRenderbuffer());return ie[ne.id]=ne,$.renderbufferCount++,f(Z,K),f.resize=function(Z,K){var $=0|Z,te=0|K||$;return $===ne.width&&te===ne.height||(f.width=ne.width=$,f.height=ne.height=te,W.bindRenderbuffer(36161,ne.renderbuffer),W.renderbufferStorage(36161,ne.format,$,te),ee.profile&&(ne.stats.size=Ce[ne.format]*ne.width*ne.height)),f},f._reglType="renderbuffer",f._renderbuffer=ne,ee.profile&&(f.stats=ne.stats),f.destroy=function(){ne.decRef()},f},clear:function(){Y(ie).forEach(f)},restore:function(){Y(ie).forEach((function(Z){Z.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(36161,Z.renderbuffer),W.renderbufferStorage(36161,Z.format,Z.width,Z.height)})),W.bindRenderbuffer(36161,null)}}},_e=[];_e[6408]=4,_e[6407]=3;var Oe=[];Oe[5121]=1,Oe[5126]=4,Oe[36193]=2;var ke=["x","y","z","w"],Te="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Se={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},je={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ee={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Me={cw:2304,ccw:2305},Pe=new B(!1,!1,!1,(function(){}));return function(W){function t(){if(0===De.length)ae&&ae.update(),ke=null;else{ke=K.next(t),l();for(var W=De.length-1;0<=W;--W){var Z=De[W];Z&&Z(ce,null,0)}ee.flush(),ae&&ae.update()}}function r(){!ke&&0<De.length&&(ke=K.next(t))}function n(){ke&&(K.cancel(t),ke=null)}function a(W){W.preventDefault(),n(),Ce.forEach((function(W){W()}))}function f(W){ee.getError(),re.restore(),me.restore(),pe.restore(),ge.restore(),ve.restore(),be.restore(),he.restore(),ae&&ae.restore(),xe.procs.refresh(),r(),_e.forEach((function(W){W()}))}function o(W){function t(W,K){var $={},ee={};return Object.keys(W).forEach((function(te){var re=W[te];if(Z.isDynamic(re))ee[te]=Z.unbox(re,te);else{if(K&&Array.isArray(re))for(var ne=0;ne<re.length;++ne)if(Z.isDynamic(re[ne]))return void(ee[te]=Z.unbox(re,te));$[te]=re}})),{dynamic:ee,static:$}}var K=t(W.context||{},!0),$=t(W.uniforms||{},!0),ee=t(W.attributes||{},!1);W=t(function(W){function t(W){if(W in Z){var K=Z[W];delete Z[W],Object.keys(K).forEach((function($){Z[W+"."+$]=K[$]}))}}var Z=R({},W);return delete Z.uniforms,delete Z.attributes,delete Z.context,delete Z.vao,"stencil"in Z&&Z.stencil.op&&(Z.stencil.opBack=Z.stencil.opFront=Z.stencil.op,delete Z.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),"vao"in W&&(Z.vao=W.vao),Z}(W),!1);var te={gpuTime:0,cpuTime:0,count:0},re=xe.compile(W,ee,$,K,te),ne=re.draw,ie=re.batch,oe=re.scope,ae=[];return R((function(W,Z){var K;if("function"==typeof W)return oe.call(this,null,W,0);if("function"==typeof Z)if("number"==typeof W)for(K=0;K<W;++K)oe.call(this,null,Z,K);else{if(!Array.isArray(W))return oe.call(this,W,Z,0);for(K=0;K<W.length;++K)oe.call(this,W[K],Z,K)}else if("number"==typeof W){if(0<W)return ie.call(this,function(W){for(;ae.length<W;)ae.push(null);return ae}(0|W),0|W)}else{if(!Array.isArray(W))return ne.call(this,W);if(W.length)return ie.call(this,W,W.length)}}),{stats:te,destroy:function(){re.destroy()}})}function u(W,Z){var K=0;xe.procs.poll();var $=Z.color;$&&(ee.clearColor(+$[0]||0,+$[1]||0,+$[2]||0,+$[3]||0),K|=16384),"depth"in Z&&(ee.clearDepth(+Z.depth),K|=256),"stencil"in Z&&(ee.clearStencil(0|Z.stencil),K|=1024),ee.clear(K)}function s(W){return De.push(W),r(),{cancel:function(){var Z=M(De,W);De[Z]=function e(){var W=M(De,e);De[W]=De[De.length-1],--De.length,0>=De.length&&n()}}}}function c(){var W=we.viewport,Z=we.scissor_box;W[0]=W[1]=Z[0]=Z[1]=0,ce.viewportWidth=ce.framebufferWidth=ce.drawingBufferWidth=W[2]=Z[2]=ee.drawingBufferWidth,ce.viewportHeight=ce.framebufferHeight=ce.drawingBufferHeight=W[3]=Z[3]=ee.drawingBufferHeight}function l(){ce.tick+=1,ce.time=m(),c(),xe.procs.poll()}function p(){ge.refresh(),c(),xe.procs.refresh(),ae&&ae.update()}function m(){return($()-se)/1e3}if(!(W=i(W)))return null;var ee=W.gl,te=ee.getContextAttributes();ee.isContextLost();var re=function(W,Z){function r(Z){var $;Z=Z.toLowerCase();try{$=K[Z]=W.getExtension(Z)}catch(W){}return!!$}for(var K={},$=0;$<Z.extensions.length;++$){var ee=Z.extensions[$];if(!r(ee))return Z.onDestroy(),Z.onDone('"'+ee+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Z.optionalExtensions.forEach(r),{extensions:K,restore:function(){Object.keys(K).forEach((function(W){if(K[W]&&!r(W))throw Error("(regl): error restoring extension "+W)}))}}}(ee,W);if(!re)return null;var ne=function(){var W={"":0},Z=[""];return{id:function(K){var $=W[K];return $||($=W[K]=Z.length,Z.push(K),$)},str:function(W){return Z[W]}}}(),ie={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},oe=re.extensions,ae=function(W,Z){function r(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function n(W,Z,K){var $=ee.pop()||new r;$.startQueryIndex=W,$.endQueryIndex=Z,$.sum=0,$.stats=K,te.push($)}if(!Z.ext_disjoint_timer_query)return null;var K=[],$=[],ee=[],te=[],re=[],ne=[];return{beginQuery:function(W){var ee=K.pop()||Z.ext_disjoint_timer_query.createQueryEXT();Z.ext_disjoint_timer_query.beginQueryEXT(35007,ee),$.push(ee),n($.length-1,$.length,W)},endQuery:function(){Z.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:n,update:function(){var W,ie;if(0!==(W=$.length)){ne.length=Math.max(ne.length,W+1),re.length=Math.max(re.length,W+1),re[0]=0;var oe=ne[0]=0;for(ie=W=0;ie<$.length;++ie){var ae=$[ie];Z.ext_disjoint_timer_query.getQueryObjectEXT(ae,34919)?(oe+=Z.ext_disjoint_timer_query.getQueryObjectEXT(ae,34918),K.push(ae)):$[W++]=ae,re[ie+1]=oe,ne[ie+1]=W}for($.length=W,ie=W=0;ie<te.length;++ie){var se=(oe=te[ie]).startQueryIndex;ae=oe.endQueryIndex,oe.sum+=re[ae]-re[se],se=ne[se],(ae=ne[ae])===se?(oe.stats.gpuTime+=oe.sum/1e6,ee.push(oe)):(oe.startQueryIndex=se,oe.endQueryIndex=ae,te[W++]=oe)}te.length=W}},getNumPendingQueries:function(){return $.length},clear:function(){K.push.apply(K,$);for(var W=0;W<K.length;W++)Z.ext_disjoint_timer_query.deleteQueryEXT(K[W]);$.length=0,K.length=0},restore:function(){$.length=0,K.length=0}}}(0,oe),se=$(),fe=ee.drawingBufferWidth,ue=ee.drawingBufferHeight,ce={tick:0,time:0,viewportWidth:fe,viewportHeight:ue,framebufferWidth:fe,framebufferHeight:ue,drawingBufferWidth:fe,drawingBufferHeight:ue,pixelRatio:W.pixelRatio},le=(fe={elements:null,primitive:4,count:-1,offset:0,instances:-1},Q(ee,oe)),pe=d(ee,ie,W,(function(W){return he.destroyBuffer(W)})),de=h(ee,oe,pe,ie),he=D(ee,oe,le,ie,pe,de,fe),me=T(ee,ne,ie,W),ge=_(ee,oe,le,(function(){xe.procs.poll()}),ce,ie,W),ve=ye(ee,oe,0,ie,W),be=O(ee,oe,le,ge,ve,ie),xe=L(ee,ne,oe,le,pe,de,0,be,{},he,me,fe,ce,ae,W),we=(ne=S(ee,be,xe.procs.poll,ce),xe.next),Ae=ee.canvas,De=[],Ce=[],_e=[],Oe=[W.onDestroy],ke=null;Ae&&(Ae.addEventListener("webglcontextlost",a,!1),Ae.addEventListener("webglcontextrestored",f,!1));var Te=be.setFBO=o({framebuffer:Z.define.call(null,1,"framebuffer")});return p(),te=R(o,{clear:function(W){if("framebuffer"in W)if(W.framebuffer&&"framebufferCube"===W.framebuffer_reglType)for(var Z=0;6>Z;++Z)Te(R({framebuffer:W.framebuffer.faces[Z]},W),u);else Te(W,u);else u(0,W)},prop:Z.define.bind(null,1),context:Z.define.bind(null,2),this:Z.define.bind(null,3),draw:o({}),buffer:function(W){return pe.create(W,34962,!1,!1)},elements:function(W){return de.create(W,!1)},texture:ge.create2D,cube:ge.createCube,renderbuffer:ve.create,framebuffer:be.create,framebufferCube:be.createCube,vao:he.createVAO,attributes:te,frame:s,on:function(W,Z){var K;switch(W){case"frame":return s(Z);case"lost":K=Ce;break;case"restore":K=_e;break;case"destroy":K=Oe}return K.push(Z),{cancel:function(){for(var W=0;W<K.length;++W)if(K[W]===Z){K[W]=K[K.length-1],K.pop();break}}}},limits:le,hasExtension:function(W){return 0<=le.extensions.indexOf(W.toLowerCase())},read:ne,destroy:function(){De.length=0,n(),Ae&&(Ae.removeEventListener("webglcontextlost",a),Ae.removeEventListener("webglcontextrestored",f)),me.clear(),be.clear(),ve.clear(),he.clear(),ge.clear(),de.clear(),pe.clear(),ae&&ae.clear(),Oe.forEach((function(W){W()}))},_gl:ee,_refresh:p,poll:function(){l(),ae&&ae.update()},now:m,stats:ie}),W.onDone(null,te),te}},"object"==typeof K&&void 0!==Z?Z.exports=ee():$.createREGL=ee()},{}],88:[function(W,Z,K){Z.exports=W=>{if(0===W.length)return[[0,0,0],[0,0,0]];const Z=Array.isArray(W)&&Array.isArray(W[0]),K=Z?W[0].length:3,$=new Array(K),ee=new Array(K);for(let W=0;W<K;W+=1)$[W]=1/0,ee[W]=-1/0;if(Z)W.forEach((W=>{for(let te=0;te<K;te+=1){const K=Z?W[te]:W;ee[te]=K>ee[te]?K:ee[te],$[te]=K<$[te]?K:$[te]}}));else for(let Z=0;Z<W.length;Z+=K)for(let te=0;te<K;te+=1){const K=W[te+Z];ee[te]=K>ee[te]?K:ee[te],$[te]=K<$[te]?K:$[te]}return[$,ee]}},{}],89:[function(W,Z,K){const $=W("gl-vec3"),{flatten:ee}=W("@jscad/array-utils"),te=W("./boundingBox");Z.exports=(...W)=>{let Z;(W=ee(W)).forEach((W=>{let K=te(W.positions);K=K.map((Z=>$.transformMat4(Z,Z,W.transforms))),Z?($.min(Z[0],Z[0],K[0]),$.max(Z[1],Z[1],K[1])):Z=K}));const K=$.min($.create(),Z[1],Z[0]),re=$.max($.create(),Z[1],Z[0]),ne=$.subtract($.create(),re,K);let ie=$.scale($.create(),ne,.5);return ie=$.add(ie,K,ie),{dia:$.distance(ie,re),center:[...ie],min:[...K],max:[...re],size:[...ne]}}},{"./boundingBox":88,"@jscad/array-utils":4,"gl-vec3":59}],90:[function(W,Z,K){const $=W("gl-vec3"),ee=W("gl-mat4");Z.exports={toPerspectiveView:({camera:W})=>{const Z=$.distance(W.position,W.target),K=[Z,Z,Z];return{view:ee.lookAt(ee.create(),K,W.target,W.up),position:K}},toPresetView:(W,{camera:Z})=>{const K=$.distance(Z.position,Z.target),te=$.add($.create(),{top:[0,-1e-6,1],bottom:[0,0,-1],front:[0,1,0],back:[0,-1,0],left:[-1,0,0],right:[1,0,0],undefined:[0,0,0]}[W].map((W=>W*K)),Z.target);return{view:ee.lookAt(ee.create(),te,Z.target,Z.up),position:te}},fromOrthographicToPerspective:Z=>{const{near:K,far:$,fov:ee,zoom:te}=Z,{viewport:re}=Z,ne=W("./perspectiveCamera").setProjection(Z,{width:re[2],height:re[3]}),{projectionType:ie}=W("./perspectiveCamera").cameraState;return Object.assign({},Z,ne,{projectionType:ie},{near:K,far:$,fov:ee})},fromPerspectiveToOrthographic:Z=>{const{fov:K,aspect:ee}=Z,te=.3*$.length($.subtract([],Z.position,Z.target)),re=Math.tan(K)*te*ee,ne=Math.tan(K)*te,{near:ie,far:oe,viewport:ae}=Z,se={zoom:1,near:ie,far:oe},fe=W("./orthographicCamera").cameraState,ue=W("./orthographicCamera").setProjection(se,{width:re,height:ne});return Object.assign({},fe,Z,ue,{projectionType:fe.projectionType,viewport:ae})}}},{"./orthographicCamera":91,"./perspectiveCamera":92,"gl-mat4":26,"gl-vec3":59}],91:[function(W,Z,K){const $=W("gl-mat4"),ee={view:$.identity(new Float32Array(16)),projection:$.identity(new Float32Array(16)),matrix:$.identity(new Float32Array(16)),near:1,far:1300,up:[0,0,1],eye:new Float32Array(3),position:[150,250,200],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],zoom:1,projectionType:"orthographic"};Z.exports={cameraState:ee,cameraProps:{},setProjection:(W,Z)=>{const{width:K,height:ee}=Z,te=K/ee,re=[0,0,K,ee],ne=W.zoom,ie=-K*ne,oe=K*ne,ae=-ee*ne,se=ee*ne;return{projection:$.ortho([],ie,oe,ae,se,W.near,W.far),aspect:te,viewport:re}}}},{"gl-mat4":26}],92:[function(W,Z,K){const $=W("gl-mat4"),ee=W("gl-vec3"),te={view:$.identity(new Float32Array(16)),projection:$.identity(new Float32Array(16)),matrix:$.identity(new Float32Array(16)),near:1,far:18e3,up:[0,0,1],eye:new Float32Array(3),position:[450,550,700],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],projectionType:"perspective"},re={},ne=Object.assign({},te,re);Z.exports={cameraState:te,cameraProps:re,defaults:ne,setProjection:(W,Z,K)=>{const ee=K.width/K.height,te=$.perspective($.identity([]),Z.fov,ee,Z.near,Z.far),re=[0,0,K.width,K.height],ne=W||{};return ne.projection=te,ne.aspect=ee,ne.viewport=re,ne},update:(W,Z)=>{Z||(Z=W);const{position:K,target:te,up:re}=Z,ne=ee.subtract([],K,te),ie=ee.add(ee.create(),te,ne),oe=$.lookAt($.create(),ie,te,re),ae=W||{};return ae.position=ie,ae.view=oe,ae}}},{"gl-mat4":26,"gl-vec3":59}],93:[function(W,Z,K){const $=W("gl-vec3"),ee=W("gl-mat4"),{max:te,min:re,sqrt:ne,PI:ie,sin:oe,cos:ae,atan2:se}=Math,fe=W("../bound-utils/computeBounds"),ue={limits:{minDistance:.01,maxDistance:1e4},drag:.27,EPS:1e-6,zoomToFit:{auto:!0,targets:"all",tightness:1.5},userControl:{zoom:!0,zoomSpeed:1,rotate:!0,rotateSpeed:1,pan:!0,panSpeed:1},autoRotate:{enabled:!1,speed:1},autoAdjustPlanes:!0},ce={thetaDelta:0,phiDelta:0,scale:1},le=Object.assign({},ce,ue);Z.exports={controlsProps:ue,controlsState:ce,defaults:le,update:({controls:W,camera:Z},K)=>{const{EPS:fe,drag:ue}=W,{position:ce,target:le}=Z,pe=W.up?W.up:Z.up;let de=W.thetaDelta;const he=W.phiDelta,me=W.scale,ge=$.subtract([],ce,le);let ve,be;1===pe[2]?(ve=se(ge[0],ge[1]),be=se(ne(ge[0]*ge[0]+ge[1]*ge[1]),ge[2])):(ve=se(ge[0],ge[2]),be=se(ne(ge[0]*ge[0]+ge[2]*ge[2]),ge[1])),W.autoRotate.enabled&&W.userControl.rotate&&(de+=2*Math.PI/60/60*W.autoRotate.speed),ve+=de,be=te(fe,re(ie-fe,be+=he));const xe=te(W.limits.minDistance,re(W.limits.maxDistance,$.length(ge)*me));1===pe[2]?(ge[0]=xe*oe(be)*oe(ve),ge[2]=xe*ae(be),ge[1]=xe*oe(be)*ae(ve)):(ge[0]=xe*oe(be)*oe(ve),ge[1]=xe*ae(be),ge[2]=xe*oe(be)*ae(ve));const we=$.add($.create(),le,ge),Ae=ee.lookAt(ee.create(),we,le,pe),De=1-te(re(ue,1),.01);return{controls:{thetaDelta:de*De,phiDelta:he*De,scale:1,changed:$.distance(ce,we)>.001},camera:{position:we,view:Ae}}},rotate:({controls:W,camera:Z,speed:K=1},$)=>{let{thetaDelta:ee,phiDelta:te}=W;return W.userControl.rotate&&(ee+=$[0]*K,te+=$[1]*K),{controls:{thetaDelta:ee,phiDelta:te},camera:Z}},zoom:({controls:Z,camera:K,speed:ee=1},te=0)=>{let{scale:re}=Z;if(Z.userControl.zoom&&K&&void 0!==te&&0!==te&&!isNaN(te)){const ne=(te=te/te*(0===Math.sign(te)?1:Math.sign(te))*ee)+Z.scale,ie=$.distance(K.position,K.target)*ne;if(ie>Z.limits.minDistance&&ie<Z.limits.maxDistance&&(re+=te),"orthographic"===K.projectionType){const Z=.3*$.length($.subtract([],K.position,K.target)),ee=Math.tan(K.fov)*Z*K.aspect,te=Math.tan(K.fov)*Z;K=W("../cameras/orthographicCamera").setProjection(K,{width:ee,height:te})}}return{controls:{scale:re},camera:K}},pan:({controls:Z,camera:K,speed:te=1},re)=>{const ne=W("camera-unproject"),{projection:ie,view:oe,viewport:ae}=K,se=ee.multiply([],ie,oe),fe=ee.invert([],se),ue=[ae[2],ae[3],0],ce=[ae[2]-re[0],ae[3]+re[1],0],le=ne([],ue,ae,fe),pe=ne([],ce,ae,fe),de=$.distance(K.position,K.eye),he=$.subtract([],le,pe).map((W=>W*te*de*Z.scale));return{controls:Z,camera:{position:$.add($.create(),K.position,he),target:$.add($.create(),K.target,he)}}},zoomToFit:({controls:W,camera:Z,entities:K})=>{const{zoomToFit:ee}=W;if("all"!==ee.targets)return{controls:W,camera:Z};if(0===K.length)return{controls:W,camera:Z};const te=K.map((W=>W.geometry)),re=fe(te),{fov:ne,target:ie,position:oe}=Z,{tightness:ae}=Object.assign({},ee,ue.zoomToFit),se=re.dia*ae/Math.tan(ne/2)/$.distance(ie,oe);return{camera:{target:re.center},controls:{scale:se}}},reset:({controls:W,camera:Z},K)=>({camera:{position:K.camera.position,target:K.camera.target,projection:ee.perspective([],Z.fov,Z.aspect,Z.near,Z.far),view:K.camera.view},controls:{thetaDelta:K.controls.thetaDelta,phiDelta:K.controls.phiDelta,scale:K.controls.scale}})}},{"../bound-utils/computeBounds":89,"../cameras/orthographicCamera":91,"camera-unproject":9,"gl-mat4":26,"gl-vec3":59}],94:[function(W,Z,K){const{flatten:$,toArray:ee}=W("@jscad/array-utils"),{meshColor:te}=W("../rendering/renderDefaults"),re=W("./geom2ToGeometries"),ne=W("./geom3ToGeometries"),ie=W("./path2ToGeometries");Z.exports=(W,...Z)=>{const K={color:te,smoothNormals:!0},{color:oe,smoothNormals:ae}=Object.assign({},K,W);Z=(Z=$(ee(Z))).filter((W=>W&&W instanceof Object));const se=[];return Z.forEach((W=>{let Z=[];"sides"in W?Z=re({color:oe},W):"points"in W?Z=ie({color:oe},W):"polygons"in W&&(Z=ne({smoothLighting:ae,normalThreshold:.3,color:oe},W)),se.push(...(W=>W.map((W=>({geometry:W,visuals:{drawCmd:"2d"===W.type?"drawLines":"drawMesh",show:!0,transparent:W.isTransparent,useVertexColors:!0}}))))(Z))})),se}},{"../rendering/renderDefaults":111,"./geom2ToGeometries":95,"./geom3ToGeometries":96,"./path2ToGeometries":97,"@jscad/array-utils":4}],95:[function(W,Z,K){const $=W("gl-mat4"),ee=Math.floor(32767.5);Z.exports=(W,Z)=>{let{color:K}=W;const te=Z.sides;if(0===te.length)return[];"color"in Z&&(K=Z.color);const re=K[3]<1,ne=[],ie=Math.floor(te.length/ee)+1,a=(W,Z)=>{ne.push(W,Z||W)},oe=[];for(let W=0;W<ie;W++){const ie=W*ee,ae=Math.min(ie+ee,te.length),se=[];for(let W=ie;W<ae;W++){const Z=te[W];if(Z.color){if(0===ne.length&&se.length>0){const W=se.length;for(let Z=0;Z<W;Z++)ne.push(K)}a(Z.color,Z.endColor)}else ne.length&&a(K);se.push([Z[0][0],Z[0][1],0]),se.push([Z[1][0],Z[1][1],0])}const fe=se.map((W=>[0,0,-1])),ue=se.map(((W,Z)=>Z)),ce=Z.transforms?$.clone(Z.transforms):$.create();oe.push({type:"2d",positions:se,normals:fe,indices:ue,transforms:ce,color:K,colors:ne,isTransparent:re})}return oe}},{"gl-mat4":26}],96:[function(W,Z,K){const $=W("gl-vec3"),ee=W("gl-mat4"),polygonColor=(W,Z)=>{let K=Z;return W.color&&(K=W.color),K&&K.length<4&&K.push(1),K},calculateNormal=W=>{if(W.plane)return $.clone(W.plane);const Z=W.vertices,K=$.create();$.subtract(K,Z[1],Z[0]);const ee=$.create();$.subtract(ee,Z[2],Z[0]);const te=$.create();return $.cross(te,K,ee),$.normalize(te,te),te};Z.exports=(W,Z)=>{let{color:K,smoothLighting:$}=W;"color"in Z&&(K=Z.color);const te=Z.polygons,re=Z.transforms?ee.clone(Z.transforms):ee.create(),ne=[];let ie=0;for(;ie<te.length;){let W=0,Z=ie;for(let K=ie;K<te.length&&!((W+=te[K].vertices.length)>65535);K++)Z++;const $=[],ee=[],oe=[],ae=[],se=K[3]<1;for(let W=ie;W<Z;W++){const Z=te[W],re=Z.vertices,ne=calculateNormal(Z),ie=polygonColor(Z,K),se=[];for(let W=0;W<re.length;W++){const Z=re[W];$.push(Z),ee.push(ne),ae.push(ie);const K=$.length-1;se.push(K)}for(let W=2;W<se.length;W++)oe.push([se[0],se[W-1],se[W]])}const fe={type:"3d",positions:$,normals:ee,indices:oe,colors:ae,transforms:re,isTransparent:se};ne.push(fe),ie=Z}return ne}},{"gl-mat4":26,"gl-vec3":59}],97:[function(W,Z,K){const $=W("gl-mat4"),ee=Math.floor(32767.5)-2;Z.exports=(W,Z)=>{let{color:K}=W;const te=Z.points;if(0===te.length)return[];"color"in Z&&(K=Z.color);const re=K[3]<1,ne=Math.floor(te.length/ee)+1,ie=[];for(let W=0;W<ne;W++){const oe=W*ee,ae=Math.min(oe+ee,te.length),se=[];let fe;for(let W=oe;W<ae;W++){const Z=te[W];fe&&(se.push([fe[0],fe[1],0]),se.push([Z[0],Z[1],0])),fe=Z}if(W+1===ne&&Z.isClosed&&fe){const W=te[0];se.push([fe[0],fe[1],0]),se.push([W[0],W[1],0])}const ue=se.map((W=>[0,0,-1])),ce=se.map(((W,Z)=>Z)),le=Z.transforms?$.clone(Z.transforms):$.create();ie.push({type:"2d",positions:se,normals:ue,indices:ce,transforms:le,color:K,isTransparent:re})}return ie}},{"gl-mat4":26}],98:[function(W,Z,K){Z.exports={prepareRender:W("./rendering/render"),drawCommands:{drawGrid:W("./rendering/commands/drawGrid/multi.js"),drawAxis:W("./rendering/commands/drawAxis"),drawMesh:W("./rendering/commands/drawMesh"),drawLines:W("./rendering/commands/drawLines")},cameras:{camera:W("./cameras/camera"),orthographic:W("./cameras/orthographicCamera"),perspective:W("./cameras/perspectiveCamera")},controls:{orbit:W("./controls/orbitControls")},entitiesFromSolids:W("./geometry-utils-V2/entitiesFromSolids")}},{"./cameras/camera":90,"./cameras/orthographicCamera":91,"./cameras/perspectiveCamera":92,"./controls/orbitControls":93,"./geometry-utils-V2/entitiesFromSolids":94,"./rendering/commands/drawAxis":99,"./rendering/commands/drawGrid/multi.js":101,"./rendering/commands/drawLines":103,"./rendering/commands/drawMesh":106,"./rendering/render":109}],99:[function(W,Z,K){const $=W("gl-mat4");Z.exports=(W,Z)=>{let{size:K,xColor:ee,yColor:te,zColor:re,lineWidth:ne,alwaysVisible:ie}=Object.assign({},{xColor:[1,0,0,1],yColor:[0,1,0,1],zColor:[0,0,1,1],size:10,lineWidth:3,alwaysVisible:!0},Z);ne>W.limits.lineWidthDims[1]&&(ne=W.limits.lineWidthDims[1]);const oe=[0,0,0,K,0,0],ae={frag:"precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",vert:"\n    precision mediump float;\n    attribute vec3 position;\n    uniform mat4 model, view, projection;\n    void main() {\n      gl_Position = projection * view * model * vec4(position, 1);\n    }",uniforms:{model:(W,Z)=>Z&&Z.model?Z.model:$.identity([]),color:(W,Z)=>Z.color,angle:(W,Z)=>Z.angle},attributes:{position:oe},count:oe.length/3,primitive:"line loop",lineWidth:ne,depth:{enable:!ie}},se=$.identity([]),fe=$.rotateZ($.create(),$.identity([]),Math.PI/2),ue=$.rotateY($.create(),$.identity([]),-Math.PI/2),ce=W(ae);return W=>{const Z={model:$.identity([])};return W=Object.assign({},Z,W),ce([{color:ee,model:$.multiply($.create(),W.model,se)},{color:te,model:$.multiply($.create(),W.model,fe)},{color:re,model:$.multiply($.create(),W.model,ue)}])}}},{"gl-mat4":26}],100:[function(W,Z,K){const $=W("gl-mat4");Z.exports=(W,Z={})=>{const K=[],ee={visuals:{color:[0,0,1,1],fadeOut:!1},ticks:1,size:[16,16],centered:!1,lineWidth:2},te=Object.assign({},ee.visuals,Z.visuals||{}),{fadeOut:re,color:ne}=te,{size:ie,ticks:oe,centered:ae,lineWidth:se}=Object.assign({},ee,Z),fe=ie[0],ue=ie[1];if(ae){const W=.5*fe,Z=.5*ue,$=W%oe-W,ee=-$,te=Z%oe-Z,re=-te,ne=0;for(let W=$,Z=0;W<=ee;W+=oe,Z+=1)Z%ne!=0&&(K.push(te,W,0),K.push(re,W,0),K.push(te,W,0));for(let W=te,Z=0;W<=re;W+=oe,Z+=1)Z%ne!=0&&(K.push(W,$,0),K.push(W,ee,0),K.push(W,$,0))}else{for(let W=.5*-fe;W<=.5*fe;W+=oe)K.push(.5*-ue,W,0),K.push(.5*ue,W,0),K.push(.5*-ue,W,0);for(let W=.5*-ue;W<=.5*ue;W+=oe)K.push(W,.5*-fe,0),K.push(W,.5*fe,0),K.push(W,.5*-fe,0)}return W({vert:"precision mediump float;\n\n    uniform float camNear, camFar;\n    uniform mat4 model, view, projection;\n\n    attribute vec3 position;\n    varying vec3 fragNormal, fragPosition;\n    varying vec4 worldPosition;\n\n    void main() {\n      fragPosition = position;\n      worldPosition = model * vec4(position, 1);\n      vec4 glPosition = projection * view * worldPosition;\n      gl_Position = glPosition;\n    }",frag:"precision mediump float;\n    uniform vec4 color;\n    varying vec3 fragNormal, fragPosition;\n    varying vec4 worldPosition;\n\n    uniform vec4 fogColor;\n    uniform bool fadeOut;\n    void main() {\n      float dist = .5;\n      if(fadeOut){\n        dist = distance( vec2(0.,0.), vec2(worldPosition.x, worldPosition.y));\n        dist *= 0.0025;\n        dist = sqrt(dist);\n      }\n\n      gl_FragColor = mix(color, fogColor, dist);\n    }\n    ",attributes:{position:W.buffer(K)},count:K.length/3,uniforms:{model:(W,Z)=>Z&&Z.model?Z.model:$.identity([]),color:(W,Z)=>Z&&Z.color?Z.color:ne,fogColor:(W,Z)=>Z&&Z.color?[Z.color[0],Z.color[1],Z.color[2],0]:[ne[0],ne[1],ne[2],0],fadeOut:(W,Z)=>Z&&void 0!==Z.fadeOut?Z.fadeOut:re},lineWidth:(Z,K)=>Math.min(K&&K.lineWidth?K.lineWidth:se,W.limits.lineWidthDims[1]),primitive:"lines",cull:{enable:!0,face:"front"},polygonOffset:{enable:!0,offset:{factor:1,units:10*Math.random()}},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}})}},{"gl-mat4":26}],101:[function(W,Z,K){Z.exports=(Z,K)=>{const{size:$,ticks:ee}=Object.assign({},{size:[50,50],ticks:[10,1]},K),te=W("./index")(Z,{size:$,ticks:ee[0]}),re=W("./index")(Z,{size:$,ticks:ee[1]});return W=>{te(W),re({color:W.subColor,fadeOut:W.fadeOut})}}},{"./index":100}],102:[function(W,Z,K){Z.exports={frag:"\nprecision mediump float;\nuniform vec4 ucolor;\n\nvoid main () {\n  gl_FragColor = ucolor;\n}\n"}},{}],103:[function(W,Z,K){const $=W("gl-mat4"),{meshColor:ee}=W("../../renderDefaults");Z.exports=(Z,K={})=>{const te={color:ee,geometry:void 0};let{geometry:re,color:ne,transparent:ie}=Object.assign({},te,K);"color"in re&&(ne=re.color);const oe=!!(re.indices&&re.indices.length>0),ae=!!(re.normals&&re.normals.length>0),se=!!(re.colors&&re.colors.length>0),fe={primitive:"lines",vert:se?W("./vColorShaders").vert:W("./meshShaders").vert,frag:se?W("./vColorShaders").frag:W("./colorOnlyShaders").frag,uniforms:{model:(W,Z)=>Z.model||re.transforms||$.create(),ucolor:(W,Z)=>Z&&Z.color?Z.color:ne},attributes:{position:Z.buffer({usage:"static",type:"float",data:re.positions})}};return ie&&(fe.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),se&&(fe.attributes.color=Z.buffer({usage:"static",type:"float",data:re.colors})),oe&&(fe.elements=Z.elements({usage:"static",type:"uint16",data:re.indices})),ae&&(fe.attributes.normal=Z.buffer({usage:"static",type:"float",data:re.normals})),Z(fe)}},{"../../renderDefaults":111,"./colorOnlyShaders":102,"./meshShaders":104,"./vColorShaders":105,"gl-mat4":26}],104:[function(W,Z,K){Z.exports={vert:"\nprecision mediump float;\n\nuniform float camNear, camFar;\nuniform mat4 model, view, projection;\n\nattribute vec3 position, normal;\n\n\nvarying vec3 surfaceNormal, surfacePosition;\nvarying vec4 _worldSpacePosition;\n\n\nvoid main() {\n\n\n  surfacePosition = position;\n  surfaceNormal = normal;\n  vec4 worldSpacePosition = model * vec4(position, 1);\n  _worldSpacePosition = worldSpacePosition;\n\n  vec4 glPosition = projection * view * model * vec4(position, 1);\n  gl_Position = glPosition;\n}\n",frag:"\nprecision mediump float;\nvarying vec3 surfaceNormal;\nuniform float ambientLightAmount;\nuniform float diffuseLightAmount;\nuniform vec4 ucolor;\nuniform vec3 lightDirection;\nuniform vec3 opacity;\n\nvarying vec4 _worldSpacePosition;\n\nuniform vec2 printableArea;\n\nvec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);\n\nvoid main () {\n  vec4 depth = gl_FragCoord;\n\n  float v = 0.8; // shadow value\n  vec4 endColor = ucolor;\n\n  vec3 ambient = ambientLightAmount * endColor.rgb;\n  float cosTheta = dot(surfaceNormal, lightDirection);\n  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );\n\n  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));\n  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );\n\n  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);\n}"}},{}],105:[function(W,Z,K){Z.exports={frag:"\nprecision mediump float;\nvarying vec4 vColor;\n\nvoid main () {\n  gl_FragColor = vColor;\n}\n",vert:"\nprecision mediump float;\n\nuniform float camNear, camFar;\nuniform mat4 model, view, projection;\n\nattribute vec3 position, normal;\nattribute vec4 color;\n\nvarying vec3 surfaceNormal, surfacePosition;\nvarying vec4 _worldSpacePosition;\nvarying vec4 vColor;\n\nvoid main() {\n  vColor = color;\n\n  surfacePosition = position;\n  surfaceNormal = normal;\n  vec4 worldSpacePosition = model * vec4(position, 1);\n  _worldSpacePosition = worldSpacePosition;\n\n  vec4 glPosition = projection * view * model * vec4(position, 1);\n  gl_Position = glPosition;\n}\n"}},{}],106:[function(W,Z,K){const $=W("gl-mat4"),{meshColor:ee}=W("../../renderDefaults");Z.exports=(Z,K={extras:{}})=>{const te={useVertexColors:!0,dynamicCulling:!0,geometry:void 0,color:ee,visuals:{}},{geometry:re,dynamicCulling:ne,useVertexColors:ie,color:oe,visuals:ae}=Object.assign({},te,K),se=Z.buffer([]),fe=!!(re.indices&&re.indices.length>0),ue=!!(re.normals&&re.normals.length>0),ce="transparent"in ae&&ae.transparent,le=!!(ie&&re.colors&&re.colors.length>0),pe=re.transforms||$.create(),de=$.determinant(pe)<0,he=ne&&de?"front":"back",me=le?W("./vColorShaders").vert:W("./meshShaders").vert,ge=le?W("./vColorShaders").frag:W("./meshShaders").frag,ve=$.invert($.create(),pe);let be={primitive:"triangles",vert:me,frag:ge,uniforms:{model:(W,Z)=>pe,ucolor:(W,Z)=>Z&&Z.color?Z.color:oe,vColorToggler:(W,Z)=>Z&&Z.useVertexColors&&!0===Z.useVertexColors?1:0,unormal:(W,Z)=>{const K=$.invert($.create(),Z.camera.view);return $.multiply(K,ve,K),$.transpose(K,K),K}},attributes:{position:Z.buffer({usage:"static",type:"float",data:re.positions}),ao:se},cull:{enable:!0,face:he}};return ce&&(be.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),re.cells?be.elements=re.cells:fe?be.elements=Z.elements({usage:"static",type:"uint16",data:re.indices}):re.triangles?be.elements=re.triangles:be.count=re.positions.length/3,ue&&(be.attributes.normal=Z.buffer({usage:"static",type:"float",data:re.normals})),le&&(be.attributes.color=Z.buffer({usage:"static",type:"float",data:re.colors})),Z(be=Object.assign({},be,K.extras))}},{"../../renderDefaults":111,"./meshShaders":107,"./vColorShaders":108,"gl-mat4":26}],107:[function(W,Z,K){Z.exports={vert:"\nprecision mediump float;\n\nuniform float camNear, camFar;\nuniform mat4 model, view, projection;\n\nattribute vec3 position, normal;\n\nvarying vec3 surfaceNormal, surfacePosition;\nvarying vec4 _worldSpacePosition;\n\nvoid main() {\n  surfacePosition = position;\n  surfaceNormal = normal;\n  vec4 worldSpacePosition = model * vec4(position, 1);\n  _worldSpacePosition = worldSpacePosition;\n\n  vec4 glPosition = projection * view * model * vec4(position, 1);\n  gl_Position = glPosition;\n}\n",frag:"\nprecision mediump float;\nvarying vec3 surfaceNormal;\nuniform float ambientLightAmount;\nuniform float diffuseLightAmount;\nuniform vec4 ucolor;\nuniform vec3 lightDirection;\nuniform vec3 opacity;\n\nvarying vec4 _worldSpacePosition;\n\nuniform vec2 printableArea;\n\nvec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);\n\nvoid main () {\n  vec4 depth = gl_FragCoord;\n\n  float v = 0.8; // shadow value\n  vec4 endColor = ucolor;\n\n  vec3 ambient = ambientLightAmount * endColor.rgb;\n  float cosTheta = dot(surfaceNormal, lightDirection);\n  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );\n\n  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));\n  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );\n\n  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);\n}"}},{}],108:[function(W,Z,K){Z.exports={frag:"\nprecision mediump float;\nvarying vec3 surfaceNormal, surfacePosition;\n\nuniform float ambientLightAmount;\nuniform float diffuseLightAmount;\nuniform float specularLightAmount;\n\nuniform vec3 lightDirection;\nuniform vec4 lightColor;\nuniform vec3 opacity;\nuniform float uMaterialShininess;\n\nvarying vec4 vColor;\nuniform vec4 ucolor;\nuniform float vColorToggler;\n\nuniform vec2 printableArea;\nvec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);//vec4(0.15, 0.15, 0.15, 0.3);\nvarying vec4 _worldSpacePosition;\nvarying float ambientAo;\n\nvoid main () {\n  vec4 depth = gl_FragCoord;\n  vec4 endColor = vColor * vColorToggler + ucolor * (1.0 - vColorToggler);\n\n  vec3 ambient = ambientLightAmount * endColor.rgb ; //ambientAo * \n\n  float diffuseWeight = dot(surfaceNormal, lightDirection);\n  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(diffuseWeight , 0.0, 1.0 );\n\n  //specular\n  \n  vec4 specularColor = vec4(lightColor);\n  vec3 eyeDirection = normalize(surfacePosition.xyz);\n  vec3 reflectionDirection = reflect(-lightDirection, -surfaceNormal);\n  float specularLightWeight = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);\n  vec3 specular = specularColor.rgb * specularLightWeight * specularLightAmount;\n\n  gl_FragColor = vec4((ambient + diffuse + specular), endColor.a);\n}\n",vert:"\nprecision mediump float;\n\nuniform float camNear, camFar;\nuniform mat4 model, view, projection, unormal;\n\nattribute vec3 position, normal;\nattribute vec4 color;\n\nattribute float ao;\nvarying float ambientAo;\n\nvarying vec3 surfaceNormal, surfacePosition;\nvarying vec4 _worldSpacePosition;\nvarying vec4 vColor;\n\nvoid main() {\n  surfacePosition = (unormal * vec4(position, 1.0)).xyz;\n  surfaceNormal = normalize((unormal * vec4(normal, 1.0)).xyz); //vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);\n  vec4 worldSpacePosition = model * vec4(position, 1);\n  _worldSpacePosition = worldSpacePosition;\n  //gl_Position = projection * view * worldSpacePosition;\n\n  vColor = color;\n\n  //ambientAo = (1. - ao) * (0.5 * max(normal.x, 0.) + 0.5);\n\n  vec4 glPosition = projection * view * model * vec4(position, 1);\n  gl_Position = glPosition;\n  //gl_Position = zBufferAdjust(glPosition, camNear, camFar);\n}\n"}},{}],109:[function(W,Z,K){const $=W("./renderContext"),ee=W("./renderDefaults");Z.exports=Z=>{const K=Object.assign({},{},Z.glOptions,{onDone:(W,Z)=>{if(W)throw W}}),te=W("regl")(K),re=new Map;return function(W){var Z;te.poll(),(Z=W).rendering=Object.assign({},ee,Z.rendering),$(te)(Z,(W=>{te.clear({color:Z.rendering.background,depth:1}),Z.entities&&Z.entities.sort(((W,Z)=>{const K="transparent"in W.visuals&&W.visuals.transparent;return K===("transparent"in Z.visuals&&Z.visuals.transparent)?0:K?1:-1})).forEach((W=>{const{visuals:K}=W;if((!("show"in K)||K.show)&&K.drawCmd&&Z.drawCommands[K.drawCmd]){let $;K.cacheId?$=re.get(K.cacheId):(K.cacheId=re.size,$=Z.drawCommands[K.drawCmd](te,W),re.set(K.cacheId,$)),$({...W,...K,camera:Z.camera})}}))}))}}},{"./renderContext":110,"./renderDefaults":111,regl:87}],110:[function(W,Z,K){const $=W("gl-mat4");Z.exports=(W,Z={})=>{const{fbo:K}=Z,ee={cull:{enable:!0},context:{lightDirection:[.2,.2,1]},uniforms:{view:(W,Z)=>Z.camera.view,eye:(W,Z)=>Z.camera.position,projection:(W,Z)=>Z.camera.projection,camNear:(W,Z)=>Z.camera.near,camFar:(W,Z)=>Z.camera.far,invertedView:(W,Z)=>$.invert([],Z.camera.view),lightPosition:(W,Z)=>Z&&Z.rendering&&Z.rendering.lightPosition?Z.rendering.lightPosition:[100,200,100],lightDirection:(W,Z)=>Z&&Z.rendering&&Z.rendering.lightDirection?Z.rendering.lightDirection:W.lightDirection||[0,0,0],lightView:W=>$.lookAt([],W.lightDirection,[0,0,0],[0,0,1]),lightProjection:$.ortho([],-25,-25,-20,20,-25,25),lightColor:(W,Z)=>Z&&Z.rendering&&Z.rendering.lightColor?Z.rendering.lightColor:[1,.8,0],ambientLightAmount:(W,Z)=>Z&&Z.rendering&&Z.rendering.ambientLightAmount?Z.rendering.ambientLightAmount:.3,diffuseLightAmount:(W,Z)=>Z&&Z.rendering&&Z.rendering.diffuseLightAmount?Z&&Z.rendering&&Z.rendering.diffuseLightAmount:.89,specularLightAmount:(W,Z)=>Z&&Z.rendering&&Z.rendering.specularLightAmount?Z.rendering.specularLightAmount:.16,uMaterialShininess:(W,Z)=>Z&&Z.rendering&&Z.rendering.materialShininess?Z.rendering.materialShininess:8,materialAmbient:[.5,.8,.3],materialDiffuse:[.5,.8,.3],materialSpecular:[.5,.8,.3]},framebuffer:K};return W(Object.assign({},ee,Z.extras))}},{"gl-mat4":26}],111:[function(W,Z,K){Z.exports={background:[1,1,1,1],meshColor:[0,.6,1,1],lightColor:[1,1,1,1],lightDirection:[.2,.2,1],lightPosition:[100,200,100],ambientLightAmount:.3,diffuseLightAmount:.89,specularLightAmount:.16,materialShininess:8}},{}]},{},[98])(98)}));