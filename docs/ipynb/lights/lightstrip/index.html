<head></head> <body> <button id="bleButton" onclick="ble()">Start</button> <script>async function ble(){const e="4fafc201-1fb5-459e-8fcc-c5c9c3319123";if(window.charac)console.log("read:",(await window.charac.readValue()).getUint8(0));else{console.log("Setting up!");const t=await navigator.bluetooth.requestDevice({filters:[{name:"Music Strip"}],optionalServices:[e]}),i=await t.gatt.connect().then((t=>t.getPrimaryService(e)));window.charac=await i.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b2623"),console.log("characteristic"),window.notificationsActive||(await window.charac.startNotifications(),window.notificationsActive=!0,window.charac.addEventListener("characteristicvaluechanged",window.bleRead)),document.getElementById("bleButton").insertAdjacentHTML("afterend","<button onclick=\"window.bleWrite('TestEvent')\">TestEvent</button>")}}console.log("start"),window.charac=!1,window.notificationsActive=!1,window.queuedMessage=!1,window.processingWrite=!1,window.bleWrite=async e=>{if(window.processingWrite)window.queuedMessage=e;else{window.processingWrite=!0;const t=(new TextEncoder).encode(e);console.log(`Ble Write: ${e}, Encoded: ${t}`),await window.charac.writeValue(t).then((()=>{if(window.processingWrite=!1,!1!==window.queuedMessage){const e=window.queuedMessage;window.queuedMessage=!1,window.bleWrite(e)}}))}},window.bleRead=async({target:{value:e}})=>{const t=(new TextDecoder).decode(await e);console.log("fromBle: "+t),window.bleWrite("LAPTOP"+Math.floor(10*Math.random()))}</script> </body>