function updateUpdateTimeout(){window.timer&&clearTimeout(window.timer),window.timer=setTimeout((function(){window.bleWrite()}),1e3)}window.charac=!1,window.myData={lightmode:"colorWipe",colorone:"255,0,203",colortwo:"255,0,0",colorthree:"0,0,255",animationdelay:100},window.bleWrite=async()=>{let e=window.myData,t=new TextEncoder("utf-8").encode(JSON.stringify(e));console.log("Sending to ESP: ",{raw:e,encoded:t}),window.charac.writeValue(t)},window.timer=null,window.bleRead=async e=>{await e.target.value;let t=new TextDecoder("utf-8").decode(e.target.value);console.log("ESP32 Current Value: "+t)},window.ble=async(e=!1,t=!1)=>{bleClick()};export async function bleClick(){let e="4fafc201-1fb5-459e-8fcc-c5c9c3319123";if(window.charac){let e=await window.charac.readValue();await e.getUint8(0)}else{console.log("Setting up!");let t=await navigator.bluetooth.requestDevice({filters:[{name:"Music Strip"}],optionalServices:[e]});const n=await t.gatt.connect(),i=await n.getPrimaryService(e);window.charac=await i.getCharacteristic("beb5483e-36e1-4688-b7f5-ea07361b2623"),console.log("characteristic"),window.charac.startNotifications(),window.charac.addEventListener("characteristicvaluechanged",window.bleRead),(e=>{let t=document.getElementById("btConnect");function updateColor(){let e=this.value.slice(1),t=parseInt(e.substr(2,2),16),n=parseInt(e.substr(0,2),16),i=parseInt(e.substr(4,2),16);window.myData[this.id.toLowerCase()]=`${t},${n},${i}`,console.log("got color",this.value,window.myData[this.id.toLowerCase()]),updateUpdateTimeout()}console.log({btn:t}),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'colorWipe'; window.bleWrite()\"> colorWipe </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'theaterChase'; window.bleWrite()\"> theaterChase </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'rainbow'; window.bleWrite()\"> rainbow </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'theaterChaseRainbow'; window.bleWrite()\"> theaterChaseRainbow </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'multiColorSizzle'; window.bleWrite()\"> multiColorSizzle </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'multiColorWipe'; window.bleWrite()\"> multiColorWipe </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'multiTheaterSizzle'; window.bleWrite()\"> multiTheaterSizzle </button>"),t.insertAdjacentHTML("afterend","<button onclick=\"window.myData.lightmode = 'multiTheaterWipe'; window.bleWrite()\"> multiTheaterWipe </button>"),t.insertAdjacentHTML("afterend","<div>Animation Delay: <input type='number'min='0' step='5' id='animationDelay' value='100' style='width: 100px; clip: auto;'/></div>"),t.insertAdjacentHTML("afterend","<div>Brightness: <input type='number' step='5' min='0'  max='256' id='brightness' value='100' style='width: 100px; clip: auto;'/></div>"),document.getElementById("animationDelay").addEventListener("input",(function(){window.myData.animationdelay=parseInt(this.value,10),updateUpdateTimeout()})),document.getElementById("brightness").addEventListener("input",(function(){window.myData.brightness=parseInt(this.value,10),updateUpdateTimeout()})),t.insertAdjacentHTML("afterend","<div>Color One: <input style='width: 100px; clip: auto;' type='color' id='colorOne' value='#ff00cb' /></div>"),t.insertAdjacentHTML("afterend","<div>Color Two: <input style='width: 100px; clip: auto;' type='color' id='colorTwo' value='#00ffcb' /></div>"),t.insertAdjacentHTML("afterend","<div>Color Three: <input style='width: 100px; clip: auto;' type='color' id='colorThree' value='#cb00ff' /></div>"),document.getElementById("colorOne").addEventListener("input",updateColor),document.getElementById("colorTwo").addEventListener("input",updateColor),document.getElementById("colorThree").addEventListener("input",updateColor)})()}}export function getContent(){return'<button id="btConnect" onclick="ble()">BT Connect</button>'}