window.w=window;const getsm=()=>location.pathname.split("/")[1].replace(".html","")||"index",shorten=(e,t=12)=>e?.trim().slice(0,t)+(e?.length>t+1?"...":""),capitalize=e=>e?.replace(/\b\w/g,(e=>e.toUpperCase())),formatLink=e=>shorten(capitalize(e?.replaceAll(" ","_").replace(/[^a-zA-Z_]/g,""))),displayLink=e=>capitalize(e.toLowerCase().replace(getsm()+"_","").replace(/^\d+/g,"").replaceAll("_"," ")),create_url=(e,t)=>{e=e.replace(new RegExp(`^${t}_`,"i"),"");let a=location.pathname.split("/").length>=3,n=e!=t;return`./${(a&&!n?"../":!a&&n&&!!t&&t+"/")||""}${e}`};w.addEventListener("load_template",(async()=>{if(console.group("refresh_template:Event:LOAD_TEMPLATE"),w.meta.template||="article",meta.template!==document.body.getAttribute("data-template")){let e=`/templates/${meta.template}`;try{document.body.setAttribute("data-template",meta.template),document.body.innerHTML=await(await fetch(`${e}.html`)).text(),document.body.insertAdjacentHTML("beforeend",`<style>${await(await fetch(`${e}.css`)).text()}</style>`),Array.from(document.getElementsByTagName("script")).forEach((e=>{e.src;const t=document.createElement("script");["src","type","async","textContent"].forEach((a=>e[a]&&(t[a]=e[a]))),document.body.appendChild(t),e.parentNode.removeChild(e)}))}catch(e){}}let e=getsm();const t="true"==w.meta.hide_sitemap?.toLowerCase();if(w.sitemap&&!t){let t=!1;if(!w.sitemap_content){t=`${location.origin}/templates/${w.meta.template}_sitemap.css`;let e=await(await fetch(t)).text();document.body.insertAdjacentHTML("beforeend",`<style>${e}</style>`)}if(w.sm_name!=e){w.sm_name=e,t=`${location.origin}/posts/${sm_name}_map.json`,w.sitemap_content=await(await fetch(t)).json();let a=await(await fetch("https://carlos-a-diez.com/cms/notes.json")).json();e=Object.values(a).filter((e=>!!e.filename.toLowerCase().startsWith(sm_name.toLowerCase()+"_")&&{filename:e.filename||"Unknown",summary:e.summary||"Unknown"})),w.sitemap_content=[...w.sitemap_content,...e]}}document.title=w.meta.title,console.groupEnd(),populateTemplate(!w.preRendering&&-1==location.href.indexOf("#"))}),{passive:!0});const populateTemplate=async(e=!1)=>{const t=w.page_transition;let a="true"==w.meta.hide_sitemap?.toLowerCase();if(e&&t&&a)return t.style.animation="page_transition 0.375s alternate 2, gradient 0.375s alternate 2",t.addEventListener("animationend",(async()=>t.style.animation="none"),{once:!0}),void setTimeout((async()=>{await populateTemplate()}),450);console.group("refresh_template:POPULATE_TEMPLATE"),meta.breadcrumbs=['<a href="./../index.html">Home</a>',location.pathname.split("/").slice(1).map(((e,t)=>"index"==(e=e.replace(".html",""))?"":`<a href=${create_url(e,w.sm_name)}.html>${capitalize(e.replace(".html",""))}</a>`)).join("/")].join("/");let n=["content","title","summary"];return!("true"==w.meta.hide_sitemap?.toLowerCase())&&n.push("breadcrumbs"),n.map((e=>{if(!meta[e])return;const t=document.getElementById(e);t.innerHTML="",t.appendChild(document.createRange().createContextualFragment(meta[e]))})),await createNav(),[...document.querySelectorAll("h2, h3, h4")].forEach((e=>{e.id=formatLink(e.innerText||e.textContent);let t=document.createElement("a");t.className="anchor",t.id=t.href="#"+e.id,t.setAttribute("aria-label","Link to "+e.id),t.setAttribute("onclick",`event?.preventDefault?.(); navigator.clipboard.writeText('https://charleskarpati.com${location.pathname+location.hash}'); w.toast?.();`),e.parentNode.insertBefore(t,e.nextSibling)})),w.expand&&(w.expand.style.display=document.getElementsByTagName("aside").length>0?"block":"none"),w.audio&&(w.audio.style.display=w.meta.audio?"flex":"none",w.audio.title=w.meta.audio,w.audio.querySelector("audio").src=w.meta.audio),loadObserver?.(),document.querySelectorAll("a").forEach((e=>{e.id=e.id||formatLink(e.innerText)+Math.floor(1e6*Math.random())})),w.setRedirectListeners?.(),console.groupEnd(),!0},createNav=async()=>{console.group("createNav");let e=getToc();const t="true"==w.meta.hide_sitemap?.toLowerCase();let a=w.tocHere||w.toc;a&&!t&&(a.innerHTML=e),w.sitemap&&(w.sitemap.style.visibility=t?"hidden":"visible"),w.sitemap&&!t?(w.sitemap_content,w.sitemap.innerHTML=`\n    <input type="checkbox" id="toggle_sitemap" class="nav-toggle" />\n    <label tabindex="0" for="toggle_sitemap" class="nav-label">\n      <span class="nav-arrow">&#x21e8;</span> Navigation \n      <span class="nav-close">&#x2715;</span>\n    </label>\n    <hr/>\n    <a id="link_Home" href="./../index.html" title="Home">Home</a>\n    ${a||!e?"":`\n    <input type="checkbox" id="toggle_toc" class="toc-toggle" />\n    <label class="toc-label" for="toggle_toc">\n      Table of Contents → \n    </label>\n    <label class="toc-label-back" for="toggle_toc">\n      ← Back to Navigation\n    </label>\n    <div id='toc-content'> \n      <h3>Table of Contents</h3>\n      ${e} \n    </div>\n    `}\n    <div id='sitemap-content'>  \n    ${w.sitemap_content.map(((e,t)=>{let a=e.tab||e.filename,n=`\n        <a id="${e.filename==w.meta.filename?"currentPage":"link_"+a}"  \n            href="${create_url(e.filename,w.sm_name)}.html" \n            title="${a}">\n            ${shorten(displayLink(a),20)}\n        </a>`;return 0===t?`<h3>${n}</h3>`:n})).join("")}\n  \n    </div>`,document.getElementById("toggle_sitemap").checked=!0,console.groupEnd()):console.groupEnd()},getToc=()=>{console.group("createToc");if("true"==w.meta.hide_toc?.toLowerCase())return console.groupEnd(),"";let e=[...document.querySelectorAll("h2, h3, h4")].map((e=>{let t=e.innerText||e.textContent;const a=formatLink(t);return`${"".repeat(e.tagName.slice(1)-1)}<a href='#${a}' title="${t}">${displayLink(t)}</a>`})).join("");return console.groupEnd(),e};w.toast=()=>{let e=document.getElementById("toast_container");e.style.animation="toast 3s",e.addEventListener("animationend",(()=>{e.style.animation="none"}),{once:!0})};