import{promises as e}from"fs";import t from"path";const s="./src/ipynb/",o="./src/client/posts";import i from"http-server";const a=i.createServer({root:"./",cors:!0,host:"0.0.0.0"});async function ipynb_publish(s="index",i=o,r="json"){let a;if(console.log("ipynb_publish-",s,i,r),"html"===r)raw=await nb2html(s),s=/[^/]*$/.exec(s);else if("json"===r){const{nb2json:e}=await import("./convert.mjs?type=module",{type:"module"});a=await e(s);let{filename:t,...o}=a.meta;try{t=t?.toLowerCase().replaceAll(" ","_")}catch(e){console.log("ERROR: ",e),t=s.split("/")[s.split("/").length-1]}a.meta={filename:t,...o},s=t}const c=t.join(i,`${s}.${r}`);return await e.writeFile(c,"json"===r?JSON.stringify(a):a),a}a.listen(8085,(()=>{})),async function cv_cli_nbs2html(){const i=process.argv.slice(2),c=i[0]||"index";let n=i[0]?i[0]+"/":"";!async function generate_sitemap(i,c,n){console.log("generate_sitemap-",i,c,n);let l=[],{csp:m,sitemap:p,breadcrumbs:y,badges:d,keywords:h,comments:b,hide:f,image:g,toc:w,title:u,...$}=(await ipynb_publish(`${s}${n}`,o)).meta;l.push($);let _=`${s}/${c}`,j=`${o}/${c}`;try{await e.access(j)}catch(t){if("ENOENT"===t.code)try{await e.mkdir(j,{recursive:!0})}catch(e){console.error("Error creating directory:",e)}else console.error("Error accessing directory:",t)}for(const e of i){const t=await ipynb_publish(_+e,j);if(!t.meta.hide){const{csp:e,sitemap:s,breadcrumbs:o,badges:i,keywords:r,comments:a,hide:c,image:n,toc:m,title:p,...y}=t.meta;l.push(y)}}console.log("links",l);const v=t.join(o,n+"_map.json");try{await e.writeFile(v,JSON.stringify(l))}catch(t){await e.writeFile(v,"{}"),console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~----ERROR:",r.meta)}a.close((()=>{console.log("Server closed.")}))}(i[1]?.split(",")||(await e.readdir(`${s}${n}`)).filter((e=>".ipynb"===t.extname(e))).map((e=>t.parse(e).name)),n,c)}();