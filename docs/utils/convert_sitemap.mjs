import{promises as e}from"fs";import t from"path";const s="./src/ipynb/",i="./src/client/posts";import o from"http-server";const a=o.createServer({root:"./",cors:!0,host:"0.0.0.0"});async function ipynb_publish(s="index",o=i,r="json"){let a;if("html"===r)raw=await nb2html(s),s=/[^/]*$/.exec(s);else if("json"===r){const{nb2json:e}=await import("./convert.mjs?type=module",{type:"module"});a=await e(s);let{filename:t,...i}=a.meta;try{t=t?.toLowerCase().replaceAll(" ","_")}catch(e){console.log("ERROR: ",e),t=s.split("/")[s.split("/").length-1]}a.meta={filename:t,...i},s=t}const c=t.join(o,`${s}.${r}`);return await e.writeFile(c,"json"===r?JSON.stringify(a):a),a}a.listen(8085,(()=>{})),async function cv_cli_nbs2html(){const o=process.argv.slice(2),c=o[0]||"index";let n=o[0]?o[0]+"/":"";!async function generate_sitemap(o,c,n){console.log("generate_sitemap-",o,c,n);let l=[],{csp:m,sitemap:p,breadcrumbs:d,badges:y,keywords:h,comments:f,hide:w,image:b,toc:g,title:u,...$}=(await ipynb_publish(`${s}${n}`,i)).meta;l.push($);let _=`${s}/${c}`,j=`${i}/${c}`;try{await e.access(j)}catch(t){if("ENOENT"===t.code)try{await e.mkdir(j,{recursive:!0})}catch(e){console.error("Error creating directory:",e)}else console.error("Error accessing directory:",t)}for(const e of o){const t=await ipynb_publish(_+e,j);if(!t.meta.hide){const{csp:e,sitemap:s,breadcrumbs:i,badges:o,keywords:r,comments:a,hide:c,image:n,toc:m,title:p,...d}=t.meta;l.push(d)}}console.log("links",l);const v=t.join(i,n+"_map.json");try{await e.writeFile(v,JSON.stringify(l))}catch(t){await e.writeFile(v,"{}"),console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~----ERROR:",r.meta)}a.close((()=>{console.log("Server closed.")}))}(o[1]?.split(",")||(await e.readdir(`${s}${n}`)).filter((e=>".ipynb"===t.extname(e))).map((e=>t.parse(e).name)),n,c)}();