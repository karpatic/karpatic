<!DOCTYPE html><html lang="en" dir="ltr"><head id="head"><meta charset="UTF-8"><title>Geo-Data Intake and Operations</title><link rel="license" href="https://opensource.org/licenses/MIT"><link rel="canonical" href="https://Geo-Data Intake and Operations.com/dataplay/03_map_basics_intake_and_operations"><link rel="icon" type="image/ico" sizes="16x16" href="data:image/x-icon;base64,AAABAAEAEBACAAEAAQCLAAAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAQAAAAEAgGAAAAH/P/YQAAAFJJREFUOI1jZGj5/58BO2CE0v/xiTHh0Ew0oNgAFjQ+I1ZVtHQBOQagBDqpBqDHGCMlXmAkxwUYgBID/pNjAHo0/yfHBSiGUD0lYss4eMHAZyYAshIJp1L2luYAAAAASUVORK5CYII="><meta http-equiv="Content-Security-Policy" content="img-src * data:; connect-src *;"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><meta name="author" content="Charles Karpati"><meta name="description" content="My personal site and portfolio"><meta name="theme-color" content="#0080f0"><meta name="robots" content="index, follow"><meta property="og:url" content="http://www.Geo-Data Intake and Operations.com/dataplay/03_map_basics_intake_and_operations"><meta property="og:title" content="Geo-Data Intake and Operations"><meta property="og:description" content="This notebook was made to demonstrate how to work with geographic data."><meta property="og:type" content="city"><meta property="og:site_name" content="CharlesKarpati.com"><meta property="og:locale" content="en_US"><meta property="op:markup_version" content="v1.0"><meta property="fb:article_style" content="default"><meta property="og:image" content="/images/icon300.png"><meta name="twitter:card" content="This notebook was made to demonstrate how to work with geographic data."><meta name="twitter:site" content="@cvminigames"><meta name="twitter:creator" content="@cvminigames"><style>:root{--canvas:227,227,232;--background:209,209,250;--foreground:240,240,255;--near-black:0,72,72;--near-white:226,226,238;--max-width:min(800px,100vw)}*{box-sizing:border-box;font-family:Georgia,TimesNewRoman,Times,Times New Roman,serif;position:relative;-webkit-user-select:text;-moz-user-select:text;user-select:text}html{font-size:1.125em;line-height:1.625em}body{background:linear-gradient(180deg,#e3e3e8,#e3e3e8);background:linear-gradient(180deg,rgba(var(--canvas)),rgba(var(--canvas)));margin:0;overflow-x:hidden}::-moz-selection{background:#d1d1fa;background:rgb(var(--background))}::selection{background:#d1d1fa;background:rgb(var(--background))}h1,h2{text-align:center;text-shadow:none;transition:all .3s ease-in-out}h2:hover{text-shadow:1px 1px 45px #004848;text-shadow:1px 1px 45px rgb(var(--near-black));transition:all .4s ease-in-out}h1,h2,h3,h4{color:#004848;color:rgb(var(--near-black));font-weight:600}h3,h4{font-size:1.25em}a{color:#004848;color:rgb(var(--near-black))}summary:hover .anchor:after{content:"🔗";height:.8em}.anchor{left:0;position:absolute}#sitemap-content>a,.anchor{text-decoration:none}input{clip:rect(0 0 0 0);overflow:hidden;white-space:nowrap;width:1px}a:before,input{position:absolute}a:before{background-color:#d1d1fa;background-color:rgb(var(--background));content:"";height:0;left:0;transition:all .3s ease-in-out;width:100%;z-index:-1}a:hover:before{bottom:0;height:8px;height:100%}span{font-family:inherit}p{display:block;word-break:break-word}li p,p{margin-bottom:0;margin-top:0}pre{background:#d1d1fa;background:rgb(var(--background));line-height:1.2em;max-width:calc(min(800px,100vw) - 70px);max-width:calc(var(--max-width) - 70px);overflow:auto;padding:12px}blockquote{background-color:#d1d1fa;background-color:rgb(var(--background));border-left:8px solid #f0f0ff;border-left:8px solid rgb(var(--foreground));font-style:italic;margin:32px 24px;padding:12px 5px 1px;position:relative}blockquote:before{color:#f0f0ff;color:rgb(var(--foreground));content:"“";font-size:4em;left:10px;padding-top:6px;position:absolute;top:-12px}ul{padding:0}ul ul{padding-left:10px}ul>li{display:flex;list-style-type:none}ul>li:before{content:"-";margin-right:10px}.details details:nth-child(odd),details details:nth-child(2n),details:nth-child(odd){background:rgba(209,209,250,.4);background:rgba(var(--background),.4)}.details details:nth-child(2n),details details:nth-child(odd){background:rgba(227,227,232,.4);background:rgba(var(--canvas),.4)}details>summary{list-style:none;position:relative}details>summary:before{content:"⇨";display:inline-block;margin-right:8px;transition:transform .3s ease}details[open]>summary:before{transform:rotate(90deg)}details>summary>*{display:inline}summary{cursor:pointer;font-size:1.25em;padding:12px 0;text-align:center}hr{border-top:1px solid rgba(0,72,72,.1);border-top:1px solid rgba(var(--near-black),.1);margin:1px 1px 10px}</style><link rel="preconnect" href="https://cdn.rawgit.com"><link rel="preconnect" href="https://mybinder.org"><link rel="preconnect" href="https://pete88b.github.io"><link rel="preconnect" href="https://badges.frapsoft.com"><link rel="preconnect" href="http://img.shields.io"><link rel="preconnect" href="https://img.shields.io"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="https://static.mybinder.org"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/prettify.css"></head><body data-template="article"><input type="checkbox" id="toggle_sitemap" aria-label="sitemap"><div id="sitemap" style="visibility:visible"><label tabindex="0" for="toggle_sitemap"><span>⇨</span> Sitemap <span>✕</span></label><hr><div id="sitemap-content"><a id="link_Home" href="./../index.html" title="Home">Home</a> <a id="link_00_dataplay" href="./../dataplay.html" title="00_dataplay">00 Dataplay </a><a id="link_01_download_and_load" href="./01_download_and_load.html" title="01_download_and_load">01 Download And Load </a><a id="link_02_merge_data" href="./02_merge_data.html" title="02_merge_data">02 Merge Data </a><a id="currentPage" href="./03_map_basics_intake_and_operations.html" title="03_map_basics_intake_and_operations">03 Map Basics Intake...</a><div id="toc"> <a href="#About_this_T..." title="About this Tutorial:" id="About_This_T831130" style="animation:.5s ease-in-out 0s 2 normal none running wiggle;text-decoration:line-through">About This T...</a><br>  <a href="#Objectives" title="Objectives" id="Objectives840771">Objectives</a><br> <a href="#Background" title="Background" id="Background997041">Background</a><br>  <a href="#Datatypes_an..." title="Datatypes and Geo-data" id="Datatypes_An791572">Datatypes An...</a><br>  <a href="#Coordinate_R..." title="Coordinate Reference Systems (CRS)" id="Coordinate_R858495">Coordinate R...</a><br>  <a href="#Coordinate_E..." title="Coordinate Encoding" id="Coordinate_E328503">Coordinate E...</a><br>  <a href="#Raster_Vs_Ve..." title="Raster Vs Vector Data" id="Raster_Vs_Ve823629">Raster Vs Ve...</a><br>   <a href="#Vector_Data" title="Vector Data" id="Vector_Data908936">Vector Data</a><br>   <a href="#Raster_Data" title="Raster Data" id="Raster_Data352104">Raster Data</a><br> <a href="#SETUP" title="SETUP:" id="SETUP79691">SETUP</a><br>  <a href="#Import_Modul..." title="Import Modules" id="Import_Modul876438">Import Modul...</a><br>  <a href="#Configure_En..." title="Configure Enviornment" id="Configure_En314216">Configure En...</a><br> <a href="#Retrieve_GIS..." title="Retrieve GIS Data" id="Retrieve_GIS609549">Retrieve GIS...</a><br>  <a href="#Approach__Re..." title="Approach 1: Reading in Data Directly" id="Approach_Re969058">Approach Re...</a><br>  <a href="#Approach__Co..." title="Approach 2: Converting Pandas into Geopandas" id="Approach_Co694030">Approach Co...</a><br>   <a href="#Approach__Me..." title="Approach 2: Method 1: Convert using a pre-formatted 'geometry' column" id="Approach_Me960540">Approach Me...</a><br>   <a href="#Approach__Me..." title="Approach 2: Method 2: Convert Column(s) to Coordinate" id="Approach_Me686833">Approach Me...</a><br>   <a href="#Approach__Me..." title="Approach 2: Method 3: Using a Crosswalk (Need Crosswalk on Esri)" id="Approach_Me459285">Approach Me...</a><br>  <a href="#Approach__Co..." title="Approach 3: Connecting to a PostGIS database" id="Approach_Co214465">Approach Co...</a><br> <a href="#Basic_Operat..." title="Basic Operations" id="Basic_Operat664947">Basic Operat...</a><br>  <a href="#Inspection" title="Inspection" id="Inspection636159">Inspection</a><br>  <a href="#Converting_C..." title="Converting CRS" id="Converting_C322895">Converting C...</a><br>  <a href="#Saving" title="Saving" id="Saving820022">Saving</a><br>  <a href="#Draw_Tool" title="Draw Tool" id="Draw_Tool997752">Draw Tool</a><br>  <a href="#Geometric_Ma..." title="Geometric Manipulations" id="Geometric_Ma314564">Geometric Ma...</a><br> <a href="#Advanced" title="Advanced" id="Advanced587798">Advanced</a><br>  <a href="#Create_Geosp..." title="Create Geospatial Functions" id="Create_Geosp153529">Create Geosp...</a><br> <a href="#Example_Usin..." title="Example: Using the advanced Functions" id="Example_Usin54794">Example Usin...</a><br>  <a href="#Playing_with..." title="Playing with Points: Geoloom" id="Playing_With172906">Playing With...</a><br>   <a href="#Points_In_Po..." title="Points In Polygons" id="Points_In_Po678120">Points In Po...</a><br>   <a href="#Polygons_in_..." title="Polygons in Points" id="Polygons_In_885852">Polygons In ...</a><br>   <a href="#Folium" title="Folium" id="Folium541623">Folium</a></div><a id="link_04_nb_2_html" href="./04_nb_2_html.html" title="04_nb_2_html">04 Nb 2 Html </a><a id="link_05_map_correlation_networks" href="./05_map_correlation_networks.html" title="05_map_correlation_networks">05 Map Correlation N... </a><a id="link_06_timelapse_data_gifs" href="./06_timelapse_data_gifs.html" title="06_timelapse_data_gifs">06 Timelapse Data Gi...</a></div></div><div id="page_transition"><p>Don't Look! I'm changing!</p></div><div id="toast_container"><p>URL Copied</p></div><div id="header"><div id="header_bg_wrapper"><div id="header_bg"></div></div><h1><a href="./../index.html" id="Charles_Karp...569616">Charles Karpati</a> <span id="head_separator">| </span><a href="#title" id="title">Geo-Data Intake and Operations</a></h1><p id="summary">This notebook was made to demonstrate how to work with geographic data.</p></div><div class="controls_container"><div id="breadcrumbs"><a href="./../index.html" id="Home277807">Home</a>/<a href="./../dataplay.html" id="Dataplay943989">Dataplay</a>/<a href="./03_map_basics_intake_and_operations.html" id="_map_basics_...83019">03_map_basics_intake_and_operations</a></div><div><label for="lightmode" id="light"><input type="checkbox" id="lightmode" aria-label="lightmode"></label> <label for="expandmode" id="expand" style="display:none"><input type="checkbox" id="expandmode" aria-label="expandmode"></label><p id="audio" title="undefined" style="display:none"><span><audio controls="" controlslist="nodownload noplaybackrate" preload="none" loop="" src="undefined"></audio></span>Musical loops</p></div></div><div id="content"><p><a href="https://mybinder.org/v2/gh/bnia/dataplay/main?filepath=%2Fnotebooks%2F03_Map_Basics_Intake_and_Operations.ipynb" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="559865"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a><a href="https://colab.research.google.com/github/bnia/dataplay/blob/main/notebooks/03_Map_Basics_Intake_and_Operations.ipynb" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="383023"><img src="https://pete88b.github.io/fastpages/assets/badges/colab.svg" alt="Binder"></a><a href="https://github.com/bnia/dataplay/tree/main/notebooks/03_Map_Basics_Intake_and_Operations.ipynb" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="621269"><img src="https://pete88b.github.io/fastpages/assets/badges/github.svg" alt="Binder"></a><a href="https://github.com/ellerbrock/open-source-badges/" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="989614"><img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103" alt="Open Source Love svg3"></a></p><p><a href="https://github.com/bnia/dataplay/blob/main/LICENSE" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="621505"><img src="https://img.shields.io/npm/l/all-contributors.svg?style=flat" alt="NPM License"></a><a href="https://bnia.github.io" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="857277"><img src="http://img.shields.io/badge/Status-Active-green.svg" alt="Active"></a><a href="https://pypi.python.org/pypi/dataplay/" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="208670"><img src="https://img.shields.io/pypi/pyversions/dataplay.svg" alt="Python Versions"></a><a href="" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="519905"><img src="https://img.shields.io/github/last-commit/bnia/dataplay.svg?style=flat" alt="GitHub last commit"></a></p><p><a href="https://github.com/bnia/dataplay" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="750569"><img src="https://img.shields.io/github/stars/bnia/dataplay.svg?style=social&amp;label=Star" alt="GitHub stars"></a><a href="https://github.com/bnia/dataplay" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="26007"><img src="https://img.shields.io/github/watchers/bnia/dataplay.svg?style=social&amp;label=Watch" alt="GitHub watchers"></a><a href="https://github.com/bnia/dataplay" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="152177"><img src="https://img.shields.io/github/forks/bnia/dataplay.svg?style=social&amp;label=Fork" alt="GitHub forks"></a><a href="https://github.com/bnia/dataplay" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="919782"><img src="https://img.shields.io/github/followers/bnia.svg?style=social&amp;label=Follow" alt="GitHub followers"></a></p><p><a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20%E2%9C%A8%20colab%20by%20@bniajfi%20https://github.com/bnia/dataplay%20%F0%9F%A4%97" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="110497"><img src="https://img.shields.io/twitter/url/https/github.com/bnia/dataplay.svg?style=social" alt="Tweet"></a><a href="https://twitter.com/bniajfi" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="51411"><img src="https://img.shields.io/twitter/follow/bniajfi.svg?style=social" alt="Twitter Follow"></a></p><details open=""><summary style="animation:.5s ease-in-out 0s 2 normal none running wiggle"><h2 id="About_this_T...">About this Tutorial:</h2><a class="anchor" href="#About_this_T..." id="#About_this_T..." aria-label="Link to About_this_T..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>In this notebook, the basics of working with geographic data are introduced.</p><ul><li><p>Reading in data (points/ geoms)</p></li><li><ul><li><p>Convert lat/lng columns to point coordinates</p></li></ul></li><li><ul><li><p>Geocoding address to coordinates</p></li></ul></li><li><ul><li><p>Changing coordinate reference systems</p></li></ul></li><li><ul><li><p>Connecting to PostGisDB's</p></li></ul></li><li><p>Basic Operations</p></li><li><p>Saving shape data</p></li><li><p>Get Polygon Centroids</p></li><li><p>Working with Points and Polygons</p></li><li><ul><li><p>Map Points and Polygons</p></li></ul></li><li><ul><li><p>Get Points in Polygons</p></li></ul></li><li><ul><li><p>Create Choropleths</p></li></ul></li><li><ul><li><p>Create Heatmaps (KDE?)</p></li></ul></li></ul><h3 id="Objectives" style="">Objectives</h3><a class="anchor" href="#Objectives" id="#Objectives" aria-label="Link to Objectives" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>By the end of this tutorial users should have an understanding of:</p><ul><li><p>How to read in and process geo-data asa geo-dataframe.</p></li><li><p>The Coordinate Reference System and Coordinate Encoding</p></li><li><p>Basic geo-visualization strategies</p></li></ul></details><details><summary style=""><h2 id="Background">Background</h2><a class="anchor" href="#Background" id="#Background" aria-label="Link to Background" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>An expansice discursive on programming and cartography can be found <a href="https://medium.com/@mbostock/command-line-cartography-part-1-897aa8f8ca2c" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="140944">here</a></p><details><summary style=""><h3 id="Datatypes_an...">Datatypes and Geo-data</h3><a class="anchor" href="#Datatypes_an..." id="#Datatypes_an..." aria-label="Link to Datatypes_an..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>Geographic data must be <a href="https://www.blender.org/fileadmin/verse/spec/protocol-encoding.html#:~:text=3.3.-,Data%20Encoding,is%20specified%20in%20this%20section." onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="760534">encoded</a> properly order to attain the full potential of the spatial nature of your geographic data.</p><p>If you have read in a dataset using <em>pandas</em> it's data type will be a <strong>Dataframe</strong>.</p><p>It may be converted into a <strong>Geo-Dataframe</strong> using <em>Geopandas</em> as demonstrated in the sections below.</p><p>You can check a variables at any time using the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dtypes.html" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="603442">dtype</a> command:</p><pre class="prettyprint prettyprinted" style=""><span class="pln">yourGeoDataframe</span><span class="pun">.</span><span class="pln">dtype</span></pre></details><details><summary style=""><h3 id="Coordinate_R...">Coordinate Reference Systems (CRS)</h3><a class="anchor" href="#Coordinate_R..." id="#Coordinate_R..." aria-label="Link to Coordinate_R..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p><strong>Make sure</strong> the appropriate spatial <em>Coordinate Reference System</em> (CRS) is used when reading in your data!</p><p>ala <a href="https://en.wikipedia.org/wiki/Spatial_reference_system" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="432932">wiki</a>:</p><blockquote><p>A spatial reference system (SRS) or coordinate reference system (CRS) is a coordinate-based local, regional or global system used to locate geographical entities</p></blockquote><p><strong>CRS 4326</strong> is the CRS most people are familar with when refering to latiude and longitudes.</p><p>Baltimore's 4326 CRS should be at (39.2, -76.6)</p><p>BNIA uses <a href="http://www.spatialreference.org/ref/epsg/2248/" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="834232">CRS 2248</a> <em>internally</em></p><p>Additional Information: <a href="https://docs.qgis.org/testing/en/docs/gentle_gis_introduction/coordinate_reference_systems.html" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="630254">https://docs.qgis.org/testing/en/docs/gentle_gis_introduction/coordinate_reference_systems.html</a></p><p>Ensure your geodataframes' coordinates are using the same CRS using the geopandas command:</p><pre class="prettyprint prettyprinted" style=""><span class="pln">yourGeoDataframe</span><span class="pun">.</span><span class="pln">CRS</span></pre></details><details><summary style=""><h3 id="Coordinate_E...">Coordinate Encoding</h3><a class="anchor" href="#Coordinate_E..." id="#Coordinate_E..." aria-label="Link to Coordinate_E..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>When first recieving a spatial dataset, the spatial column may need to be encoded to convert its 'text' data type values into understood 'coordinate' data types before it can be understood/processed accordingly.</p><p>Namely, there are two ways to encode text into coordinates:</p><ul><li><p>df[geom] = df[geom].apply(lambda x: loads( str(x) ))</p></li><li><p>df[geom] = [Point(xy) for xy in zip(df.x, df.y)]</p></li></ul><p>The first approach can be used for text taking the form "Point(-76, 39)" and will encode the text too coordinates. The second approach is useful when creating a point from two columns containing lat/lng information and will create Point coordinates from the two columns.</p><p>More on this later</p></details><details><summary style=""><h3 id="Raster_Vs_Ve...">Raster Vs Vector Data</h3><a class="anchor" href="#Raster_Vs_Ve..." id="#Raster_Vs_Ve..." aria-label="Link to Raster_Vs_Ve..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>There exists two types of Geospatial Data, Raster and Vector. Both have different file formats.</p><p>This lab will only cover vector data.</p><h4 id="Vector_Data" style="">Vector Data</h4><a class="anchor" href="#Vector_Data" id="#Vector_Data" aria-label="Link to Vector_Data" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>Vector Data: Individual points stored as (x,y) coordinates pairs. These points can be joined to create lines or polygons.</p><p>Format of Vector data</p><p>Esri Shapefile — .shp, .dbf, .shx Description - Industry standard, most widely used. The three files listed above are needed to make a shapefile. Additional file formats may be included.</p><p>Geographic JavaScript Object Notation — .geojson, .json Description — Second most popular, Geojson is typically used in web-based mapping used by storing the coordinates as JSON.</p><p>Geography Markup Language — .gml Description — Similar to Geojson, GML has more data for the same amount of information.</p><p>Google Keyhole Markup Language — .kml, .kmz Description — XML-based and predominantly used for google earth. KMZ is a the newer, zipped version of KML.</p><h4 id="Raster_Data" style="">Raster Data</h4><a class="anchor" href="#Raster_Data" id="#Raster_Data" aria-label="Link to Raster_Data" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>Raster Data: Cell-based data where each cell represent geographic information. An Aerial photograph is one such example where each pixel has a color value</p><p>Raster Data Files: GeoTIFF — .tif, .tiff, .ovr ERDAS Imagine — .img IDRISI Raster — .rst, .rdc</p><p>Information Sourced From: <a href="https://towardsdatascience.com/getting-started-with-geospatial-works-1f7b47955438" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="381434">https://towardsdatascience.com/getting-started-with-geospatial-works-1f7b47955438</a></p><p><strong>Vector Data: Census Geographic Data</strong>:</p><ul><li><p><strong>Geographic Coordinate Data</strong> is provided by the census and compliments their census geographies</p></li><li><p><a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.2010.html" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="971898">https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.2010.html</a></p></li><li><p><a href="https://www.census.gov/programs-surveys/acs/geography-acs/geography-boundaries-by-year.html" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="190266">https://www.census.gov/programs-surveys/acs/geography-acs/geography-boundaries-by-year.html</a></p></li><li><p>Bnia created and provides for free geographic boundary data that compliment these CSA's</p></li></ul></details></details><details><summary style=""><h2 id="SETUP">SETUP:</h2><a class="anchor" href="#SETUP" id="#SETUP" aria-label="Link to SETUP" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><details><summary style=""><h3 id="Import_Modul...">Import Modules</h3><a class="anchor" href="#Import_Modul..." id="#Import_Modul..." aria-label="Link to Import_Modul..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="pun">!</span><span class="pln">pip install rtree</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pun">%%</span><span class="pln">capture
 </span><span class="pun">!</span><span class="pln"> pip install geopy 
 </span><span class="pun">!</span><span class="pln"> pip install geoplot </span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln">t </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
 !pip install nbdev
 from google.colab import drive
 drive.mount('/content/drive')
 %cd /content/drive/My Drive/'Software Development Documents'/dataplay/
 """</span><span class="pln">
 </span><span class="com"># !pip install dataplay</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># @title Run: Import Modules</span><span class="pln">
 
 </span><span class="com"># These imports will handle everything</span><span class="pln">
 </span><span class="kwd">import</span><span class="pln"> os
 </span><span class="kwd">import</span><span class="pln"> sys
 </span><span class="kwd">import</span><span class="pln"> csv
 </span><span class="kwd">import</span><span class="pln"> numpy </span><span class="kwd">as</span><span class="pln"> np
 </span><span class="kwd">import</span><span class="pln"> pandas </span><span class="kwd">as</span><span class="pln"> pd
 </span><span class="kwd">import</span><span class="pln"> pyproj
 </span><span class="kwd">from</span><span class="pln"> pyproj </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Proj</span><span class="pun">,</span><span class="pln"> transform
 </span><span class="com"># conda install -c conda-forge proj4</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> shapely</span><span class="pun">.</span><span class="pln">geometry </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">LineString</span><span class="pln">
 </span><span class="com"># from shapely import wkb</span><span class="pln">
 </span><span class="com"># https://pypi.org/project/geopy/</span><span class="pln">
 </span><span class="kwd">import</span><span class="pln"> folium
 
 </span><span class="com"># In case file is KML, enable support</span><span class="pln">
 </span><span class="kwd">import</span><span class="pln"> fiona
 fiona</span><span class="pun">.</span><span class="pln">drvsupport</span><span class="pun">.</span><span class="pln">supported_drivers</span><span class="pun">[</span><span class="str">'kml'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'rw'</span><span class="pln">
 fiona</span><span class="pun">.</span><span class="pln">drvsupport</span><span class="pun">.</span><span class="pln">supported_drivers</span><span class="pun">[</span><span class="str">'KML'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'rw'</span><span class="pln">
 
 </span><span class="kwd">import</span><span class="pln"> psycopg2</span></pre><pre class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> </span><span class="typ">IPython</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> </span><span class="typ">IPython</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="pln">display </span><span class="kwd">import</span><span class="pln"> HTML
 
 </span><span class="kwd">import</span><span class="pln"> os 
 </span><span class="kwd">from</span><span class="pln"> branca</span><span class="pun">.</span><span class="pln">colormap </span><span class="kwd">import</span><span class="pln"> linear</span></pre><pre class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> pandas </span><span class="kwd">as</span><span class="pln"> pd
 </span><span class="kwd">import</span><span class="pln"> geopandas </span><span class="kwd">as</span><span class="pln"> gpd
 </span><span class="kwd">from</span><span class="pln"> geopandas </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">GeoDataFrame</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> shapely</span><span class="pun">.</span><span class="pln">geometry </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Point</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> shapely</span><span class="pun">.</span><span class="pln">wkt </span><span class="kwd">import</span><span class="pln"> loads
 </span><span class="kwd">from</span><span class="pln"> geopy</span><span class="pun">.</span><span class="pln">geocoders </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Nominatim</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> </span><span class="typ">IPython</span><span class="pun">.</span><span class="pln">display </span><span class="kwd">import</span><span class="pln"> clear_output
 </span><span class="kwd">from</span><span class="pln"> folium </span><span class="kwd">import</span><span class="pln"> plugins
 </span><span class="kwd">from</span><span class="pln"> folium</span><span class="pun">.</span><span class="pln">plugins </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">TimeSliderChoropleth</span><span class="pln"> 
 </span><span class="kwd">from</span><span class="pln"> folium</span><span class="pun">.</span><span class="pln">plugins </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">MarkerCluster</span></pre><pre class="prettyprint prettyprinted" style=""><span class="kwd">from</span><span class="pln"> dataplay </span><span class="kwd">import</span><span class="pln"> intaker 
 </span><span class="kwd">from</span><span class="pln"> dataplay </span><span class="kwd">import</span><span class="pln"> merge</span></pre></details><details><summary style=""><h3 id="Configure_En...">Configure Enviornment</h3><a class="anchor" href="#Configure_En..." id="#Configure_En..." aria-label="Link to Configure_En..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="pln"> 
 pd</span><span class="pun">.</span><span class="pln">set_option</span><span class="pun">(</span><span class="str">'display.expand_frame_repr'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span><span class="pln">
 pd</span><span class="pun">.</span><span class="pln">set_option</span><span class="pun">(</span><span class="str">'display.precision'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
 </span><span class="kwd">from</span><span class="pln"> </span><span class="typ">IPython</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="pln">interactiveshell </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">InteractiveShell</span><span class="pln">
 </span><span class="typ">InteractiveShell</span><span class="pun">.</span><span class="pln">ast_node_interactivity </span><span class="pun">=</span><span class="pln"> </span><span class="str">"all"</span><span class="pln">
  
 </span><span class="com"># pd.set_option('display.expand_frame_repr', False)</span><span class="pln">
 </span><span class="com"># pd.set_option('display.precision', 2)</span><span class="pln">
 </span><span class="com"># pd.reset_option('max_colwidth')</span><span class="pln">
 pd</span><span class="pun">.</span><span class="pln">set_option</span><span class="pun">(</span><span class="str">'max_colwidth'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">50</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># pd.reset_option('max_colwidth')</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># %matplotlib inline</span><span class="pln">
 </span><span class="com"># !jupyter nbextension enable --py widgetsnbextension</span></pre></details></details><details><summary style=""><h2 id="Retrieve_GIS...">Retrieve GIS Data</h2><a class="anchor" href="#Retrieve_GIS..." id="#Retrieve_GIS..." aria-label="Link to Retrieve_GIS..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>As mentioned earlier:</p><p>When you use a pandas function to 'read-in' a dataset, the returned value is of a datatype called a 'Dataframe'.</p><p>We need a 'Geo-Dataframe', however, to effectively work with spatial data.</p><p>While Pandas does not support Geo-Dataframes; Geo-pandas does.</p><p>Geopandas has everything you love about pandas, but with added support for geo-spatial data.</p><p>Principle benefits of using Geopandas over Pandas when working with spatial data:</p><ul><li><p>The geopandas plot function will now render a map by default using your 'spatial-geometries' column.</p></li><li><p>Libraries exist spatial-operations and interactive map usage.</p></li></ul><p>There are many ways to have our spatial-data be read-in using geo-pandas into a geo-dataframe.</p><p>Namely, it means reading in Geo-Spatial-data from a:</p><ol><li><p>(.geojson or .shp) file directly using Geo-pandas</p></li><li><p>(.csv, .json) file using Pandas and convert it to Geo-Pandas</p></li></ol><ul><li><p>using a prepared 'geometry' column</p></li><li><p>by transformting latitude and longitude columns into a 'geometry' column.</p></li><li><p>acquiring coordinates from an address</p></li><li><p>mapping your non-spatial-data to data-with-space</p></li></ul><ol start="3"><li><p>Connecting to a DB</p></li></ol><p>We will review each one below</p><details><summary style=""><h3 id="Approach__Re...">Approach 1: Reading in Data Directly</h3><a class="anchor" href="#Approach__Re..." id="#Approach__Re..." aria-label="Link to Approach__Re..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>If you are using Geopandas, direct imports <strong>only work</strong> with geojson and shape files.</p><p>spatial coordinate data is properly encoded with these types of files soas to make them particularly easy to use.</p><p>You can perform this using geopandas' <code>read_file()</code> function.</p><pre class="prettyprint prettyprinted" style=""><span class="com"># BNIA ArcGIS Homepage: https://data-bniajfi.opendata.arcgis.com/</span><span class="pln">
 csa_gdf </span><span class="pun">=</span><span class="pln"> intaker</span><span class="pun">.</span><span class="typ">Intake</span><span class="pun">.</span><span class="pln">getData</span><span class="pun">(</span><span class="str">"https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Hhchpov/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson"</span><span class="pun">)</span></pre><p>As you can see, the resultant variable is of type GeoDataFrame.</p><p>GeoDataFrames are only possible when one of the columns are of a 'Geometry' Datatype</p><p>Awesome. So that means, now you can plot maps all prety like:</p><p>And now lets take a peak at the raw data:</p><p>I'll show you more ways to save the data later, but for our example in the next section to work, we need a csv.</p><p>We can make one by saving the geo-dataframe avove using the <code>to_gdf</code> function.</p><p>The spatial data will be stored in an encoded form that will make it easy to re-open up in the future.</p></details><details><summary style=""><h3 id="Approach__Co...">Approach 2: Converting Pandas into Geopandas</h3><a class="anchor" href="#Approach__Co..." id="#Approach__Co..." aria-label="Link to Approach__Co..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><details><summary style=""><h4 id="Approach__Me...">Approach 2: Method 1: Convert using a pre-formatted 'geometry' column</h4><a class="anchor" href="#Approach__Me..." id="#Approach__Me..." aria-label="Link to Approach__Me..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>This approach loads a map using a geometry column</p><p>In our previous example, we saved a geo-dataframe as a csv.</p><p>Now lets re-open it up using pandas!</p><pre class="prettyprint prettyprinted" style=""><span class="pln">url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"example.csv"</span><span class="pln">
 geom </span><span class="pun">=</span><span class="pln"> </span><span class="str">'geometry'</span><span class="pln">
 </span><span class="com"># An example of loading in an internal BNIA file</span><span class="pln">
 crs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">'init'</span><span class="pln"> </span><span class="pun">:</span><span class="str">'epsg:2248'</span><span class="pun">}</span><span class="pln"> 
  
 </span><span class="com"># Read in the dataframe</span><span class="pln">
 csa_gdf </span><span class="pun">=</span><span class="pln"> intaker</span><span class="pun">.</span><span class="typ">Intake</span><span class="pun">.</span><span class="pln">getData</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span></pre><p>Great!</p><p>But now what?</p><p>Well, for starters, regardless of the project you are working on: It's always a good idea to inspect your data.</p><p>This is particularly important if you don't know what you're working with.</p><p>Take notice of how the geometry column has a special.. foramatting.</p><p>All spatial data must take on a similar form encoding for it to be properly interpretted as a spatial data-type.</p><p>As far as I can tell, This is near-identical to the table I printed out in our last example.</p><p>BUT WAIT!</p><p>You'll notice, that if I run the plot function a pretty map will not de-facto appear</p><p>Why is this? Because you're not working with a geo-dataframe but just a dataframe!</p><p>Take a look:</p><p>Okay... So thats not right..</p><p>What can we do about this?</p><p>Well for one, our spatial data (in the geometry-column) is not of the right data-type even though it takes on the right form.</p><p>Ok. So how do we change it? Well, since it's already been properly encoded...</p><p>You can convert a columns data-type from an object (or whatver else) to a 'geometry' using the <code>loads</code> function.</p><p>In the example below, we convert the datatypes for all records in the 'geometry' column</p><pre class="prettyprint prettyprinted" style=""><span class="pln">csa_gdf</span><span class="pun">[</span><span class="pln">geom</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">[</span><span class="pln">geom</span><span class="pun">].</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> loads</span><span class="pun">(</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">))</span></pre><p>Thats all! Now lets see the geometry columns data-type and the entire tables's data-type</p><p>As you can see, we have a geometry column of the right datatype, but our table is still only just a dataframe.</p><p>But now, you are ready to convert your entire pandas dataframe into a geo-dataframe.</p><p>You can do that by running the following function:</p><pre class="prettyprint prettyprinted" style=""><span class="pln">csa_gdf </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GeoDataFrame</span><span class="pun">(</span><span class="pln">csa_gdf</span><span class="pun">,</span><span class="pln"> crs</span><span class="pun">=</span><span class="pln">crs</span><span class="pun">,</span><span class="pln"> geometry</span><span class="pun">=</span><span class="pln">geom</span><span class="pun">)</span></pre><p>Aaaand BOOM.</p><p>goes the dy-no-mite</p></details><details><summary style=""><h4 id="Approach__Me...">Approach 2: Method 2: Convert Column(s) to Coordinate</h4><a class="anchor" href="#Approach__Me..." id="#Approach__Me..." aria-label="Link to Approach__Me..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>This is the generic example but it will not work since no URL is given.</p><pre class="prettyprint prettyprinted" style=""><span class="pln"> 
 </span><span class="com"># If your data has coordinates in two columns run this cell</span><span class="pln">
 </span><span class="com"># It will create a geometry column from the two.</span><span class="pln">
 </span><span class="com"># A public dataset is not provided for this example and will not run.</span><span class="pln">
  
 </span><span class="com"># Load DF HERE. Accidently deleted the link. Need to refind. </span><span class="pln">
 </span><span class="com"># Just rely on example 2 for now. </span><span class="pln">
 </span><span class="str">"""
 exe_df['x'] = pd.to_numeric(exe_df['x'], errors='coerce')
 exe_df['y'] = pd.to_numeric(exe_df['y'], errors='coerce')
 # exe_df = exe_df.replace(np.nan, 0, regex=True)
  
 # An example of loading in an internal BNIA file
 geometry=[Point(xy) for xy in zip(exe_df.x, exe_df.y)]
 exe_gdf = gpd.GeoDataFrame( exe_df.drop(['x', 'y'], axis=1), crs=crs, geometry=geometry)
 """</span></pre><h5 id="approach-2-method-2--example-geoloom">Approach 2: Method 2: Example: Geoloom</h5><p>Since I do not readily have a dataset with lat and long's I will have to make one.</p><p>We can split the coordinates from a geodataframe like so...</p><pre class="prettyprint prettyprinted" style=""><span class="com"># Table: Geoloom, </span><span class="pln">
 </span><span class="com"># Columns:  </span><span class="pln">
 </span><span class="com"># In this example, we are going to read in a shapefile</span><span class="pln">
 geoloom_gdf </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="pln">read_file</span><span class="pun">(</span><span class="str">"https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Geoloom_Crowd/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson"</span><span class="pun">);</span><span class="pln">
 </span><span class="com"># then create columns for its x and y coords</span><span class="pln">
 geoloom_gdf</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> geoloom_gdf</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">].</span><span class="pln">centroid</span><span class="pun">.</span><span class="pln">x
 geoloom_gdf</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> geoloom_gdf</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">].</span><span class="pln">centroid</span><span class="pun">.</span><span class="pln">y
 </span><span class="com"># Now lets just drop the geometry column and save it to have our example dataset. </span><span class="pln">
 geoloom_gdf </span><span class="pun">=</span><span class="pln"> geoloom_gdf</span><span class="pun">.</span><span class="pln">dropna</span><span class="pun">(</span><span class="pln">subset</span><span class="pun">=[</span><span class="str">'geometry'</span><span class="pun">])</span><span class="pln">
 geoloom_gdf</span><span class="pun">.</span><span class="pln">to_csv</span><span class="pun">(</span><span class="str">'example.csv'</span><span class="pun">)</span></pre><p>The first thing you will want to do when given a dataset with a coordinates column is ensure its datatype.</p><pre class="prettyprint prettyprinted" style=""><span class="com"># We already know the x and y columns because we just saved them as such.</span><span class="pln">
 geoloom_df</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">to_numeric</span><span class="pun">(</span><span class="pln">geoloom_df</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">],</span><span class="pln"> errors</span><span class="pun">=</span><span class="str">'coerce'</span><span class="pun">)</span><span class="pln">
 geoloom_df</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">to_numeric</span><span class="pun">(</span><span class="pln">geoloom_df</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">],</span><span class="pln"> errors</span><span class="pun">=</span><span class="str">'coerce'</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># df = df.replace(np.nan, 0, regex=True)</span><span class="pln">
  
 </span><span class="com"># And filter out for points only in Baltimore City. </span><span class="pln">
 geoloom_df </span><span class="pun">=</span><span class="pln"> geoloom_df</span><span class="pun">[</span><span class="pln"> geoloom_df</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">39.3</span><span class="pln">  </span><span class="pun">]</span><span class="pln">
 geoloom_df </span><span class="pun">=</span><span class="pln"> geoloom_df</span><span class="pun">[</span><span class="pln"> geoloom_df</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">39.5</span><span class="pln">  </span><span class="pun">]</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln">crs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="str">'init'</span><span class="pln"> </span><span class="pun">:</span><span class="str">'epsg:2248'</span><span class="pun">}</span><span class="pln"> 
 geometry</span><span class="pun">=[</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">xy</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> xy </span><span class="kwd">in</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">geoloom_df</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">],</span><span class="pln"> geoloom_df</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">])]</span><span class="pln">
 geoloom_gdf </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="typ">GeoDataFrame</span><span class="pun">(</span><span class="pln"> geoloom_df</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">([</span><span class="str">'POINT_X'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'POINT_Y'</span><span class="pun">],</span><span class="pln"> axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">),</span><span class="pln"> crs</span><span class="pun">=</span><span class="pln">crs</span><span class="pun">,</span><span class="pln"> geometry</span><span class="pun">=</span><span class="pln">geometry</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># 39.2904° N, 76.6122°</span></pre><p>Heres a neat trick to make it more presentable, because those points mean nothing to me.</p><pre class="prettyprint prettyprinted" style=""><span class="pln">ax </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'hhchpov18'</span><span class="pun">,</span><span class="pln"> edgecolor</span><span class="pun">=</span><span class="str">'black'</span><span class="pun">)</span><span class="pln">
  
 </span><span class="com"># now plot our points over it.</span><span class="pln">
 geoloom_gdf</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">ax</span><span class="pun">=</span><span class="pln">ax</span><span class="pun">,</span><span class="pln"> color</span><span class="pun">=</span><span class="str">'red'</span><span class="pun">)</span><span class="pln">
  
 plt</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span></pre></details><details><summary style=""><h4 id="Approach__Me...">Approach 2: Method 3: Using a Crosswalk (Need Crosswalk on Esri)</h4><a class="anchor" href="#Approach__Me..." id="#Approach__Me..." aria-label="Link to Approach__Me..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>When you want to merge two datasets that do not share a common column, it is often useful to create a 'crosswalk' file that 'maps' records between two datasets. We can do this to append spatial data when a direct merge is not readily evident.</p><p>Check out this next example where we pull ACS Census data and use its 'tract' column and map it to a community. We can then aggregate the points along a the communities they belong to and map it on a choropleth!</p><p>We will set up our ACS query variables right here for easy changing</p><pre class="prettyprint prettyprinted" style=""><span class="com"># Change these values in the cell below using different geographic reference codes will change those parameters</span><span class="pln">
 tract </span><span class="pun">=</span><span class="pln"> </span><span class="str">'*'</span><span class="pln">
 county </span><span class="pun">=</span><span class="pln"> </span><span class="str">'510'</span><span class="pln"> </span><span class="com"># '059' # 153 '510'</span><span class="pln">
 state </span><span class="pun">=</span><span class="pln"> </span><span class="str">'24'</span><span class="pln"> </span><span class="com">#51</span><span class="pln">
  
 </span><span class="com"># Specify the download parameters the function will receieve here</span><span class="pln">
 tableId </span><span class="pun">=</span><span class="pln"> </span><span class="str">'B19049'</span><span class="pln"> </span><span class="com"># 'B19001'</span><span class="pln">
 year </span><span class="pun">=</span><span class="pln"> </span><span class="str">'17'</span><span class="pln">
 saveAcs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln"> </span></pre><p>And now we will call the function with those variables and check out the result</p><pre class="prettyprint prettyprinted" style=""><span class="typ">IPython</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="pln">HTML</span><span class="pun">(</span><span class="str">"</span><style></style><span class="str">"</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># state, county, tract, tableId, year, saveOriginal, save </span><span class="pln">
 df </span><span class="pun">=</span><span class="pln"> retrieve_acs_data</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln"> county</span><span class="pun">,</span><span class="pln"> tract</span><span class="pun">,</span><span class="pln"> tableId</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">)</span><span class="pln">
 df</span><span class="pun">.</span><span class="pln">head</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
 df</span><span class="pun">.</span><span class="pln">to_csv</span><span class="pun">(</span><span class="str">'tracts_data.csv'</span><span class="pun">)</span></pre><p>This contains the CSA labels we will map our tracts to. This terminal command will download it</p><p>Here</p><pre class="prettyprint prettyprinted" style=""><span class="pln">crosswalk</span><span class="pun">.</span><span class="pln">tail</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln"> merged_df_geom </span><span class="pun">=</span><span class="pln"> mergeDatasets</span><span class="pun">(</span><span class="pln">left_ds</span><span class="pun">=</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> right_ds</span><span class="pun">=</span><span class="pln">crosswalk</span><span class="pun">,</span><span class="pln"> crosswalk_ds</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">
                   left_col</span><span class="pun">=</span><span class="str">'tract'</span><span class="pun">,</span><span class="pln"> right_col</span><span class="pun">=</span><span class="str">'TRACTCE10'</span><span class="pun">,</span><span class="pln">
                   crosswalk_left_col </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> crosswalk_right_col </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">,</span><span class="pln">
                   merge_how</span><span class="pun">=</span><span class="str">'outer'</span><span class="pun">,</span><span class="pln"> </span><span class="com"># left right or columnname to retrieve</span><span class="pln">
                   interactive</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">)</span><span class="pln">
 merged_df_geom</span><span class="pun">.</span><span class="pln">head</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="typ">Hhchpov</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="pln">read_file</span><span class="pun">(</span><span class="str">"https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Hhchpov/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson"</span><span class="pun">)</span><span class="pln">
 </span><span class="typ">Hhchpov</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Hhchpov</span><span class="pun">[[</span><span class="str">'CSA2010'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'hhchpov15'</span><span class="pun">,</span><span class="pln">	</span><span class="str">'hhchpov16'</span><span class="pun">,</span><span class="pln">	</span><span class="str">'hhchpov17'</span><span class="pun">,</span><span class="pln">	</span><span class="str">'hhchpov18'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'geometry'</span><span class="pun">]]</span><span class="pln">
 </span><span class="typ">Hhchpov</span><span class="pun">.</span><span class="pln">to_file</span><span class="pun">(</span><span class="str">"Hhchpov.geojson"</span><span class="pun">,</span><span class="pln"> driver</span><span class="pun">=</span><span class="str">'GeoJSON'</span><span class="pun">)</span><span class="pln">
 </span><span class="typ">Hhchpov</span><span class="pun">.</span><span class="pln">to_csv</span><span class="pun">(</span><span class="str">'Hhchpov.csv'</span><span class="pun">)</span><span class="pln">
 gpd</span><span class="pun">.</span><span class="pln">read_file</span><span class="pun">(</span><span class="str">"Hhchpov.geojson"</span><span class="pun">).</span><span class="pln">head</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># df.merge(crosswalk, left_on='tract', right_on='TRACTCE10')</span></pre><p>A simple example of how this would work</p><pre class="prettyprint prettyprinted" style=""><span class="pln">merged_df </span><span class="pun">=</span><span class="pln"> mergeDatasets</span><span class="pun">(</span><span class="pln">left_ds</span><span class="pun">=</span><span class="pln">merged_df_geom</span><span class="pun">,</span><span class="pln"> right_ds</span><span class="pun">=</span><span class="typ">Hhchpov</span><span class="pun">,</span><span class="pln"> crosswalk_ds</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">
                   left_col</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pun">,</span><span class="pln"> right_col</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pun">,</span><span class="pln">
                   crosswalk_left_col </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> crosswalk_right_col </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">,</span><span class="pln">
                   merge_how</span><span class="pun">=</span><span class="str">'outer'</span><span class="pun">,</span><span class="pln"> </span><span class="com"># left right or columnname to retrieve</span><span class="pln">
                   interactive</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># The attributes are what we will use.</span><span class="pln">
 in_crs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2248</span><span class="pln"> </span><span class="com"># The CRS we recieve our data </span><span class="pln">
 out_crs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4326</span><span class="pln"> </span><span class="com"># The CRS we would like to have our data represented as</span><span class="pln">
 geom </span><span class="pun">=</span><span class="pln"> </span><span class="str">'geometry'</span><span class="pln"> </span><span class="com"># The column where our spatial information lives.</span><span class="pln">
 
 </span><span class="com"># To create this dataset I had to commit a full outer join. </span><span class="pln">
 </span><span class="com"># In this way geometries will be included even if there merge does not have a direct match. </span><span class="pln">
 </span><span class="com"># What this will do is that it means at least one (near) empty record for each community will exist that includes (at minimum) the geographic information and name of a Community.</span><span class="pln">
 </span><span class="com"># That way if no point level information existed in the community, that during the merge the geoboundaries are still carried over.</span><span class="pln">
 
 </span><span class="com"># Primary Table</span><span class="pln">
 </span><span class="com"># Description: I created a public dataset from a google xlsx sheet 'Bank Addresses and Census Tract'.</span><span class="pln">
 </span><span class="com"># Table: FDIC Baltimore Banks</span><span class="pln">
 </span><span class="com"># Columns: Bank Name, Address(es), Census Tract</span><span class="pln">
 left_ds </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tracts_data.csv'</span><span class="pln">
 left_col </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tract'</span><span class="pln">
 
 </span><span class="com"># Crosswalk Table</span><span class="pln">
 </span><span class="com"># Table: Crosswalk Census Communities</span><span class="pln">
 </span><span class="com"># 'TRACT2010', 'GEOID2010', 'CSA2010'</span><span class="pln">
 crosswalk_ds </span><span class="pun">=</span><span class="pln"> </span><span class="str">'CSA-to-Tract-2010.csv'</span><span class="pln">
 use_crosswalk </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
 crosswalk_left_col </span><span class="pun">=</span><span class="pln"> </span><span class="str">'TRACTCE10'</span><span class="pln">
 crosswalk_right_col </span><span class="pun">=</span><span class="pln"> </span><span class="str">'CSA2010'</span><span class="pln">
 
 </span><span class="com"># Secondary Table</span><span class="pln">
 </span><span class="com"># Table: Baltimore Boundaries =&gt; HHCHPOV</span><span class="pln">
 </span><span class="com"># 'TRACTCE10', 'GEOID10', 'CSA', 'NAME10', 'Tract', 'geometry'</span><span class="pln">
 right_ds </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hhchpov.geojson'</span><span class="pln">
 right_col </span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln">
 
 interactive </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pln">
 merge_how </span><span class="pun">=</span><span class="pln"> </span><span class="str">'outer'</span><span class="pln">
 
 </span><span class="com"># reutrns a pandas dataframe</span><span class="pln">
 mergedf </span><span class="pun">=</span><span class="pln"> merge</span><span class="pun">.</span><span class="pln">mergeDatasets</span><span class="pun">(</span><span class="pln"> left_ds</span><span class="pun">=</span><span class="pln">left_ds</span><span class="pun">,</span><span class="pln"> left_col</span><span class="pun">=</span><span class="pln">left_col</span><span class="pun">,</span><span class="pln"> 
               crosswalk_ds</span><span class="pun">=</span><span class="pln">crosswalk_ds</span><span class="pun">,</span><span class="pln">
               crosswalk_left_col </span><span class="pun">=</span><span class="pln"> crosswalk_left_col</span><span class="pun">,</span><span class="pln"> crosswalk_right_col </span><span class="pun">=</span><span class="pln"> crosswalk_right_col</span><span class="pun">,</span><span class="pln">
               right_ds</span><span class="pun">=</span><span class="pln">right_ds</span><span class="pun">,</span><span class="pln"> right_col</span><span class="pun">=</span><span class="pln">right_col</span><span class="pun">,</span><span class="pln"> 
               merge_how</span><span class="pun">=</span><span class="pln">merge_how</span><span class="pun">,</span><span class="pln"> interactive </span><span class="pun">=</span><span class="pln"> interactive </span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># mergedf[geom] = mergedf[geom].apply(lambda x: loads( str(x) ) ) </span><span class="pln">
 
 </span><span class="com"># Process the dataframe as a geodataframe with a known CRS and geom column </span><span class="pln">
 mergedGdf </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GeoDataFrame</span><span class="pun">(</span><span class="pln">mergedf</span><span class="pun">,</span><span class="pln"> crs</span><span class="pun">=</span><span class="pln">in_crs</span><span class="pun">,</span><span class="pln"> geometry</span><span class="pun">=</span><span class="pln">geom</span><span class="pun">)</span><span class="pln"> </span></pre><h5 id="approach-2-method-4-geocoding-addresses-and-landmarks-to-coordinates">Approach 2: Method 4: Geocoding Addresses and Landmarks to Coordinates</h5><p>Sometimes (usually) we just don't have the coordinates of a place, but we do know it's address or that it is an established landmark.</p><p>In such cases we attempt 'geo-coding' these points in an automated manner.</p><p>While convenient, this process is error prone, so be sure to check it's work!</p><p>For this next example to take place, we need a dataset that has a bunch of addresses.</p><p>We can use the geoloom dataset from before in this example. We'll just drop geo'spatial data.</p><pre class="prettyprint prettyprinted" style=""><span class="pln">geoloom </span><span class="pun">=</span><span class="pln"> geoloom</span><span class="pun">.</span><span class="pln">dropna</span><span class="pun">(</span><span class="pln">subset</span><span class="pun">=[</span><span class="str">'geometry'</span><span class="pun">])</span><span class="pln">
 geoloom </span><span class="pun">=</span><span class="pln"> geoloom</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="pln">columns</span><span class="pun">=[</span><span class="str">'geometry'</span><span class="pun">,</span><span class="str">'GlobalID'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'POINT_X'</span><span class="pun">,</span><span class="pln">	</span><span class="str">'POINT_Y'</span><span class="pun">])</span><span class="pln">
 geoloom</span><span class="pun">.</span><span class="pln">head</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></pre><p>But if for whatever reason the link is down, you can use this example dataframe mapping just some of the many malls in baltimore.</p><pre class="prettyprint prettyprinted" style=""><span class="pln">    </span><span class="str">'Location'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">Series</span><span class="pun">([</span><span class="pln">
     </span><span class="str">'100 N. Holliday St, Baltimore, MD 21202'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'200 E Pratt St, Baltimore, MD'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'2401 Liberty Heights Ave, Baltimore, MD'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'201 E Pratt St, Baltimore, MD'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'3501 Boston St, Baltimore, MD'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'857 E Fort Ave, Baltimore, MD'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'2413 Frederick Ave, Baltimore, MD'</span><span class="pln">
   </span><span class="pun">]),</span><span class="pln">
     </span><span class="str">'Address'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">Series</span><span class="pun">([</span><span class="pln"> 
     </span><span class="str">'Baltimore City Council'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'The Gallery at Harborplace'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'Mondawmin Mall'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'Harborplace'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'The Shops at Canton Crossing'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'Southside Marketplace'</span><span class="pun">,</span><span class="pln">
     </span><span class="str">'Westside Shopping Center'</span><span class="pln">
   </span><span class="pun">])</span><span class="pln">
 </span><span class="pun">})</span><span class="pln">
 
 address_df</span><span class="pun">.</span><span class="pln">head</span><span class="pun">()</span></pre><p>You can use either the Location or Address column to perform the geo-coding on.</p><pre class="prettyprint prettyprinted" style=""><span class="pln">addrCol </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Location'</span></pre><p>This function takes a while. The less columns/data/records the faster it executes.</p><pre class="prettyprint prettyprinted" style=""><span class="pln"> </span><span class="com"># In this example we retrieve and map a dataset with no lat/lng but containing an address</span><span class="pln">
 
 </span><span class="com"># In this example our data is stored in the 'STREET' attribute</span><span class="pln">
 geometry </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 geolocator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Nominatim</span><span class="pun">(</span><span class="pln">user_agent</span><span class="pun">=</span><span class="str">"my-application"</span><span class="pun">)</span><span class="pln">
 
 </span><span class="kwd">for</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> row </span><span class="kwd">in</span><span class="pln"> address_df</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
   </span><span class="com"># We will try and return an address for each Street Name</span><span class="pln">
   </span><span class="kwd">try</span><span class="pun">:</span><span class="pln"> 
       </span><span class="com"># retrieve the geocoded information of our street address</span><span class="pln">
       geol </span><span class="pun">=</span><span class="pln"> geolocator</span><span class="pun">.</span><span class="pln">geocode</span><span class="pun">(</span><span class="pln">row</span><span class="pun">[</span><span class="pln">addrCol</span><span class="pun">],</span><span class="pln"> timeout</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">)</span><span class="pln">
 
       </span><span class="com"># create a mappable coordinate point from the response object's lat/lang values.</span><span class="pln">
       pnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Point</span><span class="pun">(</span><span class="pln">geol</span><span class="pun">.</span><span class="pln">longitude</span><span class="pun">,</span><span class="pln"> geol</span><span class="pun">.</span><span class="pln">latitude</span><span class="pun">)</span><span class="pln">
       
       </span><span class="com"># Append this value to the list of geometries</span><span class="pln">
       geometry</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">pnt</span><span class="pun">)</span><span class="pln">
       
   </span><span class="kwd">except</span><span class="pun">:</span><span class="pln"> 
       </span><span class="com"># If no street name was found decide what to do here.</span><span class="pln">
       </span><span class="com"># df.loc[index]['geom'] = Point(0,0) # Alternate method</span><span class="pln">
       geometry</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="typ">Point</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="lit">0</span><span class="pun">))</span><span class="pln">
       
 </span><span class="com"># Finally, we stuff the geometry data we created back into the dataframe</span><span class="pln">
 address_df</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> geometry</span></pre><p>Awesome! Now convert the dataframe into a geodataframe and map it!</p><pre class="prettyprint prettyprinted" style=""><span class="pln">gdf </span><span class="pun">=</span><span class="pln"> gdf</span><span class="pun">[</span><span class="pln"> gdf</span><span class="pun">.</span><span class="pln">centroid</span><span class="pun">.</span><span class="pln">y </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">39.3</span><span class="pln">  </span><span class="pun">]</span><span class="pln">
 gdf </span><span class="pun">=</span><span class="pln"> gdf</span><span class="pun">[</span><span class="pln"> gdf</span><span class="pun">.</span><span class="pln">centroid</span><span class="pun">.</span><span class="pln">y </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">39.5</span><span class="pln">  </span><span class="pun">]</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln">ax </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'hhchpov18'</span><span class="pun">,</span><span class="pln"> edgecolor</span><span class="pun">=</span><span class="str">'black'</span><span class="pun">)</span><span class="pln">
 
 </span><span class="com"># now plot our points over it.</span><span class="pln">
 geoloom_gdf</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">ax</span><span class="pun">=</span><span class="pln">ax</span><span class="pun">,</span><span class="pln"> color</span><span class="pun">=</span><span class="str">'red'</span><span class="pun">)</span></pre><p>A litte later down, we'll see how to make this even-more interactive.</p></details></details><details><summary style=""><h3 id="Approach__Co...">Approach 3: Connecting to a PostGIS database</h3><a class="anchor" href="#Approach__Co..." id="#Approach__Co..." aria-label="Link to Approach__Co..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>In the following example pulls point geodata from a Postgres database.</p><p>We will pull the postgres point data in two manners.</p><ul><li><p>SQL query where an SQL query uses ST_Transform(the_geom,4326) to transform the_geom's CRS from a DATABASE Binary encoding into standard Lat Long's</p></li><li><p>Using a plan SQL query and performing the conversion using gpd.io.sql.read_postgis() to pull the data in as 2248 and convert the CRS using .to_crs(epsg=4326)</p></li><li><p>These examples will not work in colabs as their is no local database to connect to and has been commented out for that reason</p></li></ul><pre class="prettyprint prettyprinted" style=""><span class="str">'''
 conn = psycopg2.connect(host='', dbname='', user='', password='', port='')
 
 # DB Import Method One
 sql1 = '</span><span class="pln">SELECT the_geom</span><span class="pun">,</span><span class="pln"> gid</span><span class="pun">,</span><span class="pln"> geogcode</span><span class="pun">,</span><span class="pln"> ooi</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">,</span><span class="pln"> addrtyp</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">,</span><span class="pln"> block</span><span class="pun">,</span><span class="pln"> lot</span><span class="pun">,</span><span class="pln"> desclu</span><span class="pun">,</span><span class="pln"> existing FROM housing</span><span class="pun">.</span><span class="pln">mdprop_2017v2 limit </span><span class="lit">100</span><span class="pun">;</span><span class="str">'
 pointData = gpd.io.sql.read_postgis(sql1, conn, geom_col='</span><span class="pln">the_geom</span><span class="str">', crs=2248)
 pointData = pointData.to_crs(epsg=4326)
 
 # DB Import Method Two
 sql2 = '</span><span class="pln">SELECT ST_Transform</span><span class="pun">(</span><span class="pln">the_geom</span><span class="pun">,</span><span class="lit">4326</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> the_geom</span><span class="pun">,</span><span class="pln"> ooi</span><span class="pun">,</span><span class="pln"> desclu</span><span class="pun">,</span><span class="pln"> address FROM housing</span><span class="pun">.</span><span class="pln">mdprop_2017v2</span><span class="pun">;</span><span class="str">'
 pointData = gpd.GeoDataFrame.from_postgis(sql2, conn, geom_col='</span><span class="pln">the_geom</span><span class="str">', crs=4326)
 pointData.head()
 pointData.plot()
 '''</span></pre></details></details><details><summary style=""><h2 id="Basic_Operat...">Basic Operations</h2><a class="anchor" href="#Basic_Operat..." id="#Basic_Operat..." aria-label="Link to Basic_Operat..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><details><summary style=""><h3 id="Inspection">Inspection</h3><a class="anchor" href="#Inspection" id="#Inspection" aria-label="Link to Inspection" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="com"># for p in df['Tract'].sort_values(): print(p)</span><span class="pln">
 geomSummary</span><span class="pun">(</span><span class="pln">csa_gdf</span><span class="pun">)</span></pre></details><details><summary style=""><h3 id="Converting_C...">Converting CRS</h3><a class="anchor" href="#Converting_C..." id="#Converting_C..." aria-label="Link to Converting_C..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="com"># The gdf must be loaded with a known crs in order for the to_crs conversion to work</span><span class="pln">
 </span><span class="com"># We use this often to converting BNIAs custom CRS to the common type </span><span class="pln">
 out_crs </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4326</span><span class="pln">
 csa_gdf </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">to_crs</span><span class="pun">(</span><span class="pln">epsg</span><span class="pun">=</span><span class="pln">out_crs</span><span class="pun">)</span></pre></details><details><summary style=""><h3 id="Saving">Saving</h3><a class="anchor" href="#Saving" id="#Saving" aria-label="Link to Saving" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="pln">filename </span><span class="pun">=</span><span class="pln"> </span><span class="str">'TEST_FILE_NAME'</span><span class="pln">
 csa_gdf</span><span class="pun">.</span><span class="pln">to_file</span><span class="pun">(</span><span class="pln">f</span><span class="str">"{filename}.geojson"</span><span class="pun">,</span><span class="pln"> driver</span><span class="pun">=</span><span class="str">'GeoJSON'</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln">csa_gdf </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">to_crs</span><span class="pun">(</span><span class="pln">epsg</span><span class="pun">=</span><span class="lit">2248</span><span class="pun">)</span><span class="pln"> </span><span class="com">#just making sure</span><span class="pln">
 csa_gdf</span><span class="pun">.</span><span class="pln">to_file</span><span class="pun">(</span><span class="pln">filename</span><span class="pun">+</span><span class="str">'.shp'</span><span class="pun">,</span><span class="pln"> driver</span><span class="pun">=</span><span class="str">'ESRI Shapefile'</span><span class="pun">)</span><span class="pln">
 csa_gdf </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="pln">read_file</span><span class="pun">(</span><span class="pln">filename</span><span class="pun">+</span><span class="str">'.shp'</span><span class="pun">)</span></pre></details><details><summary style=""><h3 id="Draw_Tool">Draw Tool</h3><a class="anchor" href="#Draw_Tool" id="#Draw_Tool" aria-label="Link to Draw_Tool" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><pre class="prettyprint prettyprinted" style=""><span class="kwd">from</span><span class="pln"> folium</span><span class="pun">.</span><span class="pln">plugins </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">Draw</span><span class="pln">
 </span><span class="com"># Draw tool. Create and export your own boundaries</span><span class="pln">
 m </span><span class="pun">=</span><span class="pln"> folium</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">()</span><span class="pln">
 draw </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Draw</span><span class="pun">()</span><span class="pln">
 draw</span><span class="pun">.</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln">
 m </span><span class="pun">=</span><span class="pln"> folium</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">(</span><span class="pln">location</span><span class="pun">=[</span><span class="lit">39.28759453969165</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">76.61278931706487</span><span class="pun">],</span><span class="pln"> zoom_start</span><span class="pun">=</span><span class="lit">12</span><span class="pun">)</span><span class="pln">
 draw </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Draw</span><span class="pun">(</span><span class="kwd">export</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
 draw</span><span class="pun">.</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># m.save(os.path.join('results', 'Draw1.html'))</span><span class="pln">
 m</span></pre></details><details><summary style=""><h3 id="Geometric_Ma...">Geometric Manipulations</h3><a class="anchor" href="#Geometric_Ma..." id="#Geometric_Ma..." aria-label="Link to Geometric_Ma..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><p>Boundary</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">boundary
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>envelope</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">envelope
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>convex_hull</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">convex_hull
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
 </span><span class="com"># , cmap='OrRd', scheme='quantiles'</span><span class="pln">
 </span><span class="com"># newcsa.boundary.plot(  )</span></pre><p>simplify</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">simplify</span><span class="pun">(</span><span class="lit">30</span><span class="pun">)</span><span class="pln">
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>buffer</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">buffer</span><span class="pun">(</span><span class="lit">0.01</span><span class="pun">)</span><span class="pln">
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>rotate</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">rotate</span><span class="pun">(</span><span class="lit">30</span><span class="pun">)</span><span class="pln">
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>scale</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">scale</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre><p>skew</p><pre class="prettyprint prettyprinted" style=""><span class="pln">newcsa</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> csa_gdf</span><span class="pun">.</span><span class="pln">skew</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">)</span><span class="pln">
 newcsa</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">column</span><span class="pun">=</span><span class="str">'CSA2010'</span><span class="pln"> </span><span class="pun">)</span></pre></details></details><details><summary style=""><h2 id="Advanced">Advanced</h2><a class="anchor" href="#Advanced" id="#Advanced" aria-label="Link to Advanced" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a></summary><h3 id="Create_Geosp..." style="">Create Geospatial Functions</h3><a class="anchor" href="#Create_Geosp..." id="#Create_Geosp..." aria-label="Link to Create_Geosp..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p><strong>Operations:</strong></p><ul><li>Reading in data (points/ geoms) -- Convert lat/lng columns to point coordinates -- Geocoding address to coordinates -- Changing coordinate reference systems -- Connecting to PostGisDB's</li><li><p>Basic Operations</p></li><li><p>Saving shape data</p></li><li><p>Get Polygon Centroids</p></li><li>Working with Points and Polygons -- Map Points and Polygons -- Get Points in Polygons</li></ul><p><strong>Input(s):</strong></p><ul><li><p>Dataset (points/ bounds) url</p></li><li><p>Points/ bounds geometry column(s)</p></li><li><p>Points/ bounds crs's</p></li><li><p>Points/ bounds mapping color(s)</p></li><li><p>New filename</p></li></ul><p><strong>Output:</strong> File</p><p>This function will handle common geo spatial exploratory methods. It covers everything discussed in the basic operations and more!</p><pre class="prettyprint prettyprinted" style=""><span class="com">#</span><span class="pln">
 </span><span class="com"># Work With Geometry Data</span><span class="pln">
 </span><span class="com"># Description: geomSummary, getPointsInPolygons, getPolygonOnPoints, mapPointsInPolygons, getCentroids</span><span class="pln">
 </span><span class="com">#</span><span class="pln">
 </span><span class="kwd">def</span><span class="pln"> workWithGeometryData</span><span class="pun">(</span><span class="pln">method</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> df</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> polys</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> ptsCoordCol</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> polygonsCoordCol</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> polyColorCol</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> polygonsLabel</span><span class="pun">=</span><span class="str">'polyOnPoint'</span><span class="pun">,</span><span class="pln"> pntsClr</span><span class="pun">=</span><span class="str">'red'</span><span class="pun">,</span><span class="pln"> polysClr</span><span class="pun">=</span><span class="str">'white'</span><span class="pun">,</span><span class="pln"> interactive</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">):</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> geomSummary</span><span class="pun">(</span><span class="pln">df</span><span class="pun">):</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> type</span><span class="pun">(</span><span class="pln">df</span><span class="pun">),</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">crs</span><span class="pun">,</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">;</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> getCentroid</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">):</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">col</span><span class="pun">].</span><span class="pln">representative_point</span><span class="pun">()</span><span class="pln"> </span><span class="com"># df['geometry'].centroid</span><span class="pln">
 
   </span><span class="com"># To 'import' a script you wrote, map its filepath into the sys</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> getPolygonOnPoints</span><span class="pun">(</span><span class="pln">pts</span><span class="pun">,</span><span class="pln"> polygons</span><span class="pun">,</span><span class="pln"> ptsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsLabel</span><span class="pun">,</span><span class="pln"> interactive</span><span class="pun">):</span><span class="pln">
       count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
       </span><span class="com"># We're going to keep a list of how many points we find.</span><span class="pln">
       boundaries </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 
       </span><span class="com"># Loop over polygons with index i.</span><span class="pln">
       </span><span class="kwd">for</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> pt </span><span class="kwd">in</span><span class="pln"> pts</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
           </span><span class="com"># print('Searching for point within Geom:', pt )</span><span class="pln">
           </span><span class="com"># Only one Label is accepted.</span><span class="pln">
           poly_on_this_point </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
           </span><span class="com"># Now loop over all polygons with index j.</span><span class="pln">
           </span><span class="kwd">for</span><span class="pln"> j</span><span class="pun">,</span><span class="pln"> poly </span><span class="kwd">in</span><span class="pln"> polygons</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
               </span><span class="kwd">if</span><span class="pln"> poly</span><span class="pun">[</span><span class="pln">polygonsCoordCol</span><span class="pun">].</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">pt</span><span class="pun">[</span><span class="pln">ptsCoordCol</span><span class="pun">]):</span><span class="pln">
                   </span><span class="com"># Then it's a hit! Add it to the list</span><span class="pln">
                   poly_on_this_point</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">poly</span><span class="pun">[</span><span class="pln">polygonsLabel</span><span class="pun">])</span><span class="pln">
                   count </span><span class="pun">=</span><span class="pln"> count </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                   </span><span class="com"># pts = pts.drop([j])</span><span class="pln">
 
           </span><span class="com"># We could do all sorts, like grab a property of the</span><span class="pln">
           </span><span class="com"># points, but let's just append the number of them.</span><span class="pln">
           boundaries</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">poly_on_this_point</span><span class="pun">)</span><span class="pln">
           clear_output</span><span class="pun">(</span><span class="pln">wait</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
 
       </span><span class="com"># Add the number of points for each poly to the dataframe.</span><span class="pln">
       pts </span><span class="pun">=</span><span class="pln"> pts</span><span class="pun">.</span><span class="pln">assign</span><span class="pun">(</span><span class="pln">CSA2010 </span><span class="pun">=</span><span class="pln"> boundaries</span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">interactive</span><span class="pun">):</span><span class="pln">
         </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Total Points: '</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pts</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">pts</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
         </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Total Points in Polygons: '</span><span class="pun">,</span><span class="pln"> count </span><span class="pun">)</span><span class="pln">
         </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Prcnt Points in Polygons: '</span><span class="pun">,</span><span class="pln"> count </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pts</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">pts</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">return</span><span class="pln"> pts
 
   </span><span class="com"># To 'import' a script you wrote, map its filepath into the sys</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> getPointsInPolygons</span><span class="pun">(</span><span class="pln">pts</span><span class="pun">,</span><span class="pln"> polygons</span><span class="pun">,</span><span class="pln"> ptsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsCoordCol</span><span class="pun">,</span><span class="pln"> interactive</span><span class="pun">):</span><span class="pln">
     count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
     total </span><span class="pun">=</span><span class="pln"> pts</span><span class="pun">.</span><span class="pln">size </span><span class="pun">/</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">pts</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">)</span><span class="pln">
     </span><span class="com"># We're going to keep a list of how many points we find.</span><span class="pln">
     pts_in_polys </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
 
     </span><span class="com"># Loop over polygons with index i.</span><span class="pln">
     </span><span class="kwd">for</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> poly </span><span class="kwd">in</span><span class="pln"> polygons</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
         </span><span class="com"># print('Searching for point within Geom:', poly )</span><span class="pln">
         </span><span class="com"># Keep a list of points in this poly</span><span class="pln">
         pts_in_this_poly </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
 
         </span><span class="com"># Now loop over all points with index j.</span><span class="pln">
         </span><span class="kwd">for</span><span class="pln"> j</span><span class="pun">,</span><span class="pln"> pt </span><span class="kwd">in</span><span class="pln"> pts</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
             </span><span class="kwd">if</span><span class="pln"> poly</span><span class="pun">[</span><span class="pln">polygonsCoordCol</span><span class="pun">].</span><span class="pln">contains</span><span class="pun">(</span><span class="pln">pt</span><span class="pun">[</span><span class="pln">ptsCoordCol</span><span class="pun">]):</span><span class="pln">
                 </span><span class="com"># Then it's a hit! Add it to the list,</span><span class="pln">
                 pts_in_this_poly </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
                 </span><span class="com"># and drop it so we have less hunting. # pts = pts.drop([j])</span><span class="pln">
 
         </span><span class="com"># We could do all sorts, like grab a property of the</span><span class="pln">
         </span><span class="com"># points, but let's just append the number of them.</span><span class="pln">
         pts_in_polys</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">pts_in_this_poly</span><span class="pun">)</span><span class="pln">
         </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">interactive</span><span class="pun">):</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Found this many points within the Geom:'</span><span class="pun">,</span><span class="pln"> pts_in_this_poly </span><span class="pun">)</span><span class="pln">
         count </span><span class="pun">+=</span><span class="pln"> pts_in_this_poly
         clear_output</span><span class="pun">(</span><span class="pln">wait</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># Add the number of points for each poly to the dataframe.</span><span class="pln">
     polygons</span><span class="pun">[</span><span class="str">'pointsinpolygon'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="typ">GeoSeries</span><span class="pun">(</span><span class="pln">pts_in_polys</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">interactive</span><span class="pun">):</span><span class="pln">
       </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Total Points: '</span><span class="pun">,</span><span class="pln"> total </span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Total Points in Polygons: '</span><span class="pun">,</span><span class="pln"> count </span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">print</span><span class="pun">(</span><span class="pln"> </span><span class="str">'Prcnt Points in Polygons: '</span><span class="pun">,</span><span class="pln"> count </span><span class="pun">/</span><span class="pln"> total </span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">return</span><span class="pln"> polygons
 
   </span><span class="kwd">def</span><span class="pln"> mapPointsandPolygons</span><span class="pun">(</span><span class="pln">pnts</span><span class="pun">,</span><span class="pln"> polys</span><span class="pun">,</span><span class="pln"> pntsCl</span><span class="pun">,</span><span class="pln"> polysClr</span><span class="pun">,</span><span class="pln"> polyColorCol</span><span class="pun">):</span><span class="pln">
     </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'mapPointsandPolygons'</span><span class="pun">);</span><span class="pln">
     </span><span class="com"># We restrict to South America.</span><span class="pln">
     ax </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> polyColorCol</span><span class="pun">:</span><span class="pln">
       ax </span><span class="pun">=</span><span class="pln"> polys</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln"> column</span><span class="pun">=</span><span class="pln">polyColorCol</span><span class="pun">,</span><span class="pln"> legend</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
       ax </span><span class="pun">=</span><span class="pln"> polys</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln"> color</span><span class="pun">=</span><span class="pln">polysClr</span><span class="pun">,</span><span class="pln"> edgecolor</span><span class="pun">=</span><span class="str">'black'</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># We can now plot our ``GeoDataFrame``.</span><span class="pln">
     pnts</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">ax</span><span class="pun">=</span><span class="pln">ax</span><span class="pun">,</span><span class="pln"> color</span><span class="pun">=</span><span class="pln">pntsClr</span><span class="pun">)</span><span class="pln">
 
     </span><span class="kwd">return</span><span class="pln"> plt</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span><span class="pln">
 
   </span><span class="kwd">if</span><span class="pln"> method</span><span class="pun">==</span><span class="str">'summary'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> geomSummary</span><span class="pun">(</span><span class="pln">df</span><span class="pun">);</span><span class="pln">
   </span><span class="kwd">if</span><span class="pln"> method</span><span class="pun">==</span><span class="str">'ponp'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> getPolygonOnPoints</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> polys</span><span class="pun">,</span><span class="pln"> ptsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsLabel</span><span class="pun">,</span><span class="pln"> interactive</span><span class="pun">);</span><span class="pln">
   </span><span class="kwd">if</span><span class="pln"> method</span><span class="pun">==</span><span class="str">'pinp'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> getPointsInPolygons</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> polys</span><span class="pun">,</span><span class="pln"> ptsCoordCol</span><span class="pun">,</span><span class="pln"> polygonsCoordCol</span><span class="pun">,</span><span class="pln"> interactive</span><span class="pun">);</span><span class="pln">
   </span><span class="kwd">if</span><span class="pln"> method</span><span class="pun">==</span><span class="str">'pandp'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> mapPointsandPolygons</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> polys</span><span class="pun">,</span><span class="pln"> pntsClr</span><span class="pun">,</span><span class="pln"> polysClr</span><span class="pun">,</span><span class="pln"> polyColorCol</span><span class="pun">);</span><span class="pln">
   </span><span class="kwd">if</span><span class="pln"> method</span><span class="pun">==</span><span class="str">'centroid'</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> getCentroid</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> col</span><span class="pun">);</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln">                plot_points</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> pt_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> \
                 draw_heatmap</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> heat_map_weights_col</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> \
                 heat_map_weights_normalize</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> heat_map_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">):</span><span class="pln">
     </span><span class="str">"""Creates a map given a dataframe of points. Can also produce a heatmap overlay
     Arg:
         df: dataframe containing points to maps
         lat_col: Column containing latitude (string) 
     """</span><span class="pln">
 
     </span><span class="com">## center map in the middle of points center in</span><span class="pln">
     middle_lat </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">].</span><span class="pln">median</span><span class="pun">()</span><span class="pln">
     middle_lon </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">].</span><span class="pln">median</span><span class="pun">()</span><span class="pln">
 
     curr_map </span><span class="pun">=</span><span class="pln"> folium</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">(</span><span class="pln">location</span><span class="pun">=[</span><span class="pln">middle_lat</span><span class="pun">,</span><span class="pln"> middle_lon</span><span class="pun">],</span><span class="pln">
                           zoom_start</span><span class="pun">=</span><span class="pln">zoom_start</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># add points to map</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> plot_points</span><span class="pun">:</span><span class="pln">
         </span><span class="kwd">for</span><span class="pln"> _</span><span class="pun">,</span><span class="pln"> row </span><span class="kwd">in</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
             folium</span><span class="pun">.</span><span class="typ">CircleMarker</span><span class="pun">([</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> row</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">]],</span><span class="pln">
                                 radius</span><span class="pun">=</span><span class="pln">pt_radius</span><span class="pun">,</span><span class="pln">
                                 popup</span><span class="pun">=</span><span class="pln">row</span><span class="pun">[</span><span class="str">'name'</span><span class="pun">],</span><span class="pln">
                                 fill_color</span><span class="pun">=</span><span class="str">"#3db7e4"</span><span class="pun">,</span><span class="pln"> </span><span class="com"># divvy color</span><span class="pln">
                                </span><span class="pun">).</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">curr_map</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># add heatmap</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> draw_heatmap</span><span class="pun">:</span><span class="pln">
         </span><span class="com"># convert to (n, 2) or (n, 3) matrix format</span><span class="pln">
         </span><span class="kwd">if</span><span class="pln"> heat_map_weights_col </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
             stations </span><span class="pun">=</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">])</span><span class="pln">
         </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
             </span><span class="com"># if we have to normalize</span><span class="pln">
             </span><span class="kwd">if</span><span class="pln"> heat_map_weights_normalize</span><span class="pun">:</span><span class="pln">
                 df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> \
                     df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
 
             stations </span><span class="pun">=</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">])</span><span class="pln">
 
         curr_map</span><span class="pun">.</span><span class="pln">add_child</span><span class="pun">(</span><span class="pln">plugins</span><span class="pun">.</span><span class="typ">HeatMap</span><span class="pun">(</span><span class="pln">stations</span><span class="pun">,</span><span class="pln"> radius</span><span class="pun">=</span><span class="pln">heat_map_radius</span><span class="pun">))</span><span class="pln">
 
     </span><span class="kwd">return</span><span class="pln"> curr_map</span></pre><pre class="prettyprint prettyprinted" style=""><span class="pln"> </span><span class="com"># reverseGeoCode, readFile, getGeoParams, main</span><span class="pln">
 </span><span class="kwd">def</span><span class="pln"> readInGeometryData</span><span class="pun">(</span><span class="pln">url</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">  save</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">=</span><span class="lit">4326</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">):</span><span class="pln">
 
   </span><span class="kwd">def</span><span class="pln"> reverseGeoCode</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> lat </span><span class="pun">):</span><span class="pln">
     </span><span class="com"># STREET	CITY	STATE ZIP NAME</span><span class="pln">
     </span><span class="com"># , format_string="%s, BALTIMORE MD"</span><span class="pln">
     geometry </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
     geolocator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Nominatim</span><span class="pun">(</span><span class="pln">user_agent</span><span class="pun">=</span><span class="str">"my-application"</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">for</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> row </span><span class="kwd">in</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
       </span><span class="kwd">try</span><span class="pun">:</span><span class="pln">
           geol </span><span class="pun">=</span><span class="pln"> geolocator</span><span class="pun">.</span><span class="pln">geocode</span><span class="pun">(</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lat</span><span class="pun">],</span><span class="pln"> timeout</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">)</span><span class="pln">
           pnt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Point</span><span class="pun">(</span><span class="pln">geol</span><span class="pun">.</span><span class="pln">longitude</span><span class="pun">,</span><span class="pln"> geol</span><span class="pun">.</span><span class="pln">latitude</span><span class="pun">)</span><span class="pln">
           geometry</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">pnt</span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">except</span><span class="pun">:</span><span class="pln">
           geometry</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="typ">Point</span><span class="pun">(-</span><span class="lit">76</span><span class="pun">,</span><span class="pln"> </span><span class="lit">39</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
           </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lat</span><span class="pun">]);</span><span class="pln">
     </span><span class="kwd">return</span><span class="pln"> geometry
 
   </span><span class="kwd">def</span><span class="pln"> readFile</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">):</span><span class="pln">
     df </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pln">
     gdf </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pln">
     ext </span><span class="pun">=</span><span class="pln"> isinstance</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">DataFrame</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> ext</span><span class="pun">:</span><span class="pln"> ext</span><span class="pun">=</span><span class="str">'csv'</span><span class="pln">
     </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> ext </span><span class="pun">=</span><span class="pln"> url</span><span class="pun">[-</span><span class="lit">3</span><span class="pun">:]</span><span class="pln">
 
     </span><span class="com">#XLS</span><span class="pln">
     </span><span class="com"># b16 = pd.read_excel('Jones.BirthsbyCensus2016.XLS', sheetname='Births')</span><span class="pln">
 
     </span><span class="com"># The file extension is used to determine the appropriate import method.</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> ext </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'son'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'kml'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'shp'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'pgeojson'</span><span class="pun">]:</span><span class="pln"> gdf </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="pln">read_file</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> ext </span><span class="pun">==</span><span class="pln"> </span><span class="str">'csv'</span><span class="pun">:</span><span class="pln">
       df </span><span class="pun">=</span><span class="pln"> url </span><span class="kwd">if</span><span class="pln"> isinstance</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">DataFrame</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">read_csv</span><span class="pun">(</span><span class="pln">url</span><span class="pun">)</span><span class="pln">
       </span><span class="com"># Read using Geom, Lat, Lat/Lng, revGeoCode</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> revgeocode</span><span class="pun">==</span><span class="str">'y'</span><span class="pun">:</span><span class="pln"> df</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> reverseGeoCode</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">elif</span><span class="pln"> geom</span><span class="pun">:</span><span class="pln"> df</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">geom</span><span class="pun">].</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> loads</span><span class="pun">(</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">))</span><span class="pln">
       </span><span class="kwd">elif</span><span class="pln"> lat</span><span class="pun">==</span><span class="pln">lng</span><span class="pun">:</span><span class="pln"> df</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lat</span><span class="pun">].</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">lambda</span><span class="pln"> x</span><span class="pun">:</span><span class="pln"> loads</span><span class="pun">(</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">))</span><span class="pln">
       </span><span class="kwd">elif</span><span class="pln"> lat</span><span class="pun">!=</span><span class="pln">lng</span><span class="pun">:</span><span class="pln"> df</span><span class="pun">[</span><span class="str">'geometry'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> gpd</span><span class="pun">.</span><span class="pln">points_from_xy</span><span class="pun">(</span><span class="pln">df</span><span class="pun">[</span><span class="pln">lng</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lat</span><span class="pun">]);</span><span class="pln">
 
       gdf </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GeoDataFrame</span><span class="pun">(</span><span class="pln">df</span><span class="pun">,</span><span class="pln"> crs</span><span class="pun">=</span><span class="pln">in_crs</span><span class="pun">,</span><span class="pln"> geometry</span><span class="pun">=</span><span class="str">'geometry'</span><span class="pun">)</span><span class="pln"> </span><span class="com">#crs=2248</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> out_crs </span><span class="pun">==</span><span class="pln"> in_crs</span><span class="pun">:</span><span class="pln"> gdf </span><span class="pun">=</span><span class="pln"> gdf</span><span class="pun">.</span><span class="pln">to_crs</span><span class="pun">(</span><span class="pln">epsg</span><span class="pun">=</span><span class="pln">out_crs</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">return</span><span class="pln"> gdf
 
   </span><span class="kwd">def</span><span class="pln"> getGeoParams</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">):</span><span class="pln">
     addr</span><span class="pun">=</span><span class="kwd">False</span><span class="pln">
 
     </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> url</span><span class="pun">:</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Please enter the location of your dataset: "</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
     </span><span class="com"># if url[-3:] == 'csv' :</span><span class="pln">
     </span><span class="com">#   df = pd.read_csv(url,index_col=0,nrows=1)</span><span class="pln">
     </span><span class="com">#   print(df.columns)</span><span class="pln">
 
     </span><span class="com"># Geometries inside</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> geom </span><span class="kwd">and</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lat </span><span class="kwd">and</span><span class="pln"> lng</span><span class="pun">):</span><span class="pln"> porg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'g'</span><span class="pln">
     </span><span class="com"># Point data inside</span><span class="pln">
     </span><span class="kwd">elif</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> geom </span><span class="kwd">and</span><span class="pln"> lat </span><span class="kwd">or</span><span class="pln"> lng</span><span class="pun">:</span><span class="pln">
       porg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'p'</span><span class="pun">;</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> lat</span><span class="pun">:</span><span class="pln"> lat </span><span class="pun">=</span><span class="pln"> lng
       </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> lng</span><span class="pun">:</span><span class="pln"> lng </span><span class="pun">=</span><span class="pln"> lat
 
     </span><span class="com"># If the P/G could not be infered...</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="pun">(</span><span class="pln">porg </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'p'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'g'</span><span class="pun">]):</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> revgeocode </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'y'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'n'</span><span class="pun">]:</span><span class="pln"> revgeocode </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Do your records need reverse geocoding: (Enter: y/n') "</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">if</span><span class="pln"> revgeocode </span><span class="pun">==</span><span class="pln"> </span><span class="str">'y'</span><span class="pun">:</span><span class="pln"> porg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'p'</span><span class="pun">;</span><span class="pln"> lng </span><span class="pun">=</span><span class="pln"> lat </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Please enter the column name where the address is stored: "</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
       </span><span class="kwd">elif</span><span class="pln"> revgeocode </span><span class="pun">==</span><span class="pln"> </span><span class="str">'n'</span><span class="pun">:</span><span class="pln"> porg </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"""Do the records in this dataset use (P)oints or (g)eometric polygons?: (Enter: 'p' or 'g') """</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
       </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> getGeoParams</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">);</span><span class="pln">
 
       </span><span class="kwd">if</span><span class="pln"> porg</span><span class="pun">==</span><span class="str">'p'</span><span class="pun">:</span><span class="pln">
           </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> lat</span><span class="pun">:</span><span class="pln"> lat </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Please enter the column name where the latitude coordinate is stored: "</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
           </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> lng</span><span class="pun">:</span><span class="pln"> lng </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Please enter the column name where the longitude cooridnate is stored: (Could be same as the lat) "</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
       </span><span class="kwd">elif</span><span class="pln"> porg</span><span class="pun">==</span><span class="str">'g'</span><span class="pun">:</span><span class="pln">
         </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> geom</span><span class="pun">:</span><span class="pln"> geom </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">(</span><span class="str">"Please enter column name where the geometry data is stored: (*optional, skip if unkown)"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
       </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> getGeoParams</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">)</span><span class="pln">
 
     </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> out_crs</span><span class="pun">:</span><span class="pln"> out_crs</span><span class="pun">=</span><span class="pln">in_crs
 
     </span><span class="kwd">return</span><span class="pln"> url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs
 
   </span><span class="com"># This function uses all the other functions</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> main</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">):</span><span class="pln">
 
     </span><span class="com"># Check for missing values. retrieve them</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isinstance</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">DataFrame</span><span class="pun">)):</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Converting DF to GDF'</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">elif</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">not</span><span class="pln"> </span><span class="pun">(</span><span class="pln">url </span><span class="kwd">and</span><span class="pln"> porg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
         </span><span class="kwd">not</span><span class="pln"> </span><span class="pun">(</span><span class="pln">porg </span><span class="pun">==</span><span class="pln"> </span><span class="str">'p'</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> porg </span><span class="pun">==</span><span class="pln"> </span><span class="str">'g'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
         porg </span><span class="pun">==</span><span class="pln"> </span><span class="str">'g'</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> geom</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> </span><span class="pun">(</span><span class="pln">
         porg </span><span class="pun">==</span><span class="pln"> </span><span class="str">'p'</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">not</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lat </span><span class="kwd">and</span><span class="pln"> lng</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">):</span><span class="pln">
       </span><span class="kwd">return</span><span class="pln"> readInGeometryData</span><span class="pun">(</span><span class="pln"> </span><span class="pun">*</span><span class="pln">getGeoParams</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
 
     </span><span class="com"># print(f"RECIEVED url: {url}, \r\n porg: {porg}, \r\n geom: {geom}, \r\n lat: {lat}, \r\n lng: {lng}, \r\n revgeocode: {revgeocode}, \r\n in_crs: {in_crs}, \r\n out_crs: {out_crs}")</span><span class="pln">
 
     </span><span class="com"># Quit if the Columns dont exist -&gt; CSV Only</span><span class="pln">
     </span><span class="com"># status = checkColumns(url, geom, lat, lng)</span><span class="pln">
     </span><span class="com"># if status == False: print('A specified column does not exist'); return False;</span><span class="pln">
 
     </span><span class="com"># Perform operation</span><span class="pln">
     gdf </span><span class="pun">=</span><span class="pln"> readFile</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># Tidy up</span><span class="pln">
 
     </span><span class="com"># Save</span><span class="pln">
     </span><span class="com"># if save: saveGeoData(gdf, url, fileName, driver='esri')</span><span class="pln">
 
     </span><span class="kwd">return</span><span class="pln"> gdf
 
   </span><span class="kwd">return</span><span class="pln"> main</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">,</span><span class="pln"> save</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># draw_heatmap, cluster_points, plot_points,</span><span class="pln">
 </span><span class="kwd">def</span><span class="pln"> map_points</span><span class="pun">(</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> lat_col</span><span class="pun">=</span><span class="str">'POINT_Y'</span><span class="pun">,</span><span class="pln"> lon_col</span><span class="pun">=</span><span class="str">'POINT_X'</span><span class="pun">,</span><span class="pln"> zoom_start</span><span class="pun">=</span><span class="lit">11</span><span class="pun">,</span><span class="pln"> plot_points</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> cluster_points</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">
                pt_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> draw_heatmap</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> heat_map_weights_col</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> heat_map_weights_normalize</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln">
                heat_map_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> popup</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">):</span><span class="pln">
     </span><span class="str">"""Creates a map given a dataframe of points. Can also produce a heatmap overlay
 
     Arg:
         df: dataframe containing points to maps
         lat_col: Column containing latitude (string)
         lon_col: Column containing longitude (string)
         zoom_start: Integer representing the initial zoom of the map
         plot_points: Add points to map (boolean)
         pt_radius: Size of each point
         draw_heatmap: Add heatmap to map (boolean)
         heat_map_weights_col: Column containing heatmap weights
         heat_map_weights_normalize: Normalize heatmap weights (boolean)
         heat_map_radius: Size of heatmap point
 
     Returns:
         folium map object
     """</span><span class="pln">
     df </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">copy</span><span class="pun">()</span><span class="pln">
     </span><span class="com">## center map in the middle of points center in</span><span class="pln">
     middle_lat </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">].</span><span class="pln">median</span><span class="pun">()</span><span class="pln">
     middle_lon </span><span class="pun">=</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">].</span><span class="pln">median</span><span class="pun">()</span><span class="pln">
 
     curr_map </span><span class="pun">=</span><span class="pln"> folium</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">(</span><span class="pln">location</span><span class="pun">=[</span><span class="pln">middle_lat</span><span class="pun">,</span><span class="pln"> middle_lon</span><span class="pun">],</span><span class="pln"> zoom_start</span><span class="pun">=</span><span class="pln">zoom_start</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># add points to map</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> plot_points</span><span class="pun">:</span><span class="pln">
       </span><span class="kwd">for</span><span class="pln"> _</span><span class="pun">,</span><span class="pln"> row </span><span class="kwd">in</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
         </span><span class="com"># print([row[lat_col], row[lon_col]], row[popup])</span><span class="pln">
         folium</span><span class="pun">.</span><span class="typ">CircleMarker</span><span class="pun">([</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> row</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">]],</span><span class="pln">
           radius</span><span class="pun">=</span><span class="pln">pt_radius</span><span class="pun">,</span><span class="pln">
           popup</span><span class="pun">=</span><span class="pln">row</span><span class="pun">[</span><span class="pln">popup</span><span class="pun">],</span><span class="pln">
           fill_color</span><span class="pun">=</span><span class="str">"#3db7e4"</span><span class="pun">,</span><span class="pln"> </span><span class="com"># divvy color</span><span class="pln">
         </span><span class="pun">).</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">curr_map</span><span class="pun">)</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> cluster_points</span><span class="pun">:</span><span class="pln">
       marker_cluster </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MarkerCluster</span><span class="pun">().</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">curr_map</span><span class="pun">)</span><span class="pln">
       </span><span class="kwd">for</span><span class="pln"> index</span><span class="pun">,</span><span class="pln"> row </span><span class="kwd">in</span><span class="pln"> df</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
         folium</span><span class="pun">.</span><span class="typ">Marker</span><span class="pun">(</span><span class="pln"> location</span><span class="pun">=[</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln">row</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">]],</span><span class="pln"> popup</span><span class="pun">=</span><span class="pln">row</span><span class="pun">[</span><span class="pln">popup</span><span class="pun">],</span><span class="pln"> icon</span><span class="pun">=</span><span class="kwd">None</span><span class="pln"> </span><span class="pun">).</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">marker_cluster</span><span class="pun">)</span><span class="pln">
 
     </span><span class="com"># add heatmap</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> draw_heatmap</span><span class="pun">:</span><span class="pln">
         </span><span class="com"># convert to (n, 2) or (n, 3) matrix format</span><span class="pln">
         </span><span class="kwd">if</span><span class="pln"> heat_map_weights_col </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">None</span><span class="pun">:</span><span class="pln">
             stations </span><span class="pun">=</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">])</span><span class="pln">
         </span><span class="kwd">else</span><span class="pun">:</span><span class="pln">
             </span><span class="com"># if we have to normalize</span><span class="pln">
             </span><span class="kwd">if</span><span class="pln"> heat_map_weights_normalize</span><span class="pun">:</span><span class="pln">
                 df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> \
                     df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">]</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
 
             stations </span><span class="pun">=</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">df</span><span class="pun">[</span><span class="pln">lat_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">lon_col</span><span class="pun">],</span><span class="pln"> df</span><span class="pun">[</span><span class="pln">heat_map_weights_col</span><span class="pun">])</span><span class="pln">
 
         curr_map</span><span class="pun">.</span><span class="pln">add_child</span><span class="pun">(</span><span class="pln">plugins</span><span class="pun">.</span><span class="typ">HeatMap</span><span class="pun">(</span><span class="pln">stations</span><span class="pun">,</span><span class="pln"> radius</span><span class="pun">=</span><span class="pln">heat_map_radius</span><span class="pun">))</span><span class="pln">
 
     </span><span class="kwd">return</span><span class="pln"> curr_map</span></pre><p>Processing Geometry is tedius enough to merit its own handler</p><pre class="prettyprint prettyprinted" style=""><span class="pln">               pt_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> draw_heatmap</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> heat_map_weights_col</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> heat_map_weights_normalize</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln">
                heat_map_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> popup</span><span class="pun">=</span><span class="str">'ProjNm'</span><span class="pun">)</span></pre><p>As you can see we have a lot of points. Lets see if there is any better way to visualize this.</p><h2 id="Example_Usin..." style="">Example: Using the advanced Functions</h2><a class="anchor" href="#Example_Usin..." id="#Example_Usin..." aria-label="Link to Example_Usin..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><h3 id="Playing_with..." style="">Playing with Points: Geoloom</h3><a class="anchor" href="#Playing_with..." id="#Playing_with..." aria-label="Link to Playing_with..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><h4 id="Points_In_Po..." style="">Points In Polygons</h4><a class="anchor" href="#Points_In_Po..." id="#Points_In_Po..." aria-label="Link to Points_In_Po..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>The red dots from when we mapped the geoloom points above were a bit too noisy.</p><p>Lets create a choropleth instead!</p><p>We can do this by <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.aggregate.html" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="719580">aggregating</a> by CSA.</p><p>To do this, start of by finding which points are inside of which polygons!</p><p>Since the geoloom data does not have a CSA dataset, we will need merge it to one that does!</p><p>Lets use the childhood poverty link from example one and load it up because it contains the geometry data and the csa labels.</p><pre class="prettyprint prettyprinted" style=""><span class="com"># csa_gdf = Intake.getData('https://raw.githubusercontent.com/bniajfi/bniajfi/main/CSA-to-Tract-2010.csv')</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># BNIA ArcGIS Homepage: https://data-bniajfi.opendata.arcgis.com/</span><span class="pln">
 csa_gdf_url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Hhchpov/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson"</span><span class="pln">
 csa_gdf </span><span class="pun">=</span><span class="pln"> readInGeometryData</span><span class="pun">(</span><span class="pln">url</span><span class="pun">=</span><span class="pln">csa_gdf_url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">=</span><span class="str">'geometry'</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">  save</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">=</span><span class="lit">2248</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">)</span></pre><p>And now lets pull in our geoloom data. But to be sure, drop the empty geometry columns or the function directly below will now work.</p><pre class="prettyprint prettyprinted" style=""><span class="pln">geoloom_gdf </span><span class="pun">=</span><span class="pln"> readInGeometryData</span><span class="pun">(</span><span class="pln">url</span><span class="pun">=</span><span class="pln">geoloom_gdf_url</span><span class="pun">,</span><span class="pln"> porg</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> geom</span><span class="pun">=</span><span class="str">'geometry'</span><span class="pun">,</span><span class="pln"> lat</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> lng</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> revgeocode</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln">  save</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">,</span><span class="pln"> in_crs</span><span class="pun">=</span><span class="lit">4326</span><span class="pun">,</span><span class="pln"> out_crs</span><span class="pun">=</span><span class="kwd">False</span><span class="pun">)</span><span class="pln">
 geoloom_gdf </span><span class="pun">=</span><span class="pln"> geoloom_gdf</span><span class="pun">.</span><span class="pln">dropna</span><span class="pun">(</span><span class="pln">subset</span><span class="pun">=[</span><span class="str">'geometry'</span><span class="pun">])</span><span class="pln">
 </span><span class="com"># geoloom_gdf = geoloom_gdf.drop(columns=['POINT_X','POINT_Y'])</span><span class="pln">
 geoloom_gdf</span><span class="pun">.</span><span class="pln">head</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></pre><p>And now use a point in polygon method 'ponp' to get the CSA2010 column from our CSA dataset added as a column to each geoloom record.</p><p>You'll see you have a 'pointsinpolygons' column now.</p><h4 id="Polygons_in_..." style="">Polygons in Points</h4><a class="anchor" href="#Polygons_in_..." id="#Polygons_in_..." aria-label="Link to Polygons_in_..." onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>Alternately, you can run the ponp function and have returned the geoloom dataset</p><p>We can count the totals per CSA using <code>value_counts</code></p><p>Alternately, we could map the centroid of boundaries within another boundary to find boundaries within boundaries</p><pre class="prettyprint prettyprinted" style=""><span class="pln">geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> geoloom_w_csas</span><span class="pun">.</span><span class="pln">centroid</span><span class="pun">.</span><span class="pln">x
 
 </span><span class="com"># We already know the x and y columns because we just saved them as such.</span><span class="pln">
 geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">to_numeric</span><span class="pun">(</span><span class="pln">geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_X'</span><span class="pun">],</span><span class="pln"> errors</span><span class="pun">=</span><span class="str">'coerce'</span><span class="pun">)</span><span class="pln">
 geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">to_numeric</span><span class="pun">(</span><span class="pln">geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">],</span><span class="pln"> errors</span><span class="pun">=</span><span class="str">'coerce'</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># df = df.replace(np.nan, 0, regex=True)</span><span class="pln">
 
 </span><span class="com"># And filter out for points only in Baltimore City. </span><span class="pln">
 geoloom_w_csas </span><span class="pun">=</span><span class="pln"> geoloom_w_csas</span><span class="pun">[</span><span class="pln"> geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">39.3</span><span class="pln">  </span><span class="pun">]</span><span class="pln">
 geoloom_w_csas </span><span class="pun">=</span><span class="pln"> geoloom_w_csas</span><span class="pun">[</span><span class="pln"> geoloom_w_csas</span><span class="pun">[</span><span class="str">'POINT_Y'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">39.5</span><span class="pln">  </span><span class="pun">]</span></pre><h4 id="Folium" style="">Folium</h4><a class="anchor" href="#Folium" id="#Folium" aria-label="Link to Folium" onclick="navigator.clipboard.writeText('https://charleskarpati.com/dataplay/03_map_basics_intake_and_operations.html'); w.toast?.();"></a><p>But if that doesn't do it for you, we can also create heat maps and marker clusters</p><pre class="prettyprint prettyprinted" style=""><span class="pln">               pt_radius</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> draw_heatmap</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> heat_map_weights_col</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> heat_map_weights_normalize</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln">
                heat_map_radius</span><span class="pun">=</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> popup</span><span class="pun">=</span><span class="str">'ProjNm'</span><span class="pun">)</span></pre><p>And Time Sliders</p><h5 id="choropleth-timeslider">Choropleth Timeslider</h5><p><a href="https://github.com/python-visualization/folium/blob/master/examples/TimeSliderChoropleth.ipynb" onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow" id="639892">https://github.com/python-visualization/folium/blob/master/examples/TimeSliderChoropleth.ipynb</a></p><pre class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> numpy </span><span class="kwd">as</span><span class="pln"> np
 </span><span class="kwd">import</span><span class="pln"> pandas </span><span class="kwd">as</span><span class="pln"> pd
 </span><span class="kwd">from</span><span class="pln"> branca</span><span class="pun">.</span><span class="pln">colormap </span><span class="kwd">import</span><span class="pln"> linear
 </span><span class="com"># conditionally loaded -&gt;  from dataplay import geoms</span><span class="pln">
 
 u </span><span class="pun">=</span><span class="pln"> intaker</span><span class="pun">.</span><span class="typ">Intake</span><span class="pln">
 rdf </span><span class="pun">=</span><span class="pln"> u</span><span class="pun">.</span><span class="pln">getData</span><span class="pun">(</span><span class="str">'https://services1.arcgis.com/mVFRs7NF4iFitgbY/ArcGIS/rest/services/Biz1_/FeatureServer/0/query?where=1%3D1&amp;outFields=*&amp;returnGeometry=true&amp;f=pgeojson'</span><span class="pun">)</span><span class="pln">
 </span><span class="com"># rdf.set_index('CSA2010', drop=True, inplace=True)</span><span class="pln">
 rdf</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="pln">labels</span><span class="pun">=[</span><span class="str">'OBJECTID_1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Shape__Area'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Shape__Length'</span><span class="pun">],</span><span class="pln"> axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> inplace</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">
 
 ndf </span><span class="pun">=</span><span class="pln"> rdf</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln">regex</span><span class="pun">=</span><span class="str">'biz1|CSA2010'</span><span class="pun">,</span><span class="pln"> axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
 
 </span><span class="com"># Calculate number of years available</span><span class="pln">
 n_periods </span><span class="pun">=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">ndf</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
 </span><span class="com"># Get starting year.</span><span class="pln">
 startAt </span><span class="pun">=</span><span class="pln"> </span><span class="str">"20"</span><span class="pun">+</span><span class="pln">ndf</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][-</span><span class="lit">2</span><span class="pun">:]</span><span class="pln">
 
 </span><span class="com"># Create a 'YEAR' index with the assumption that all following years exist</span><span class="pln">
 datetime_index </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">date_range</span><span class="pun">(</span><span class="pln">startAt</span><span class="pun">,</span><span class="pln"> periods</span><span class="pun">=</span><span class="pln">n_periods</span><span class="pun">,</span><span class="pln"> freq</span><span class="pun">=</span><span class="str">"Y"</span><span class="pun">)</span><span class="pln">
 dt_index_epochs </span><span class="pun">=</span><span class="pln"> datetime_index</span><span class="pun">.</span><span class="pln">astype</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 10 ** 9</span><span class="pln">
 dt_index </span><span class="pun">=</span><span class="pln"> dt_index_epochs</span><span class="pun">.</span><span class="pln">astype</span><span class="pun">(</span><span class="str">"U10"</span><span class="pun">)</span></pre><pre class="prettyprint prettyprinted" style=""><span class="com"># For the Index of each CSA</span><span class="pln">
 </span><span class="kwd">for</span><span class="pln"> idx</span><span class="pun">,</span><span class="pln"> csa </span><span class="kwd">in</span><span class="pln"> rdf</span><span class="pun">.</span><span class="pln">iterrows</span><span class="pun">():</span><span class="pln">
     df </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="typ">DataFrame</span><span class="pun">(</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"color"</span><span class="pun">:</span><span class="pln"> csa</span><span class="pun">.</span><span class="pln">values</span><span class="pun">[</span><span class="lit">1</span><span class="pun">:-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">},</span><span class="pln"> index</span><span class="pun">=</span><span class="pln">dt_index</span><span class="pun">,</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
     styledata</span><span class="pun">[</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> df
 
 max_color</span><span class="pun">,</span><span class="pln"> min_color </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
 </span><span class="kwd">for</span><span class="pln"> country</span><span class="pun">,</span><span class="pln"> data </span><span class="kwd">in</span><span class="pln"> styledata</span><span class="pun">.</span><span class="pln">items</span><span class="pun">():</span><span class="pln">
     max_color </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">max_color</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">[</span><span class="str">"color"</span><span class="pun">].</span><span class="pln">max</span><span class="pun">())</span><span class="pln">
     min_color </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">max_color</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">[</span><span class="str">"color"</span><span class="pun">].</span><span class="pln">min</span><span class="pun">())</span><span class="pln">
 
 cmap </span><span class="pun">=</span><span class="pln"> linear</span><span class="pun">.</span><span class="typ">PuRd_09</span><span class="pun">.</span><span class="pln">scale</span><span class="pun">(</span><span class="pln">min_color</span><span class="pun">,</span><span class="pln"> max_color</span><span class="pun">)</span><span class="pln">
 </span><span class="kwd">def</span><span class="pln"> norm</span><span class="pun">(</span><span class="pln">x</span><span class="pun">):</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">min</span><span class="pun">())</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">.</span><span class="pln">max</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">min</span><span class="pun">())</span><span class="pln">
 </span><span class="kwd">for</span><span class="pln"> country</span><span class="pun">,</span><span class="pln"> data </span><span class="kwd">in</span><span class="pln"> styledata</span><span class="pun">.</span><span class="pln">items</span><span class="pun">():</span><span class="pln">
     data</span><span class="pun">[</span><span class="str">"color"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">[</span><span class="str">"color"</span><span class="pun">].</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">cmap</span><span class="pun">)</span><span class="pln">
     data</span><span class="pun">[</span><span class="str">"opacity"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
 
 styledict </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> str</span><span class="pun">(</span><span class="pln">country</span><span class="pun">):</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">to_dict</span><span class="pun">(</span><span class="pln">orient</span><span class="pun">=</span><span class="str">"index"</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> country</span><span class="pun">,</span><span class="pln"> data </span><span class="kwd">in</span><span class="pln"> styledata</span><span class="pun">.</span><span class="pln">items</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
 
 </span><span class="com"># { CSA : { timestamp: {color: value, opacity:value } }, </span><span class="pln">
 </span><span class="com">#    CSA : { timestamp: {color: value, opacity:value } }, </span><span class="pln">
 </span><span class="com">#    ... </span><span class="pln">
 </span><span class="com"># }</span></pre><pre class="prettyprint prettyprinted" style=""><span class="kwd">from</span><span class="pln"> folium</span><span class="pun">.</span><span class="pln">plugins </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">TimeSliderChoropleth</span><span class="pln">
 
 m </span><span class="pun">=</span><span class="pln"> folium</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">([</span><span class="lit">39.28759453969165</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">76.61278931706487</span><span class="pun">],</span><span class="pln"> width</span><span class="pun">=</span><span class="str">'50%'</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">=</span><span class="str">'50%'</span><span class="pun">,</span><span class="pln"> zoom_start</span><span class="pun">=</span><span class="lit">12</span><span class="pun">)</span><span class="pln">
 g </span><span class="pun">=</span><span class="pln"> </span><span class="typ">TimeSliderChoropleth</span><span class="pun">(</span><span class="pln"> rdf</span><span class="pun">.</span><span class="pln">to_json</span><span class="pun">(),</span><span class="pln"> styledict</span><span class="pun">=</span><span class="pln">styledict</span><span class="pun">,</span><span class="pln"> </span><span class="pun">).</span><span class="pln">add_to</span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln">
 m</span></pre><link rel="stylesheet" href="https://cdn.rawgit.com/google/code-prettify/master/styles/desert.css"></details></div><div id="footer"><p id="thanks">Thank's for visiting! - <a href="./../legal.html" id="Terms_of_use80290">Terms of use</a></p><div id="footer_bg_wrapper"><div id="footer_bg"></div></div></div><style>:root{--radial1:radial-gradient(at 52%,at 13%,#a0c3f3 0px,transparent 50%),radial-gradient(at 40%,at 33%,#9be8df 0px,transparent 50%),radial-gradient(at 15%,at 92%,#63fdd9 0px,transparent 50%),radial-gradient(at 97%,at 78%,#889dfb 0px,transparent 50%),radial-gradient(at 19%,at 52%,#fea862 0px,transparent 50%),radial-gradient(at 68%,at 16%,#f29cba 0px,transparent 50%),radial-gradient(at 25%,at 1%,#5cb3e6 0px,transparent 50%);--radial1:radial-gradient(at 52% 13%,#a0c3f3 0px,transparent 50%),radial-gradient(at 40% 33%,#9be8df 0px,transparent 50%),radial-gradient(at 15% 92%,#63fdd9 0px,transparent 50%),radial-gradient(at 97% 78%,#889dfb 0px,transparent 50%),radial-gradient(at 19% 52%,#fea862 0px,transparent 50%),radial-gradient(at 68% 16%,#f29cba 0px,transparent 50%),radial-gradient(at 25% 1%,#5cb3e6 0px,transparent 50%);--filterdropshadowover:drop-shadow(4px 4px 10px rgb(var(--foreground)));--filterdropshadowunder:drop-shadow(4px -4px 1px rgb(var(--background)));--path1:path("M 0 0 L 0 2 L 0 0");--path2:0;--bgheader:linear-gradient(70deg,rgba(var(--background),0.5),rgba(var(--foreground),0.5),rgba(var(--background),0.5));--bgfooter:linear-gradient(70deg,rgba(var(--background),0.6),rgba(var(--foreground),0.6),rgba(var(--background),0.6))}h1>a::-moz-selection{color:rgb(var(--near-black))}h1>a::selection{color:rgb(var(--near-black))}h1>a{animation:gradient 5s ease infinite;background:linear-gradient(90deg,rgb(var(--near-black)),rgba(var(--near-black),.4),rgb(var(--near-black)),rgba(var(--near-black),.4));-webkit-background-clip:text;background-clip:text;background-size:300% 100%;color:transparent}@keyframes gradient{0%{background-position:0 0}50%{background-position:100% 100%}to{background-position:0 0}}h2{filter:url(#header)}#header{margin:60px auto 30px;padding:12px;text-align:center;width:-moz-fit-content;width:fit-content;z-index:9}#header_bg_wrapper{filter:drop-shadow(4px 4px 10px rgb(var(--foreground)));filter:var(--filterdropshadowover);height:100%;position:absolute;top:0;width:100%}#header_bg{animation:spin-header 1s linear infinite alternate;background:linear-gradient(70deg,rgba(var(--background),.5),rgba(var(--foreground),.5),rgba(var(--background),.5));background:var(--bgheader);border-radius:50px;-webkit-clip-path:polygon(33% 38%,0 43%,0 0,100% 0,100% 43%,66% 38%,66% 46%,100% 60%,100% 100%,0 100%,0 60%,33% 46%);clip-path:polygon(33% 38%,0 43%,0 0,100% 0,100% 43%,66% 38%,66% 46%,100% 60%,100% 100%,0 100%,0 60%,33% 46%);height:100%;transition-duration:2s;width:100%}#header:hover #header_bg{-webkit-clip-path:polygon(0 15%,15% 15%,15% 0,85% 0,85% 15%,100% 15%,100% 85%,85% 85%,85% 100%,15% 100%,15% 85%,0 85%);clip-path:polygon(0 15%,15% 15%,15% 0,85% 0,85% 15%,100% 15%,100% 85%,85% 85%,85% 100%,15% 100%,15% 85%,0 85%)}@keyframes spin-header{0%{transform:rotate(-4deg)}to{transform:rotate(4deg)}}@keyframes wiggle{0%{transform:translate(0)}50%{transform:translate(5px)}to{transform:translate(0)}}.controls_container{flex-wrap:wrap;justify-content:space-between;margin:0 auto 30px;padding:0 25px}#footer,.controls_container{align-items:flex-end;display:flex;width:min(100vw,800px)}#footer{height:200px;justify-content:center;margin:30px auto 0}#thanks{color:rgb(var(--near-black));font-size:1.25em;padding:10px;text-align:center}#thanks a{font-size:.75em}#footer_bg_wrapper{filter:drop-shadow(4px -4px 1px rgb(var(--background)));filter:var(--filterdropshadowunder);height:100%;position:absolute;top:0;width:100%;z-index:-1}#footer_bg{background:linear-gradient(70deg,rgba(var(--background),.6),rgba(var(--foreground),.6),rgba(var(--background),.6));background:var(--bgfooter);height:100%;width:100%}#content{margin:auto;max-width:var(--max-width)}#content img{max-width:-webkit-fill-available}#content>*,#content>div>*,details>details{margin:0;padding:12px 0 12px 16px}#content>div{padding:0}details>details{border-left:1px solid rgb(var(--near-black))}@media only screen and (max-width:769px){#content>*,details>details{padding-right:2px}#content{border-width:28px 0 28px 8px}#head_separator{display:none}.notebox:checked+aside{align-items:flex-end;flex-direction:column-reverse}#breadcrumbs{padding-bottom:10px}}.twitter-tweet{margin:auto}#expand,#light,.notelbl{cursor:pointer}#light:before{content:"🌜 Dark mode";display:block}html[\:has\(\%23lightmode\:checked\)]{filter:invert(100%)}html:has(#lightmode:checked){filter:invert(100%)}html[\:has\(\%23lightmode\:checked\)] #light:before{content:"🌞 Light mode"}html:has(#lightmode:checked) #light:before{content:"🌞 Light mode"}#audio{align-items:center;display:flex;margin:0 0 0 -7px}audio{height:40px;margin-left:-6px}audio::-webkit-media-controls-panel{background:rgba(var(--background),.5)}#audio>span{border-radius:50%;display:inline-block;height:40px;margin-right:5px;overflow:hidden;width:40px}.notelbl{color:rgb(var(--near-black))}aside{background:rgb(var(--canvas));border-width:medium;border-bottom:0 solid rgb(var(--near-black));border-left:2px solid rgb(var(--near-black));border-radius:7% 7% 0 0;border-right:2px solid rgb(var(--near-black));border-top:10px solid rgb(var(--near-black));box-shadow:2px 2px 4px rgba(0,0,0,.5);margin:auto;padding:20px;z-index:1}.notebox,aside{display:none}.info,.tip,.warning{align-items:center;border:#000;border-radius:5% 5% 5% 5%;color:rgb(var(--near-white));display:flex}.info>*,.tip>*,.warning>*{display:inline}.info a,.tip a,.warning a{color:rgb(var(--near-white))}aside.info:before,aside.tip:before,aside.warning:before{display:inline-block;font-size:1.5em;margin:10px 20px}aside.tip:before{content:"💡"}aside.info:before{content:"ℹ️"}aside.warning:before{content:"⚠️"}aside.tip{background:rgba(var(--near-black),1)}aside.info{background:#087abb}aside.warning{background:#8b0000}.notebox:checked+p+aside{display:block}.notebox:checked+p+aside>.notelbl:after{content:" [X]"}#expand:before{content:"➕ Expand notes"}body[\:has\(\%23expandmode\:checked\)] #expand:before{content:"➖ Collapse notes"}body:has(#expandmode:checked) #expand:before{content:"➖ Collapse notes"}body[\:has\(\%23expandmode\:checked\)] aside{display:block}body:has(#expandmode:checked) aside{display:block}#toast_container{bottom:15%;display:flex;justify-content:center;position:fixed;transform:scale(0);width:100vw;z-index:1}#toast_container>p{background:rgb(var(--near-black));border-radius:50px;color:rgb(var(--foreground));padding:10px;width:-moz-fit-content;width:fit-content}@keyframes toast{0%{transform:scale(0)}20%{transform:scale(1)}80%{transform:scale(1)}to{transform:scale(0)}}#page_transition{align-items:center;background:radial-gradient(at 52%,at 13%,#a0c3f3 0,transparent 50%),radial-gradient(at 40%,at 33%,#9be8df 0,transparent 50%),radial-gradient(at 15%,at 92%,#63fdd9 0,transparent 50%),radial-gradient(at 97%,at 78%,#889dfb 0,transparent 50%),radial-gradient(at 19%,at 52%,#fea862 0,transparent 50%),radial-gradient(at 68%,at 16%,#f29cba 0,transparent 50%),radial-gradient(at 25%,at 1%,#5cb3e6 0,transparent 50%);background:radial-gradient(at 52% 13%,#a0c3f3 0,transparent 50%),radial-gradient(at 40% 33%,#9be8df 0,transparent 50%),radial-gradient(at 15% 92%,#63fdd9 0,transparent 50%),radial-gradient(at 97% 78%,#889dfb 0,transparent 50%),radial-gradient(at 19% 52%,#fea862 0,transparent 50%),radial-gradient(at 68% 16%,#f29cba 0,transparent 50%),radial-gradient(at 25% 1%,#5cb3e6 0,transparent 50%);background:var(--radial1);background-size:100% 200%;border-radius:50px;color:rgb(var(--near-black));display:flex;font-size:1.25em;height:100%;justify-content:center;left:50%;opacity:0;overflow:hidden;position:fixed;top:50%;transform:translate(-50%,-50%) scale(0);width:100%;z-index:100}@keyframes page_transition{0%{opacity:1;transform:translate(-50%,-50%) scale(0)}70%{opacity:1;transform:translate(-50%,-50%) scale(1)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}</style><script>!function(){"use strict";var e,t,n,r,o={},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,i),n.exports}i.m=o,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);i.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var c=2&r&&n;"object"==typeof c&&!~e.indexOf(c);c=t(c))Object.getOwnPropertyNames(c).forEach((function(e){a[e]=function(){return n[e]}}));return a.default=function(){return n},i.d(o,a),o},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))},i.u=function(e){return"chunk."+({156:"convert",233:"template",787:"route"}[e]||e)+"."+{156:"3b4ee96b5987bb93cb79",212:"cc5a15acf69e27245d38",233:"a19d52f05fa325468cec",787:"ab9678e9f9cb9ec43a9e"}[e]+".js"},i.miniCssF=function(e){return"index.css"},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n={},r="karpatic:",i.l=function(e,t,o,a){if(n[e])n[e].push(t);else{var c,u;if(void 0!==o)for(var f=document.getElementsByTagName("script"),l=0;l<f.length;l++){var s=f[l];if(s.getAttribute("src")==e||s.getAttribute("data-webpack")==r+o){c=s;break}}c||(u=!0,(c=document.createElement("script")).charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.setAttribute("data-webpack",r+o),c.src=e),n[e]=[t];var d=function(t,r){c.onerror=c.onload=null,clearTimeout(p);var o=n[e];if(delete n[e],c.parentNode&&c.parentNode.removeChild(c),o&&o.forEach((function(e){return e(r)})),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:c}),12e4);c.onerror=d.bind(null,c.onerror),c.onload=d.bind(null,c.onload),u&&document.head.appendChild(c)}},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",function(){var e={826:0};i.f.j=function(t,n){var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((function(n,o){r=e[t]=[n,o]}));n.push(r[2]=o);var a=i.p+i.u(t),c=new Error;i.l(a,(function(n){if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;c.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",c.name="ChunkLoadError",c.type=o,c.request=a,r[1](c)}}),"chunk-"+t,t)}};var t=function(t,n){var r,o,a=n[0],c=n[1],u=n[2],f=0;if(a.some((function(t){return 0!==e[t]}))){for(r in c)i.o(c,r)&&(i.m[r]=c[r]);u&&u(i)}for(t&&t(n);f<a.length;f++)o=a[f],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkkarpatic=self.webpackChunkkarpatic||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),window.w=window,w.oldRoute=location.pathname,w.isLocal||=!w.content,w.preRendering=/ReactSnap/.test(navigator.userAgent),w.preRendering||(console.log("%c Like what you see?","font-weight: bold; font-size: 50px;color: red; text-shadow: 3px 3px 0 red , 6px 6px 0 green , 9px 9px 0 blue"),console.log("%c Contact me: charleskarpati@gmail.com","color: blue; font-family:sans-serif; font-size: 20px")),w.pingServer=async(e=!1)=>{w.content&&navigator.sendBeacon("https://ping.charleskarpati.com/",`{"from":"${oldRoute||location.href}","to":"${e?.href||e?.target?.href||oldRoute}"}`)},!isLocal&&w.pingServer(),w.redirect=async(e=!1)=>{e?.preventDefault?.(),!w.navEvent&&({handleRoute:w.handleRoute,navEvent:w.navEvent}=await i.e(787).then(i.bind(i,85))),"click"==e.type?(history.pushState({},"",e.target.href),navEvent()):handleRoute()},addEventListener("popstate",redirect)}()</script><script>function loadLazy(){w.loadOnce&&(w.loadOnce=!0)||((document.head||d).appendChild(document.createElement("script")).src=origin+"/templates/article_lazy.js")}[[["scroll","mousedown","touchstart"],w,loadLazy,{once:!0}]].forEach((e=>e[0].forEach((t=>e[1].addEventListener(t,e[2],e[3]||{passive:!1}))))),w.activeHeader=null,w.observer=new IntersectionObserver((e=>{e.forEach((e=>{let t=e.target,n="0.5s ease-in-out 0s 2 normal none running wiggle",a=t.getBoundingClientRect().top,o="SUMMARY"==t.parentNode?.nodeName&&t.parentNode.style||t.style;if(o.animation=n,!e.isIntersecting)return o.animation="";if(a<300||a>300){w.activeHeader&&(w.activeHeader.style.textDecoration="none");let e=document.querySelector(`#sitemap a[href="#${t.id}"]`);e&&(e.style.animation=n,e.style.textDecoration="line-through"),w.activeHeader=e}}))})),(w.loadObserver=e=>{document.querySelectorAll("h2,h3,h4").forEach((e=>observer.observe(e)))})()</script><style>body[\:has\(\%23sitemap\[focus-within\]\)]{overscroll-behavior-y:contain}body:has(#sitemap[focus-within]){overscroll-behavior-y:contain}body[\:has\(\%23sitemap\:focus-within\)]{overscroll-behavior-y:contain}body:has(#sitemap:focus-within){overscroll-behavior-y:contain}#sitemap{backdrop-filter:blur(2px) saturate(100%);-webkit-backdrop-filter:blur(2px) saturate(100%);background-color:rgba(var(--foreground),.6);border-radius:.7rem;border-radius:12px;box-shadow:3px 2px 5px rgb(var(--background)),-3px -2px 20px rgb(var(--near-white)),inset 0 0 10px rgb(var(--near-white));left:0;min-width:8em;overflow:hidden;overflow-x:hidden;padding:0 1rem 1rem;position:fixed;top:0;z-index:999}#toggle_sitemap{visibility:hidden}#toggle_sitemap:not(:checked)~#sitemap{animation:collapse 1s forwards,glow 6s linear infinite}#toggle_sitemap:checked~#sitemap{animation:expand 1s forwards,pulse 6s linear infinite}@keyframes glow{50%{box-shadow:3px 2px 20px rgb(var(--near-white)),-3px -2px 20px rgb(var(--background)),inset 0 0 10px rgb(var(--background))}}@keyframes collapse{0%{max-height:75svh}to{max-height:3em}}@keyframes expand{to{max-height:75svh}0%{max-height:3em}}#sitemap>label{color:rgb(var(--near-black));cursor:grab;display:flex;justify-content:space-between;line-height:3em;width:-webkit-fill-available}#sitemap>label:hover{text-shadow:1px 1px 45px rgb(var(--near-black))}#toggle_sitemap:not(:checked)~#sitemap>label>span{animation:dismiss 1s forwards}#toggle_sitemap:checked~#sitemap>label>span{animation:reveal .5s forwards}#sitemap>label>span:nth-child(2){--rotate:0deg}#sitemap>label>span:nth-child(3){--rotate:45deg}@keyframes reveal{0%{transform:rotate(var(--rotate))}to{transform:rotate(90deg)}}@keyframes dismiss{0%{transform:rotate(90deg)}to{transform:rotate(var(--rotate))}}#sitemap-content{display:grid;max-height:calc(75vh - 6em);overflow-x:hidden}#sitemap-content>a{display:inherit;width:-moz-fit-content;width:fit-content}#sitemap-content>a:hover{animation:shake 1s linear infinite alternate}#currentPage:hover{color:rgb(var(--near-black))}#currentPage+div>a:hover{text-decoration:line-through}#currentPage+div{display:block;font-size:1em;line-height:1em}#currentPage:hover{animation:gradient 4s linear infinite alternate,shake 1s linear infinite alternate}#currentPage{animation:gradient 4s linear infinite alternate;background-image:var(--radial1);background-size:100% 400%;border-radius:5px}@keyframes shake{0%{transform:translate(0);-webkit-transform:translate(0)}50%{transform:translate(4px);-webkit-transform:translate(4px)}to{transform:translate(0);-webkit-transform:translate(0)}}</style></body></html>